!function(o){"use strict";function e(i){if(i&&i.__esModule)return i;var n=Object.create(null);return i&&Object.keys(i).forEach(function(e){var t;"default"!==e&&(t=Object.getOwnPropertyDescriptor(i,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return i[e]}}))}),n.default=i,Object.freeze(n)}var u,h=e(o);function t(i){if(i.__esModule)return i;var n=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(e){var t=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return i[e]}})}),n}(G=z=z||{}).BLUE="blue",G.GREEN="green",G.YELLOW="yellow",G.RED="red",G.PURPLE="purple",G.PINK="pink",(j=u=u||{})[j.Tap=0]="Tap",j[j.Flick=1]="Flick",j[j.SlideStart=2]="SlideStart",j[j.SlideInvisible=3]="SlideInvisible",j[j.SlideVisible=4]="SlideVisible",j[j.SlideEndDefault=5]="SlideEndDefault",j[j.SlideEndFlick=6]="SlideEndFlick",(z=X=X||{})[z.None=0]="None",z[z.Linear=1]="Linear",z[z.EaseIn=2]="EaseIn",z[z.EaseOut=3]="EaseOut",z[z.EaseInOut=4]="EaseInOut",z[z.CubicBezier=5]="CubicBezier",(G=_=_||{})[G.Up=0]="Up",G[G.Left=1]="Left",G[G.Right=2]="Right";var l=4,c=1e-7,d=10,s="function"==typeof Float32Array;function n(e,t){return 1-3*t+3*e}function r(e,t){return 3*t-6*e}function p(e,t,i){return((n(t,i)*e+r(t,i))*e+3*t)*e}function m(e,t,i){return 3*n(t,i)*e*e+2*r(t,i)*e+3*t}function g(e){return e}function w(o,t,r,i){if(!(0<=o&&o<=1&&0<=r&&r<=1))throw new Error("bezier x values must be in [0, 1] range");if(o===t&&r===i)return g;for(var a=new(s?Float32Array:Array)(11),e=0;e<11;++e)a[e]=p(.1*e,o,r);function n(e){for(var t=0,i=1;10!==i&&a[i]<=e;++i)t+=.1;var n=t+.1*((e-a[--i])/(a[i+1]-a[i])),s=m(n,o,r);return.001<=s?function(e,t,i,n){for(var s=0;s<l;++s){var o=m(t,i,n);if(0===o)return t;t-=(p(t,i,n)-e)/o}return t}(e,n,o,r):0===s?n:function(e,t,i,n,s){for(var o,r,a=0;0<(o=p(r=t+(i-t)/2,n,s)-e)?i=r:t=r,Math.abs(o)>c&&++a<d;);return r}(e,t,t+.1,o,r)}return function(e){return 0===e?0:1===e?1:p(n(e),t,i)}}var f,i;class a extends o.NineSlicePlane{constructor(e,t){super(e,91,0,91,0),this.interactive=!0,this.id=t.id}}class v extends o.NineSlicePlane{constructor(e,t,i){super(e,91,0,91,0),this.interactive=!0,this.id=t.id,this.slideId=i.id}}(j=f=f||{}).Scroll="scroll",j.Destroy="destroy",j.Select="select";class y extends o.Sprite{constructor(e,t,i){super(e),this.interactive=!0,this.id=t.id,this.slideId=i.id}}class b extends o.Container{constructor(e,t,i){super(),this.name="Cursor",this.draw(e,t,i)}draw(e,t,i){const n=new o.Graphics;n.lineStyle(e,i),n.moveTo(0,0),n.lineTo(t,0),this.addChild(n);const s=new o.Graphics;s.lineStyle(e,i),s.moveTo(0,0),s.lineTo(0,t),s.x=t/2,s.y=-t/2,this.addChild(s)}}class S{constructor(e,t,i){this.scrollBottom=0,this.colors={background:16777215,lane:0,bpm:65535,time:16711680,beat:{third:16711680,half:0,quarter:255},slide:14285551,slideNote:3204520,critical:16579021,criticalNote:15852573,selection:233724,cursor:0};var{width:n,height:s}=e.getBoundingClientRect(),o=window.devicePixelRatio;this.resolution=o,this.setMap(t),this.app=new h.Application({backgroundAlpha:0,width:n,height:s,antialias:!0,resolution:o}),this.const={resolution:o,fontSize:18/o,heightPerSecond:500/o,spaceY:200/o,width:n,height:s,paddingX:4/o,paddingY:2/o,lineWidth:1/o,noteHeight:32/o,arrowHeight:32/o,maxHeight:0,cursorLineWidth:3/o},this.time=i,this.currentTime=0,this.const.maxHeight=this.const.heightPerSecond*i+2*this.const.spaceY,this.container={lane:new h.Container,time:new h.Container,note:new h.Container,slide:new h.Container,arrow:new h.Container,selection:new h.Container,cursor:new b(this.const.cursorLineWidth,.06*this.const.width*1.2,this.colors.cursor)},this.scrollBottom/=o,this.app.view.style.width=n+"px",this.app.view.style.height=s+"px",e.appendChild(this.app.view),this.app.stage.addChild(this.container.cursor),this.container.cursor.visible=!1,this.container.cursor.zIndex=15,this.app.stage.addChild(this.container.lane),this.app.stage.sortableChildren=!0,this.app.stage.interactive=!0,this.container.lane.name="Lane",this.notes=h.Loader.shared.resources["images/sprite.json"].textures,this.event=new EventTarget,this.selection={single:[],slide:{}},this.tempSelection={single:[],slide:{}},this.selectionBox=[0,0,0,0],this.scrollTicker=new h.Ticker,this.scrollTicker.autoStart=!1,this.scrollTicker.add(this.scrollTickerHandler.bind(this)),this.beatSlice=4,this.lastMouseCursorPosition={x:0,y:0},this.start()}start(){this.drawLane();const e=new h.Graphics;e.name="SelectArea",e.beginFill(this.colors.background,1),e.drawRect(0,0,this.const.width,this.const.height),e.zIndex=-1,e.interactive=!0,e.endFill(),this.app.stage.addChild(e),this.listen(e),this.reRender()}listen(n){this.app.view.addEventListener("wheel",e=>{e=Math.min(this.const.maxHeight-this.const.height,Math.max(0,this.scrollBottom-e.deltaY/this.resolution));this.scrollTo(e)});const s=this.selectAreaMoveHandler.bind(this);let o={single:[],slide:{}};n.on("mousedown",e=>{var t;0===e.data.button&&(e.data.originalEvent.ctrlKey||this.emptySelection(),e=(t=e.data.global).x,t=this.scrollBottom+(this.const.height-t.y),this.selectionBox=[e,t,e,t],n.on("mousemove",s),this.event.addEventListener(f.Scroll,s),this.reRender(),window.addEventListener("mouseup",r))});const r=()=>{window.removeEventListener("mouseup",r),this.selectionBox=[0,0,0,0],n.off("mousemove",s),this.event.removeEventListener(f.Scroll,s),this.autoScrollDelta=0,this.scrollTicker.stop(),this.selection.single.push(...this.tempSelection.single);for(const i in this.tempSelection.slide){var e;Object.prototype.hasOwnProperty.call(this.tempSelection.slide,i)&&(e=this.tempSelection.slide[i],this.selection.slide[i]||(this.selection.slide[i]=[]),this.selection.slide[i].push(...e))}this.tempSelection.single=[],this.tempSelection.slide={};var t=JSON.parse(JSON.stringify(this.selection));this.isSelectionEqual(o,t)||(this.event.dispatchEvent(new CustomEvent(f.Select,{detail:{oldSelection:o,newSelection:t}})),o=JSON.parse(JSON.stringify(t))),this.reRender()};n.on("mousemove",e=>{this.lastMouseCursorPosition.x=e.data.global.x,this.lastMouseCursorPosition.y=e.data.global.y;var[t,e]=this.getCursorPosition();this.moveCursor(t,e)}),this.event.addEventListener(f.Scroll,()=>{var[e,t]=this.getCursorPosition();this.moveCursor(e,t)})}selectAreaMoveHandler(){var e=this.lastMouseCursorPosition;this.selectionBox[2]=e.x,this.selectionBox[3]=this.scrollBottom+(this.const.height-e.y);var t=this.const.height/20,i=this.const.height-t;e.y<t||e.y>i?(this.scrollTicker.started||this.scrollTicker.start(),this.autoScrollDelta=((e.y<t?t:i)-e.y)/(t/10)):(this.autoScrollDelta=0,this.scrollTicker.stop()),this.findSelectedNote(),this.reRender()}findSelectedNote(){var n=Math.min(this.selectionBox[1],this.selectionBox[3]),s=Math.max(this.selectionBox[1],this.selectionBox[3]),o=Math.min(this.selectionBox[0],this.selectionBox[2]),r=Math.max(this.selectionBox[0],this.selectionBox[2]);this.tempSelection.single=[],this.tempSelection.slide={};for(let e=0;e<this.map.notes.length;e++){var t=this.map.notes[e],i=this.getHeightByBeat(t.beat),a=this.getLaneX(t.lane),l=this.getLaneX(t.lane+t.width);if(n<=i&&i<=s&&o<=a&&l<=r&&!this.selection.single.includes(t.id))this.tempSelection.single.push(t.id);else if(s<i)break}for(let e=0;e<this.map.slides.length;e++){const v=this.map.slides[e];if(!(this.getHeightByBeat(v.notes[v.notes.length-1].beat)<n))for(let i=0;i<v.notes.length;i++){var h=v.notes[i],c=this.getHeightByBeat(h.beat);let e=void 0!==h.lane?this.getLaneX(h.lane):0,t=void 0!==h.lane?this.getLaneX(h.lane+h.width):0;if(void 0===h.lane){const f=v.notes.length-i-1;var d=v.notes.concat().reverse().find((e,t)=>t>f&&void 0!==e.lane),u=v.notes.find((e,t)=>t>i&&void 0!==e.lane),p=this.getHeightByBeat(d.beat),m=(c-p)/(this.getHeightByBeat(u.beat)-p),g=[!1,[0,0,1,1],[0,0,0,.5],[1,.5,1,1],[1,.5,0,.5],d.bezier][d.curve];const y=g&&w(g[0],g[1],g[2],g[3]);p=d.width+(u.width-d.width)*y(m),m=d.lane+(u.lane-d.lane)*y(m);e=this.getLaneX(g?m:d.lane),t=this.getLaneX(g?m+p:d.lane+d.width)}if(n<=c&&c<=s&&e>=o&&t<=r&&!this.selection.slide[v.id]?.includes(h.id))this.tempSelection.slide[v.id]||(this.tempSelection.slide[v.id]=[]),this.tempSelection.slide[v.id].push(h.id);else{if(s<c&&0===i)return;if(s<c)break}}}}emptySelection(){this.selection.single=[],this.selection.slide={}}scrollTickerHandler(){this.scrollTo(this.scrollBottom+this.autoScrollDelta)}scrollTo(e){const t={oldScrollBottom:this.scrollBottom,newScrollBottom:0};this.scrollBottom=Math.min(this.const.maxHeight-this.const.height,Math.max(0,e)),t.newScrollBottom=this.scrollBottom,this.event.dispatchEvent(new CustomEvent(f.Scroll,{detail:t})),this.reRender()}reRender(){this.container.time.destroy({children:!0}),this.container.note.destroy({children:!0}),this.container.slide.destroy({children:!0}),this.container.arrow.destroy({children:!0}),this.container.selection.destroy({children:!0}),this.container.time=new h.Container,this.container.note=new h.Container,this.container.slide=new h.Container,this.container.arrow=new h.Container,this.container.selection=new h.Container,this.container.time.name="Time",this.container.note.name="Note",this.container.slide.name="Slide",this.container.arrow.name="Arrow",this.container.selection.name="Selection",this.container.time.zIndex=5,this.container.arrow.zIndex=7,this.container.slide.zIndex=8,this.container.note.zIndex=9,this.container.selection.zIndex=10,this.app.stage.addChild(this.container.time),this.app.stage.addChild(this.container.note),this.app.stage.addChild(this.container.slide),this.app.stage.addChild(this.container.arrow),this.app.stage.addChild(this.container.selection),this.drawBeat(),this.drawBPM(),this.drawCurrentTimeLine(),this.drawNote(),this.drawSlide(),this.drawSelectionBox()}destroy(){this.event.dispatchEvent(new CustomEvent(f.Destroy)),this.app.destroy(!0,{children:!0})}static loadResource(i,n){return new Promise(e=>{const t=h.Loader.shared;t.add("images/sprite.json").load(()=>{console.log("load resources completed"),e()}),i&&t.onLoad.add(i),n&&t.onError.add(n)})}minusBeat(e,t){return this.fractionToDecimal(e)-this.fractionToDecimal(t)}getTimeByBeat(t){let i=0;for(let e=0;e<this.map.bpms.length;e++){var n=this.map.bpms[e];if(this.minusBeat(t,n.beat)<=0)break;var s=this.map.bpms[e+1];i+=(s&&0<this.minusBeat(t,s.beat)?this.minusBeat(s.beat,n.beat):this.minusBeat(t,n.beat))/n.bpm*60}return i}getHeightByBeat(e){return this.const.spaceY+this.getTimeByBeat(e)*this.const.heightPerSecond}getHeightByTime(e){return this.const.spaceY+e*this.const.heightPerSecond}formatTime(e){return`${Math.floor(e/60)}:${(e%60).toFixed(3).padStart(6,"0")}`}getYInCanvas(e){return this.const.height-(e-this.scrollBottom)}getLaneX(e){return this.const.width*(6*e+14)/100}fractionToDecimal(e){return e[0]+e[1]/e[2]}drawSelectionBox(){var e=this.selectionBox;if(e[0]!==e[2]&&e[1]!==e[3]){const n=new h.Graphics;n.beginFill(this.colors.selection,.2),n.lineStyle(this.const.lineWidth,this.colors.selection);var t=this.getYInCanvas(e[1]),i=this.getYInCanvas(e[3])-t;n.drawRect(e[0],t,e[2]-e[0],i),n.endFill(),this.container.selection.addChild(n)}}drawCurrentTimeLine(){var e=this.getHeightByTime(this.currentTime);if(e>=this.scrollBottom&&e<=this.scrollBottom+this.const.height){const t=new h.Graphics;t.name="Time-line",t.lineStyle(this.const.lineWidth,this.colors.time,1),t.moveTo(0,0),t.lineTo(.8*this.const.width,0),t.x=.1*this.const.width,t.y=this.getYInCanvas(e),this.container.time.addChild(t)}}drawBPM(){for(let e=0;e<this.map.bpms.length;e++){const n=this.map.bpms[e];var t=this.getTimeByBeat(n.beat),i=this.getHeightByTime(t);if(i>=this.scrollBottom&&i<=this.scrollBottom+this.const.height){const s=new h.Graphics;s.name=`BPM-${n.id}-line`,s.lineStyle(this.const.lineWidth,this.colors.bpm,1),s.moveTo(0,0),s.lineTo(this.const.width,0),s.y=this.getYInCanvas(i);const o=new h.Text(this.formatTime(t),{fontSize:this.const.fontSize,fill:this.colors.bpm,align:"left"});o.name=`BPM-${n.id}-time`,o.x=this.const.paddingX,o.y=this.getYInCanvas(i)-o.height-this.const.paddingY;const r=new h.Text(n.bpm.toString(),{fontSize:this.const.fontSize,fill:this.colors.bpm,align:"left"});r.name=`BPM-${n.id}-value`,r.x=this.getLaneX(12)+this.const.paddingX,r.y=this.getYInCanvas(i)-r.height-this.const.paddingY,this.container.time.addChild(s),this.container.time.addChild(o),this.container.time.addChild(r)}else if(i>this.scrollBottom+this.const.height)break}}drawBeatLine(e,t,i,n,s=!1){const o=new h.Graphics;var r=this.fractionToDecimal(e);if(o.name=`Beat-${r}-line`,o.lineStyle(this.const.lineWidth,t,i),o.moveTo(this.getLaneX(0),0),o.lineTo(s?this.const.width:this.getLaneX(12),0),o.y=this.getYInCanvas(n),s){const a=new h.Text(`${Math.floor(e[0]/4)+1}:${e[0]%4+1}`,{fontSize:this.const.fontSize,fill:t,align:"left"});a.name=`Beat-${r}-beat`,a.x=this.const.width-a.width-this.const.paddingX,a.y=this.getYInCanvas(n)-a.height-this.const.paddingY,this.container.time.addChild(a)}this.container.time.addChild(o)}drawBeat(){this.container.time.destroy({children:!0}),this.container.time=new h.Container;var t=this.beatSlice;for(let e=0;;e++){var i=[Math.floor(e/t),e%t,t],n=this.getTimeByBeat(i),n=this.getHeightByTime(n);if(n>this.const.maxHeight-this.const.spaceY)break;if(n>=this.scrollBottom&&n<=this.scrollBottom+this.const.height)e%t==0?this.drawBeatLine(i,this.colors.beat.half,1,n,!0):e%(t/2)==0?this.drawBeatLine(i,this.colors.beat.half,.2,n):e%(t/3)==0?this.drawBeatLine(i,this.colors.beat.third,.4,n):e%(t/4)==0&&this.drawBeatLine(i,this.colors.beat.quarter,.4,n);else if(n>this.scrollBottom+this.const.height)break}this.app.stage.addChild(this.container.time)}drawLane(){for(let e=0;e<=12;e++){const i=new h.Graphics;i.name=`Lane-${e}`;var t=this.const.width*((6*e+14)/100);i.lineStyle(this.const.lineWidth,this.colors.lane,e%2?.2:1),i.moveTo(0,0),i.lineTo(0,this.const.height),i.x=t,this.container.lane.addChild(i)}}drawBaseNote(e,t,i,n){const s=void 0===n?new a(this.notes[t],e):new v(this.notes[t],e,n);s.name=`Note-${t}-${e.id}`;t=this.const.noteHeight/s.height;s.scale.set(t),s.x=this.getLaneX(e.lane)-.006*this.const.width,s.y=this.getYInCanvas(i)-this.const.noteHeight/2,s.width=.06*(e.width+.2)*this.const.width/t,s.on("click",(void 0===n?this.singleClickHandler:this.slideClickHandler).bind(this)),this.container.note.addChild(s)}singleClickHandler(e){var t;0===e.data.button&&(t=e.target.id,e.data.originalEvent.ctrlKey||this.emptySelection(),-1===(e=this.selection.single.indexOf(t))?this.selection.single.push(t):this.selection.single.splice(e,1),this.reRender())}slideClickHandler(e){var t,i;0===e.data.button&&(t=e.target.id,i=e.target.slideId,e.data.originalEvent.ctrlKey||this.emptySelection(),this.selection.slide[i]||(this.selection.slide[i]=[]),-1===(e=this.selection.slide[i].indexOf(t))?this.selection.slide[i].push(t):this.selection.slide[i].splice(e,1),this.reRender())}drawFlickArrow(e,t){const i=Math.min(6,e.width);var n=`flick_arrow_${e.critical?"critical_":""}${i.toString().padStart(2,"0")}${{0:"",1:"_left",2:"_right"}[e.direction]}`;const s=new h.Sprite(this.notes[n]);s.name=`Arrow-${e.id}`;var o=.8*i*.06*this.const.width/s.width,n=s.height*o;s.scale.set(o),s.x=this.getLaneX(e.lane+(e.width-i)/2+.1*i),s.y=this.getYInCanvas(t)-n,this.container.arrow.addChild(s)}drawCurve(e,t,i,n,s=!1){const o=new h.Graphics;o.name=`Curve-${e.id}`;var r,a,l=[!1,[0,0,1,1],[1,.5,1,1],[0,0,0,.5],[.42,0,.58,1],e.bezier][e.curve];l&&(a=[this.getLaneX(e.lane+.1),this.getYInCanvas(i)],r=[this.getLaneX(t.lane+.1),this.getYInCanvas(n)],o.beginFill(s?this.colors.critical:this.colors.slide,.8),o.moveTo(a[0],a[1]),o.bezierCurveTo(a[0]+l[0]*(r[0]-a[0]),a[1]+l[1]*(r[1]-a[1]),a[0]+l[2]*(r[0]-a[0]),a[1]+l[3]*(r[1]-a[1]),r[0],r[1]),o.lineTo(this.getLaneX(t.lane+t.width-.1),this.getYInCanvas(n)),r=[this.getLaneX(e.lane+e.width-.1),this.getYInCanvas(i)],a=[this.getLaneX(t.lane+t.width-.1),this.getYInCanvas(n)],[e,i,t,n]=l,l=[1-t,1-n,1-e,1-i],o.bezierCurveTo(a[0]+l[0]*(r[0]-a[0]),a[1]+l[1]*(r[1]-a[1]),a[0]+l[2]*(r[0]-a[0]),a[1]+l[3]*(r[1]-a[1]),r[0],r[1]),o.endFill()),this.container.slide.addChild(o)}drawInvisibleNote(e,t,i=!1){const n=new h.Graphics;n.name=`Invisible-${e.id}`,n.lineStyle(3*this.const.lineWidth,i?this.colors.criticalNote:this.colors.slideNote,1),n.moveTo(this.getLaneX(e.lane+.1),0),n.lineTo(this.getLaneX(e.lane+e.width-.1),0),n.y=this.getYInCanvas(t),this.container.slide.addChild(n)}drawVisibleNote(e,t,i){const n=new y(this.notes[`slide_node${i.critical?"_critical":""}`],e,i);n.name=`Visible-${e.id}`;i=this.const.noteHeight/n.height;n.scale.set(i),n.x=this.getLaneX(e.lane+e.width/2)-n.width/2,n.y=this.getYInCanvas(t)-n.height/2,n.on("click",this.slideClickHandler.bind(this)),this.container.slide.addChild(n)}drawSkippedVisibleNote(t,i,n,s){var o=this.getHeightByBeat(i.beat),r=t.notes[s],a=this.getHeightByBeat(r.beat),e=[!1,[0,0,1,1],[0,0,0,.5],[1,.5,1,1],[1,.5,0,.5],i.bezier][i.curve];const l=e&&w(e[0],e[1],e[2],e[3]);for(let e=n;e<s;e++){var h=t.notes[e],c=this.getHeightByBeat(h.beat);if(c>=this.scrollBottom-this.const.noteHeight&&c<=this.scrollBottom+this.const.height+this.const.noteHeight){var d=(c-o)/(a-o),d={id:h.id,type:u.SlideVisible,beat:h.beat,width:i.width+(r.width-i.width)*l(d),lane:i.lane+(r.lane-i.lane)*l(d)};this.drawVisibleNote(d,c,t),(this.selection.slide[t.id]?.includes(h.id)||this.tempSelection.slide[t.id]?.includes(h.id))&&this.drawSelectionRect(d,c)}else if(c>this.scrollBottom+this.const.height+this.const.noteHeight)break}}drawSlide(){for(let e=0;e<this.map.slides.length;e++){const a=this.map.slides[e];if(!(this.getHeightByBeat(a.notes[a.notes.length-1].beat)<this.scrollBottom)){if(this.getHeightByBeat(a.notes[0].beat)>this.scrollBottom+this.const.height+this.const.noteHeight)break;for(let i=0;i<a.notes.length;i++){var n,s=a.notes[i],o=a.notes[i+1],r=this.getHeightByBeat(s.beat);let e=o,t=i;o&&void 0===o.lane&&(t+=1+a.notes.slice(i+1).findIndex(e=>void 0!==e.lane),e=a.notes[t]),void 0!==s.lane&&e&&r<this.scrollBottom+this.const.height+this.const.noteHeight&&this.getHeightByBeat(e.beat)>this.scrollBottom-this.const.noteHeight&&(n=this.getHeightByBeat(e.beat),this.drawCurve(s,e,r,n,a.critical),void 0===o.lane&&this.drawSkippedVisibleNote(a,s,i+1,t)),r>=this.scrollBottom-this.const.noteHeight&&r<=this.scrollBottom+this.const.height+this.const.noteHeight&&([u.SlideStart,u.SlideEndDefault].includes(s.type)?this.drawBaseNote(s,a.critical?"critical":"slide",r,a):s.type===u.SlideEndFlick?(this.drawBaseNote(s,s.critical||a.critical?"critical":"flick",r,a),this.drawFlickArrow({...s,critical:s?.critical||a.critical},r)):s.type===u.SlideInvisible?this.drawInvisibleNote(s,r,a.critical):s.type===u.SlideVisible&&this.drawVisibleNote(s,r,a),(this.selection.slide[a.id]?.includes(s.id)||this.tempSelection.slide[a.id]?.includes(s.id))&&this.drawSelectionRect(s,r))}}}}drawSelectionRect(e,t){const i=new h.Graphics;i.name=`Selection-${e.id}`,i.lineStyle(4*this.const.lineWidth,this.colors.selection),i.drawRect(this.getLaneX(e.lane)-this.const.paddingX,this.getYInCanvas(t)-this.const.noteHeight/2,.06*this.const.width*e.width+2*this.const.paddingX,this.const.noteHeight),this.container.selection.addChild(i)}moveCursor(e,t){void 0!==e&&((e=this.getHeightByBeat(e))>this.const.maxHeight-this.const.spaceY||(t<0||11<t?this.container.cursor.visible=!1:(e=this.getYInCanvas(e),this.container.cursor.y=e,this.container.cursor.x=this.getLaneX(t-.1),this.container.cursor.visible=!0)))}drawNote(){for(let e=0;e<this.map.notes.length;e++){var t=this.map.notes[e],i=this.getHeightByBeat(t.beat);if(i>=this.scrollBottom-this.const.noteHeight&&i<=this.scrollBottom+this.const.height+this.const.noteHeight&&(t.type===u.Flick&&this.drawFlickArrow(t,i),this.drawBaseNote(t,t.critical?"critical":t.type?"flick":"tap",i),(this.selection.single.includes(t.id)||this.tempSelection.single.includes(t.id))&&this.drawSelectionRect(t,i)),i>this.scrollBottom+this.const.height+this.const.noteHeight)break}}isUniqueArrayEqual(e,t){return e.length===t.length&&e.every(e=>t.includes(e))}isSelectionEqual(t,i){if(!this.isUniqueArrayEqual(t.single,i.single))return!1;const e=Object.keys(t.slide);var n=Object.keys(i.slide);return!!this.isUniqueArrayEqual(e,n)&&e.every(e=>this.isUniqueArrayEqual(t.slide[e],i.slide[e]))}setMap(e){this.map=e,this.map.bpms=this.map.bpms.sort((e,t)=>this.minusBeat(e.beat,t.beat)),this.map.notes=this.map.notes.sort((e,t)=>this.minusBeat(e.beat,t.beat)),this.map.slides=this.map.slides.map(e=>({...e,notes:e.notes.sort((e,t)=>this.minusBeat(e.beat,t.beat))})).sort((e,t)=>this.minusBeat(e.notes[0].beat,t.notes[0].beat)),console.log(this.map)}getHeightPerSecond(){return this.const.heightPerSecond*this.resolution}setHeightPerSecond(e){var t;e<100||2e3<e||(t=(this.scrollBottom-this.const.spaceY)/this.const.heightPerSecond,this.const.heightPerSecond=e/this.resolution,this.const.spaceY=this.const.heightPerSecond/2.5,this.const.maxHeight=this.const.heightPerSecond*this.time+2*this.const.spaceY,this.scrollTo(t*this.const.heightPerSecond+this.const.spaceY),this.reRender())}getCurrentTime(){return this.currentTime}setCurrentTime(e){this.currentTime=e,this.reRender()}setBeatSlice(e){this.beatSlice=e}getCursorPosition(){var t=this.scrollBottom+this.const.height-this.lastMouseCursorPosition.y;let i=0,n=[0,0,1];var s=this.beatSlice;for(let e=0;;e++){var o=[Math.floor(e/s),e%s,s],r=this.getHeightByBeat(o);if(r<t)i=t-r,n=o;else if(t<=r){var a=r-t,r=this.lastMouseCursorPosition.x-this.getLaneX(0),r=Math.floor(r/(.06*this.const.width));return[a<i?o:n,r]}}}getConst(e){return this.const[e]}}var B=new Uint8Array(16);function E(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(B)}var T=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function C(e){return"string"==typeof e&&T.test(e)}for(var I,L,N=[],k=0;k<256;++k)N.push((k+256).toString(16).substr(1));function x(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,t=(N[e[t+0]]+N[e[t+1]]+N[e[t+2]]+N[e[t+3]]+"-"+N[e[t+4]]+N[e[t+5]]+"-"+N[e[t+6]]+N[e[t+7]]+"-"+N[e[t+8]]+N[e[t+9]]+"-"+N[e[t+10]]+N[e[t+11]]+N[e[t+12]]+N[e[t+13]]+N[e[t+14]]+N[e[t+15]]).toLowerCase();if(!C(t))throw TypeError("Stringified UUID is invalid");return t}var O=0,A=0;function M(e){if(!C(e))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i}function R(e,r,a){function t(e,t,i,n){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),16!==(t="string"==typeof t?M(t):t).length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(t),s.set(e,t.length),(s=a(s))[6]=15&s[6]|r,s[8]=63&s[8]|128,i){n=n||0;for(var o=0;o<16;++o)i[n+o]=s[o];return i}return x(s)}try{t.name=e}catch(e){}return t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t}function P(e){return 14+(e+64>>>9<<4)+1}function H(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function F(e,t,i,n,s,o){return H((o=H(H(t,e),H(n,o)))<<s|o>>>32-s,i)}function D(e,t,i,n,s,o,r){return F(t&i|~t&n,e,t,s,o,r)}function Y(e,t,i,n,s,o,r){return F(t&n|i&~n,e,t,s,o,r)}function U(e,t,i,n,s,o,r){return F(t^i^n,e,t,s,o,r)}function V(e,t,i,n,s,o,r){return F(i^(t|~n),e,t,s,o,r)}var X=R("v3",48,function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var i=0;i<t.length;++i)e[i]=t.charCodeAt(i)}return function(e){for(var t=[],i=32*e.length,n="0123456789abcdef",s=0;s<i;s+=8){var o=e[s>>5]>>>s%32&255,o=parseInt(n.charAt(o>>>4&15)+n.charAt(15&o),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[P(t)-1]=t;for(var i=1732584193,n=-271733879,s=-1732584194,o=271733878,r=0;r<e.length;r+=16){var a=i,l=n,h=s,c=o;i=D(i,n,s,o,e[r],7,-680876936),o=D(o,i,n,s,e[r+1],12,-389564586),s=D(s,o,i,n,e[r+2],17,606105819),n=D(n,s,o,i,e[r+3],22,-1044525330),i=D(i,n,s,o,e[r+4],7,-176418897),o=D(o,i,n,s,e[r+5],12,1200080426),s=D(s,o,i,n,e[r+6],17,-1473231341),n=D(n,s,o,i,e[r+7],22,-45705983),i=D(i,n,s,o,e[r+8],7,1770035416),o=D(o,i,n,s,e[r+9],12,-1958414417),s=D(s,o,i,n,e[r+10],17,-42063),n=D(n,s,o,i,e[r+11],22,-1990404162),i=D(i,n,s,o,e[r+12],7,1804603682),o=D(o,i,n,s,e[r+13],12,-40341101),s=D(s,o,i,n,e[r+14],17,-1502002290),n=D(n,s,o,i,e[r+15],22,1236535329),i=Y(i,n,s,o,e[r+1],5,-165796510),o=Y(o,i,n,s,e[r+6],9,-1069501632),s=Y(s,o,i,n,e[r+11],14,643717713),n=Y(n,s,o,i,e[r],20,-373897302),i=Y(i,n,s,o,e[r+5],5,-701558691),o=Y(o,i,n,s,e[r+10],9,38016083),s=Y(s,o,i,n,e[r+15],14,-660478335),n=Y(n,s,o,i,e[r+4],20,-405537848),i=Y(i,n,s,o,e[r+9],5,568446438),o=Y(o,i,n,s,e[r+14],9,-1019803690),s=Y(s,o,i,n,e[r+3],14,-187363961),n=Y(n,s,o,i,e[r+8],20,1163531501),i=Y(i,n,s,o,e[r+13],5,-1444681467),o=Y(o,i,n,s,e[r+2],9,-51403784),s=Y(s,o,i,n,e[r+7],14,1735328473),n=Y(n,s,o,i,e[r+12],20,-1926607734),i=U(i,n,s,o,e[r+5],4,-378558),o=U(o,i,n,s,e[r+8],11,-2022574463),s=U(s,o,i,n,e[r+11],16,1839030562),n=U(n,s,o,i,e[r+14],23,-35309556),i=U(i,n,s,o,e[r+1],4,-1530992060),o=U(o,i,n,s,e[r+4],11,1272893353),s=U(s,o,i,n,e[r+7],16,-155497632),n=U(n,s,o,i,e[r+10],23,-1094730640),i=U(i,n,s,o,e[r+13],4,681279174),o=U(o,i,n,s,e[r],11,-358537222),s=U(s,o,i,n,e[r+3],16,-722521979),n=U(n,s,o,i,e[r+6],23,76029189),i=U(i,n,s,o,e[r+9],4,-640364487),o=U(o,i,n,s,e[r+12],11,-421815835),s=U(s,o,i,n,e[r+15],16,530742520),n=U(n,s,o,i,e[r+2],23,-995338651),i=V(i,n,s,o,e[r],6,-198630844),o=V(o,i,n,s,e[r+7],10,1126891415),s=V(s,o,i,n,e[r+14],15,-1416354905),n=V(n,s,o,i,e[r+5],21,-57434055),i=V(i,n,s,o,e[r+12],6,1700485571),o=V(o,i,n,s,e[r+3],10,-1894986606),s=V(s,o,i,n,e[r+10],15,-1051523),n=V(n,s,o,i,e[r+1],21,-2054922799),i=V(i,n,s,o,e[r+8],6,1873313359),o=V(o,i,n,s,e[r+15],10,-30611744),s=V(s,o,i,n,e[r+6],15,-1560198380),n=V(n,s,o,i,e[r+13],21,1309151649),i=V(i,n,s,o,e[r+4],6,-145523070),o=V(o,i,n,s,e[r+11],10,-1120210379),s=V(s,o,i,n,e[r+2],15,718787259),n=V(n,s,o,i,e[r+9],21,-343485551),i=H(i,a),n=H(n,l),s=H(s,h),o=H(o,c)}return[i,n,s,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,i=new Uint32Array(P(t)),n=0;n<t;n+=8)i[n>>5]|=(255&e[n/8])<<n%32;return i}(e),8*e.length))});function $(e,t){return e<<t|e>>>32-t}var z=R("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var s=0;s<n.length;++s)e.push(n.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,r=Math.ceil(o/16),a=new Array(r),l=0;l<r;++l){for(var h=new Uint32Array(16),c=0;c<16;++c)h[c]=e[64*l+4*c]<<24|e[64*l+4*c+1]<<16|e[64*l+4*c+2]<<8|e[64*l+4*c+3];a[l]=h}a[r-1][14]=8*(e.length-1)/Math.pow(2,32),a[r-1][14]=Math.floor(a[r-1][14]),a[r-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<r;++d){for(var u=new Uint32Array(80),p=0;p<16;++p)u[p]=a[d][p];for(var m=16;m<80;++m)u[m]=$(u[m-3]^u[m-8]^u[m-14]^u[m-16],1);for(var g=i[0],v=i[1],f=i[2],y=i[3],w=i[4],b=0;b<80;++b)var S=Math.floor(b/20),S=$(g,5)+function(e,t,i,n){switch(e){case 0:return t&i^~t&n;case 1:return t^i^n;case 2:return t&i^t&n^i&n;case 3:return t^i^n}}(S,v,f,y)+w+t[S]+u[b]>>>0,w=y,y=f,f=$(v,30)>>>0,v=g,g=S;i[0]=i[0]+g>>>0,i[1]=i[1]+v>>>0,i[2]=i[2]+f>>>0,i[3]=i[3]+y>>>0,i[4]=i[4]+w>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]});var _=t(Object.freeze({__proto__:null,v1:function(e,t,i){var n=t&&i||0,s=t||new Array(16),o=(e=e||{}).node||I,r=void 0!==e.clockseq?e.clockseq:L;null!=o&&null!=r||(l=e.random||(e.rng||E)(),null==o&&(o=I=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==r&&(r=L=16383&(l[6]<<8|l[7])));var a=void 0!==e.msecs?e.msecs:Date.now(),i=void 0!==e.nsecs?e.nsecs:A+1,l=a-O+(i-A)/1e4;if(l<0&&void 0===e.clockseq&&(r=r+1&16383),1e4<=(i=(l<0||O<a)&&void 0===e.nsecs?0:i))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");O=a,L=r,i=(1e4*(268435455&(a+=122192928e5))+(A=i))%4294967296,s[n++]=i>>>24&255,s[n++]=i>>>16&255,s[n++]=i>>>8&255,s[n++]=255&i,a=a/4294967296*1e4&268435455,s[n++]=a>>>8&255,s[n++]=255&a,s[n++]=a>>>24&15|16,s[n++]=a>>>16&255,s[n++]=r>>>8|128,s[n++]=255&r;for(var h=0;h<6;++h)s[n+h]=o[h];return t||x(s)},v3:X,v4:function(e,t,i){var n=(e=e||{}).random||(e.rng||E)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var s=0;s<16;++s)t[i+s]=n[s];return t}return x(n)},v5:z,NIL:"00000000-0000-0000-0000-000000000000",version:function(e){if(!C(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)},validate:C,stringify:x,parse:M})),G={},j={};Object.defineProperty(j,"__esModule",{value:!0});const W=[{TEXT:"BASIC",COLOR:"#19aa19",BACKGROUND:"#e8f6e8"},{TEXT:"ADVANCED",COLOR:"#f55000",BACKGROUND:"#feede5"},{TEXT:"EXPERT",COLOR:"#a00a50",BACKGROUND:"#F5E6ED"},{TEXT:"MASTER",COLOR:"#8200dc",BACKGROUND:"#f2e5fb"},{TEXT:"WORLD'S END",COLOR:"#000000",BACKGROUND:"#e5e5e5"}],q=["SONGID","TITLE","ARTIST","DESIGNER","DIFFICULTY","PLAYLEVEL","WAVE","WAVEOFFSET","JACKET","BACKGROUND","MOVIE","MOVIEOFFSET","BASEBPM"],K=["SONGID","TITLE","ARTIST","DESIGNER","DIFFICULTY","PLAYLEVEL"],J=["ARTIST","BACKGROUND","DESIGNER","JACKET","MOVIE","SONGID","TITLE","WAVE"],Z=["BASEBPM","MOVIEOFFSET","WAVEOFFSET"];function Q(e){return e.split("\n").filter(e=>"#"===e.slice(0,1)).map(e=>e.slice(1)).filter(e=>!e.match(/^\d{3}/)).reduce((e,t)=>{var i,n=t.slice(0,t.indexOf(" ")).trim().toUpperCase();return i=n,-1<q.indexOf(i)&&(t={key:n,value:t.slice(t.indexOf(" ")+1,t.length).trim()},e.push(t)),e},[]).map(e=>(e.value=e.value.match(/^".*"$/)?e.value.slice(1,e.value.length-1):e.value,e)).filter(e=>e.value).reduce((e,t)=>{if(-1<J.indexOf(t.key)&&(e[t.key]=t.value),-1<Z.indexOf(t.key)&&Number(t.value)&&(e[t.key]=Number(t.value)),"DIFFICULTY"===t.key){var i=Number(t.value.slice(0,1));if(isNaN(i)||Number(i)<0||4<Number(i))return e;e.DIFFICULTY=Object.assign({},W[i],{LEVEL:Number(i),MARK:4===Number(i)?1!==t.value.length?`${t.value}:`.split(":")[1]:"":void 0})}if("PLAYLEVEL"===t.key){if(!Number(t.value)&&!Number(t.value.slice(0,-1)))return e;e.PLAYLEVEL={LEVEL:Number(t.value)||Number(t.value.slice(0,-1)),PLUS:/\+$/.test(t.value),TEXT:t.value}}return e},{})}j.getMeta=Q,j.validate=function(e){const t=Q(e),i=K.slice();return null!=t.WAVE&&i.push("WAVEOFFSET"),null!=t.MOVIE&&i.push("MOVIEOFFSET"),null!=t.DIFFICULTY&&4===t.DIFFICULTY.LEVEL&&i.splice(i.indexOf("PLAYLEVEL"),1),{MISSING_META:e=i.filter(e=>!t.hasOwnProperty(e)),VALIDITY:0===e.length}};var ee,X={};Object.defineProperty(X,"__esModule",{value:!0});const te=j;function ie(e,t,i,n){return e.filter(e=>e.match(t)).reduce((e,t)=>(e[Number(t.slice(i,n))]=Number(t.split(":")[1].trim()),e),[])}function ne(s,e){return[...Array(e)].reduce((e,t,i)=>{let n=i;for(;e[i]=s[n--],void 0===e[i];);return e},[])}function se(e,n){const s=[];return e.filter(e=>e.laneType===n).reduce((e,t)=>(e[t.measure]=e[t.measure]||[],e[t.measure][t.tick]=e[t.measure][t.tick]||[],e[t.measure][t.tick].push(t),e),[]).reduce((i,e)=>(e.forEach(e=>{e.filter(e=>2===e.noteType).forEach(e=>{var t=2===n?e.lane:0;e.channel&&s[t]&&s[t][e.channel]&&(s[t][e.channel].push(e),i.push(s[t][e.channel]),delete s[t][e.channel])}),e.filter(e=>1===e.noteType).forEach(e=>{var t=2===n?e.lane:0;e.channel&&(s[t]=s[t]||[],s[t][e.channel]=[],s[t][e.channel].push(e))}),e.filter(e=>-1<[3,4,5].indexOf(e.noteType)).forEach(e=>{var t=2===n?e.lane:0;e.channel&&s[t]&&s[t][e.channel]&&s[t][e.channel].push(e)})}),i),[])}function oe(e){for(var t in e)ee.hasOwnProperty(t)||(ee[t]=e[t])}X.getScore=function(e,t=192){const i=e.split("\n").filter(e=>"#"===e.slice(0,1)).map(e=>e.slice(1));var n,r,a,s=i.filter(e=>e.match(/^\d{3}[1-5][0-9a-fA-F][0-9a-zA-Z]?:/)).map(e=>Number(e.slice(0,3))).reduce((e,t)=>t<e?e:t,0)+1,o=function(e,t){const i=ie(e,/^\d{3}02:/,0,3);return i[0]=Number.isFinite(i[0])?i[0]:4,ne(i,t)}(i,s);const l=(n=i,r=t,a=o,n.filter(e=>e.match(/^\d{3}[1-5][0-9a-fA-F][0-9a-zA-Z]?:(\s*[0-9a-zA-Z][0-9a-gA-G])+\s*$/)).map(e=>e.split(":",2)).reduce((t,n)=>{const s=n[1].trim().replace(/ /g,""),o=Number(n[0].slice(0,3));return[...Array(s.length/2)].map((e,t)=>{const i={lane:parseInt(n[0].slice(4,5),16),laneType:Number(n[0].slice(3,4)),measure:o,noteType:parseInt(s[2*t],36),tick:Math.round(r*a[o]/(s.length/2)*t),width:parseInt(s[2*t+1],17)};return 6===n[0].length&&(i.channel=n[0].slice(5,6).toUpperCase().charCodeAt(0)),i}).filter(e=>0!==e.width).forEach(e=>t.push(e)),t},[]));return{BEATs:o,BPMs:function(e,t,i=120){const n=ie(e,/^BPM\d{2}:/,3,5),s=ie(e,/^\d{3}08:/,0,3).map(e=>{if(n[e])return n[e]});return s[0]=Number(s[0])?s[0]:i,ne(s,t)}(i,s,te.getMeta(e).BASEBPM),airActionNotes:se(l,4),airNotes:l.filter(e=>5===e.laneType),holdNotes:se(l,2),measure:s,shortNotes:l.filter(e=>1===e.laneType),slideNotes:se(l,3)}},ee=G,Object.defineProperty(ee,"__esModule",{value:!0}),oe(j),oe(X);z={};j=z,Object.defineProperty(j,"__esModule",{value:!0}),j.FlickDirection=j.CurveType=j.NoteType=void 0,(X=j.NoteType||(j.NoteType={}))[X.Tap=0]="Tap",X[X.Flick=1]="Flick",X[X.SlideStart=2]="SlideStart",X[X.SlideInvisible=3]="SlideInvisible",X[X.SlideVisible=4]="SlideVisible",X[X.SlideEndDefault=5]="SlideEndDefault",X[X.SlideEndFlick=6]="SlideEndFlick",(X=j.CurveType||(j.CurveType={}))[X.None=0]="None",X[X.Linear=1]="Linear",X[X.EaseIn=2]="EaseIn",X[X.EaseOut=3]="EaseOut",X[X.EaseInOut=4]="EaseInOut",X[X.CubicBezier=5]="CubicBezier",(j=j.FlickDirection||(j.FlickDirection={}))[j.Up=0]="Up",j[j.Left=1]="Left",j[j.Right=2]="Right";const re=_["v4"],ae=G,{NoteType:le,CurveType:he,FlickDirection:ce}=z;function de(e,t){return ae.getScore(e,t)}function ue(e,t){return e.measure===t.measure&&e.tick===t.tick&&e.lane===t.lane&&e.width===t.width}function pe(e,t,i){var n=function(e,t){if(0===e||0===t)return 1;for(;0!==t;){var i=t;t=e%t,e=i}return e}(t%i,i);return[4*e+Math.floor(t/i),t%i/n,t?i/n:1]}var z={convertor:function(e){const a=de(e,480),n=re(),s={timelines:[{id:n,name:"Timeline 1"}],bpms:[{id:re(),timeline:n,beat:[0,0,1],bpm:a.BPMs[0]}],notes:[],slides:[]};return a.slideNotes.forEach(e=>{const r={id:re(),timeline:n,notes:[]};e.forEach((t,e)=>{var i=a.airNotes.findIndex(e=>ue(t,e)),n=a.shortNotes.findIndex(e=>3===e.noteType&&ue(t,e)),s=a.shortNotes.findIndex(e=>ue(t,e));const o={id:re(),type:{1:le.SlideStart,2:le.SlideEndDefault,3:le.SlideVisible,5:le.SlideInvisible}[t.noteType],beat:pe(t.measure,t.tick,480),lane:t.lane-2,width:t.width,curve:he.Linear};0===e&&-1!==s&&2===a.shortNotes[s].noteType?(a.shortNotes.splice(s,1),r.critical=!0):o.type===le.SlideEndDefault&&-1!==i?([e]=a.airNotes.splice(i,1),o.type=le.SlideEndFlick,o.direction=3===e.noteType?ce.Left:4===e.noteType?ce.Right:ce.Up,-1!==s&&([e]=a.shortNotes.splice(s,1),2===e.noteType&&(o.critical=!0))):-1!==i&&-1!==s&&(a.shortNotes.splice(s,1),[i]=a.airNotes.splice(i,1),o.curve={2:he.EaseOut,5:he.EaseIn,6:he.EaseIn}[i.noteType]),-1!==n&&o.type===le.SlideVisible&&(a.shortNotes.splice(n,1),delete o.width,delete o.lane,delete o.curve),r.notes.push(o)}),s.slides.push(r)}),a.shortNotes.forEach(t=>{if(!(t.lane<2||13<t.lane)){var e=a.airNotes.find(e=>ue(e,t));const i={id:re(),timeline:n,type:e?le.Flick:le.Tap,beat:pe(t.measure,t.tick,480),lane:t.lane-2,width:t.width};2===t.noteType&&(i.critical=!0),e&&(i.direction=3===e.noteType?ce.Left:4===e.noteType?ce.Right:ce.Up),s.notes.push(i)}}),s}}["convertor"],me=z;var ge,ve,fe,ye;ge="* {\n\tmargin: 0;\n}\n\nhtml, body {\n\twidth: 100%;\n\theight: 100%;\n}\n\nbody {\n\tuser-select: none;\n}\n\n#selector {\n\theight: 50px;\n\tposition: relative;\n}\n\n#app {\n\theight: calc(100% - 50px);\n\tmax-width: 600px;\n}\n",ye=(ve=void 0===ve?{}:ve).insertAt,ge&&"undefined"!=typeof document&&(fe=document.head||document.getElementsByTagName("head")[0],(ve=document.createElement("style")).type="text/css","top"===ye&&fe.firstChild?fe.insertBefore(ve,fe.firstChild):fe.appendChild(ve),ve.styleSheet?ve.styleSheet.cssText=ge:ve.appendChild(document.createTextNode(ge))),function(){document.addEventListener("DOMContentLoaded",async function(){console.log("ready");const e=document.getElementById("add"),t=document.getElementById("minus"),i=document.getElementById("id"),n=document.getElementById("diff"),s=document.getElementById("load"),o=document.getElementById("bottom"),r=document.getElementById("scroll"),a=document.getElementById("input"),l=document.getElementById("container"),h=document.getElementById("text"),c=document.getElementById("draw");function d(e){var t;null!==v&&(t=v.getHeightPerSecond(),v.setHeightPerSecond("+"===e?t+(t<1e3?100:200):t-100))}e.addEventListener("click",()=>{d("+")}),t.addEventListener("click",()=>{d("-")}),a.addEventListener("click",()=>{l.style.display="none"===l.style.display?"block":"none"}),c.addEventListener("click",()=>{l.style.display="none";var e=me(h.value);null!==v&&(v.destroy(),v=null),v=new S(document.getElementById("app"),e,180),v.event.addEventListener("scroll",e=>{o.value=e.detail.scrollBottom}),v.scrollTo(0)}),await S.loadResource((e,t)=>{console.log(`${e.progress}% loading: ${t.url}`)}),r.addEventListener("click",()=>{var e=parseInt(o.value);v&&v.scrollTo(e)}),s.addEventListener("click",async()=>{const e=await fetch(`https://assets.pjsek.ai/file/pjsekai-assets/startapp/music/music_score/${i.value.padStart(4,"0")}_01/${n.value}`);var t=me(await e.text());null!==v&&(v.destroy(),v=null),v=new S(document.getElementById("app"),t,180),v.event.addEventListener(f.Scroll,e=>{o.value=e.detail.newScrollBottom.toString()}),v.scrollTo(0)}),i.value="135",s.click();const u=document.getElementById("music"),p=document.getElementById("audio"),m=document.getElementById("follow");u.addEventListener("input",()=>{var e=u.files[0],e=URL.createObjectURL(e);p.src=e});let g=null;p.addEventListener("play",()=>{g=setInterval(()=>{null!==v&&(v.setCurrentTime(p.currentTime),m.checked&&v.scrollTo(v.getHeightByTime(p.currentTime)-v.getConst("spaceY")))},16)}),p.addEventListener("pause",()=>{clearInterval(g)})});let v=null}()}(PIXI);
