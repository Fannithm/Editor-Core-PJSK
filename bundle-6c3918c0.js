!function(e){"use strict";function t(i){if(i&&i.__esModule)return i;var r=Object.create(null);return i&&Object.keys(i).forEach(function(e){var t;"default"!==e&&(t=Object.getOwnPropertyDescriptor(i,e),Object.defineProperty(r,e,t.get?t:{enumerable:!0,get:function(){return i[e]}}))}),r.default=i,Object.freeze(r)}var a=t(e);function p(e,n,a,l){return new(a=a||Promise)(function(i,t){function r(e){try{o(l.next(e))}catch(e){t(e)}}function s(e){try{o(l.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof a?t:new a(function(e){e(t)})).then(r,s)}o((l=l.apply(e,n||[])).next())})}var i,r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(i){if(i.__esModule)return i;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(e){var t=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(r,e,t.get?t:{enumerable:!0,get:function(){return i[e]}})}),r}var o=new Uint8Array(16);function c(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(o)}var n=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function l(e){return"string"==typeof e&&n.test(e)}for(var h,u,d=[],g=0;g<256;++g)d.push((g+256).toString(16).substr(1));function m(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,t=(d[e[t+0]]+d[e[t+1]]+d[e[t+2]]+d[e[t+3]]+"-"+d[e[t+4]]+d[e[t+5]]+"-"+d[e[t+6]]+d[e[t+7]]+"-"+d[e[t+8]]+d[e[t+9]]+"-"+d[e[t+10]]+d[e[t+11]]+d[e[t+12]]+d[e[t+13]]+d[e[t+14]]+d[e[t+15]]).toLowerCase();if(!l(t))throw TypeError("Stringified UUID is invalid");return t}var v=0,f=0;function b(e){if(!l(e))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i}function y(e,n,a){function t(e,t,i,r){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),16!==(t="string"==typeof t?b(t):t).length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(t),s.set(e,t.length),(s=a(s))[6]=15&s[6]|n,s[8]=63&s[8]|128,i){r=r||0;for(var o=0;o<16;++o)i[r+o]=s[o];return i}return m(s)}try{t.name=e}catch(e){}return t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t}function M(e){return 14+(e+64>>>9<<4)+1}function w(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function S(e,t,i,r,s,o){return w((o=w(w(t,e),w(r,o)))<<s|o>>>32-s,i)}function C(e,t,i,r,s,o,n){return S(t&i|~t&r,e,t,s,o,n)}function L(e,t,i,r,s,o,n){return S(t&r|i&~r,e,t,s,o,n)}function T(e,t,i,r,s,o,n){return S(t^i^r,e,t,s,o,n)}function O(e,t,i,r,s,o,n){return S(i^(t|~r),e,t,s,o,n)}var H=y("v3",48,function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var i=0;i<t.length;++i)e[i]=t.charCodeAt(i)}return function(e){for(var t=[],i=32*e.length,r="0123456789abcdef",s=0;s<i;s+=8){var o=e[s>>5]>>>s%32&255,o=parseInt(r.charAt(o>>>4&15)+r.charAt(15&o),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[M(t)-1]=t;for(var i=1732584193,r=-271733879,s=-1732584194,o=271733878,n=0;n<e.length;n+=16){var a=i,l=r,d=s,c=o;i=C(i,r,s,o,e[n],7,-680876936),o=C(o,i,r,s,e[n+1],12,-389564586),s=C(s,o,i,r,e[n+2],17,606105819),r=C(r,s,o,i,e[n+3],22,-1044525330),i=C(i,r,s,o,e[n+4],7,-176418897),o=C(o,i,r,s,e[n+5],12,1200080426),s=C(s,o,i,r,e[n+6],17,-1473231341),r=C(r,s,o,i,e[n+7],22,-45705983),i=C(i,r,s,o,e[n+8],7,1770035416),o=C(o,i,r,s,e[n+9],12,-1958414417),s=C(s,o,i,r,e[n+10],17,-42063),r=C(r,s,o,i,e[n+11],22,-1990404162),i=C(i,r,s,o,e[n+12],7,1804603682),o=C(o,i,r,s,e[n+13],12,-40341101),s=C(s,o,i,r,e[n+14],17,-1502002290),r=C(r,s,o,i,e[n+15],22,1236535329),i=L(i,r,s,o,e[n+1],5,-165796510),o=L(o,i,r,s,e[n+6],9,-1069501632),s=L(s,o,i,r,e[n+11],14,643717713),r=L(r,s,o,i,e[n],20,-373897302),i=L(i,r,s,o,e[n+5],5,-701558691),o=L(o,i,r,s,e[n+10],9,38016083),s=L(s,o,i,r,e[n+15],14,-660478335),r=L(r,s,o,i,e[n+4],20,-405537848),i=L(i,r,s,o,e[n+9],5,568446438),o=L(o,i,r,s,e[n+14],9,-1019803690),s=L(s,o,i,r,e[n+3],14,-187363961),r=L(r,s,o,i,e[n+8],20,1163531501),i=L(i,r,s,o,e[n+13],5,-1444681467),o=L(o,i,r,s,e[n+2],9,-51403784),s=L(s,o,i,r,e[n+7],14,1735328473),r=L(r,s,o,i,e[n+12],20,-1926607734),i=T(i,r,s,o,e[n+5],4,-378558),o=T(o,i,r,s,e[n+8],11,-2022574463),s=T(s,o,i,r,e[n+11],16,1839030562),r=T(r,s,o,i,e[n+14],23,-35309556),i=T(i,r,s,o,e[n+1],4,-1530992060),o=T(o,i,r,s,e[n+4],11,1272893353),s=T(s,o,i,r,e[n+7],16,-155497632),r=T(r,s,o,i,e[n+10],23,-1094730640),i=T(i,r,s,o,e[n+13],4,681279174),o=T(o,i,r,s,e[n],11,-358537222),s=T(s,o,i,r,e[n+3],16,-722521979),r=T(r,s,o,i,e[n+6],23,76029189),i=T(i,r,s,o,e[n+9],4,-640364487),o=T(o,i,r,s,e[n+12],11,-421815835),s=T(s,o,i,r,e[n+15],16,530742520),r=T(r,s,o,i,e[n+2],23,-995338651),i=O(i,r,s,o,e[n],6,-198630844),o=O(o,i,r,s,e[n+7],10,1126891415),s=O(s,o,i,r,e[n+14],15,-1416354905),r=O(r,s,o,i,e[n+5],21,-57434055),i=O(i,r,s,o,e[n+12],6,1700485571),o=O(o,i,r,s,e[n+3],10,-1894986606),s=O(s,o,i,r,e[n+10],15,-1051523),r=O(r,s,o,i,e[n+1],21,-2054922799),i=O(i,r,s,o,e[n+8],6,1873313359),o=O(o,i,r,s,e[n+15],10,-30611744),s=O(s,o,i,r,e[n+6],15,-1560198380),r=O(r,s,o,i,e[n+13],21,1309151649),i=O(i,r,s,o,e[n+4],6,-145523070),o=O(o,i,r,s,e[n+11],10,-1120210379),s=O(s,o,i,r,e[n+2],15,718787259),r=O(r,s,o,i,e[n+9],21,-343485551),i=w(i,a),r=w(r,l),s=w(s,d),o=w(o,c)}return[i,r,s,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,i=new Uint32Array(M(t)),r=0;r<t;r+=8)i[r>>5]|=(255&e[r/8])<<r%32;return i}(e),8*e.length))});function x(e,t,i){var r=(e=e||{}).random||(e.rng||c)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){i=i||0;for(var s=0;s<16;++s)t[i+s]=r[s];return t}return m(r)}function E(e,t){return e<<t|e>>>32-t}var j=y("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var r=unescape(encodeURIComponent(e));e=[];for(var s=0;s<r.length;++s)e.push(r.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,n=Math.ceil(o/16),a=new Array(n),l=0;l<n;++l){for(var d=new Uint32Array(16),c=0;c<16;++c)d[c]=e[64*l+4*c]<<24|e[64*l+4*c+1]<<16|e[64*l+4*c+2]<<8|e[64*l+4*c+3];a[l]=d}a[n-1][14]=8*(e.length-1)/Math.pow(2,32),a[n-1][14]=Math.floor(a[n-1][14]),a[n-1][15]=8*(e.length-1)&4294967295;for(var h=0;h<n;++h){for(var u=new Uint32Array(80),p=0;p<16;++p)u[p]=a[h][p];for(var g=16;g<80;++g)u[g]=E(u[g-3]^u[g-8]^u[g-14]^u[g-16],1);for(var m=i[0],v=i[1],f=i[2],b=i[3],y=i[4],M=0;M<80;++M)var w=Math.floor(M/20),w=E(m,5)+function(e,t,i,r){switch(e){case 0:return t&i^~t&r;case 1:return t^i^r;case 2:return t&i^t&r^i&r;case 3:return t^i^r}}(w,v,f,b)+y+t[w]+u[M]>>>0,y=b,b=f,f=E(v,30)>>>0,v=m,m=w;i[0]=i[0]+m>>>0,i[1]=i[1]+v>>>0,i[2]=i[2]+f>>>0,i[3]=i[3]+b>>>0,i[4]=i[4]+y>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]});var _=s(Object.freeze({__proto__:null,v1:function(e,t,i){var r=t&&i||0,s=t||new Array(16),o=(e=e||{}).node||h,n=void 0!==e.clockseq?e.clockseq:u;null!=o&&null!=n||(l=e.random||(e.rng||c)(),null==o&&(o=h=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==n&&(n=u=16383&(l[6]<<8|l[7])));var a=void 0!==e.msecs?e.msecs:Date.now(),i=void 0!==e.nsecs?e.nsecs:f+1,l=a-v+(i-f)/1e4;if(l<0&&void 0===e.clockseq&&(n=n+1&16383),1e4<=(i=(l<0||v<a)&&void 0===e.nsecs?0:i))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");v=a,u=n,i=(1e4*(268435455&(a+=122192928e5))+(f=i))%4294967296,s[r++]=i>>>24&255,s[r++]=i>>>16&255,s[r++]=i>>>8&255,s[r++]=255&i,a=a/4294967296*1e4&268435455,s[r++]=a>>>8&255,s[r++]=255&a,s[r++]=a>>>24&15|16,s[r++]=a>>>16&255,s[r++]=n>>>8|128,s[r++]=255&n;for(var d=0;d<6;++d)s[r+d]=o[d];return t||m(s)},v3:H,v4:x,v5:j,NIL:"00000000-0000-0000-0000-000000000000",version:function(e){if(!l(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)},validate:l,stringify:m,parse:b})),N={},k={};Object.defineProperty(k,"__esModule",{value:!0});const B=[{TEXT:"BASIC",COLOR:"#19aa19",BACKGROUND:"#e8f6e8"},{TEXT:"ADVANCED",COLOR:"#f55000",BACKGROUND:"#feede5"},{TEXT:"EXPERT",COLOR:"#a00a50",BACKGROUND:"#F5E6ED"},{TEXT:"MASTER",COLOR:"#8200dc",BACKGROUND:"#f2e5fb"},{TEXT:"WORLD'S END",COLOR:"#000000",BACKGROUND:"#e5e5e5"}],I=["SONGID","TITLE","ARTIST","DESIGNER","DIFFICULTY","PLAYLEVEL","WAVE","WAVEOFFSET","JACKET","BACKGROUND","MOVIE","MOVIEOFFSET","BASEBPM"],P=["SONGID","TITLE","ARTIST","DESIGNER","DIFFICULTY","PLAYLEVEL"],A=["ARTIST","BACKGROUND","DESIGNER","JACKET","MOVIE","SONGID","TITLE","WAVE"],R=["BASEBPM","MOVIEOFFSET","WAVEOFFSET"];function W(e){return e.split("\n").filter(e=>"#"===e.slice(0,1)).map(e=>e.slice(1)).filter(e=>!e.match(/^\d{3}/)).reduce((e,t)=>{var i,r=t.slice(0,t.indexOf(" ")).trim().toUpperCase();return i=r,-1<I.indexOf(i)&&(t={key:r,value:t.slice(t.indexOf(" ")+1,t.length).trim()},e.push(t)),e},[]).map(e=>(e.value=e.value.match(/^".*"$/)?e.value.slice(1,e.value.length-1):e.value,e)).filter(e=>e.value).reduce((e,t)=>{if(-1<A.indexOf(t.key)&&(e[t.key]=t.value),-1<R.indexOf(t.key)&&Number(t.value)&&(e[t.key]=Number(t.value)),"DIFFICULTY"===t.key){var i=Number(t.value.slice(0,1));if(isNaN(i)||Number(i)<0||4<Number(i))return e;e.DIFFICULTY=Object.assign({},B[i],{LEVEL:Number(i),MARK:4===Number(i)?1!==t.value.length?`${t.value}:`.split(":")[1]:"":void 0})}if("PLAYLEVEL"===t.key){if(!Number(t.value)&&!Number(t.value.slice(0,-1)))return e;e.PLAYLEVEL={LEVEL:Number(t.value)||Number(t.value.slice(0,-1)),PLUS:/\+$/.test(t.value),TEXT:t.value}}return e},{})}k.getMeta=W,k.validate=function(e){const t=W(e),i=P.slice();return null!=t.WAVE&&i.push("WAVEOFFSET"),null!=t.MOVIE&&i.push("MOVIEOFFSET"),null!=t.DIFFICULTY&&4===t.DIFFICULTY.LEVEL&&i.splice(i.indexOf("PLAYLEVEL"),1),{MISSING_META:e=i.filter(e=>!t.hasOwnProperty(e)),VALIDITY:0===e.length}};var D,H={};Object.defineProperty(H,"__esModule",{value:!0});const Y=k;function F(e,t,i,r){return e.filter(e=>e.match(t)).reduce((e,t)=>(e[Number(t.slice(i,r))]=Number(t.split(":")[1].trim()),e),[])}function U(s,e){return[...Array(e)].reduce((e,t,i)=>{let r=i;for(;e[i]=s[r--],void 0===e[i];);return e},[])}function X(e,r){const s=[];return e.filter(e=>e.laneType===r).reduce((e,t)=>(e[t.measure]=e[t.measure]||[],e[t.measure][t.tick]=e[t.measure][t.tick]||[],e[t.measure][t.tick].push(t),e),[]).reduce((i,e)=>(e.forEach(e=>{e.filter(e=>2===e.noteType).forEach(e=>{var t=2===r?e.lane:0;e.channel&&s[t]&&s[t][e.channel]&&(s[t][e.channel].push(e),i.push(s[t][e.channel]),delete s[t][e.channel])}),e.filter(e=>1===e.noteType).forEach(e=>{var t=2===r?e.lane:0;e.channel&&(s[t]=s[t]||[],s[t][e.channel]=[],s[t][e.channel].push(e))}),e.filter(e=>-1<[3,4,5].indexOf(e.noteType)).forEach(e=>{var t=2===r?e.lane:0;e.channel&&s[t]&&s[t][e.channel]&&s[t][e.channel].push(e)})}),i),[])}function V(e){for(var t in e)D.hasOwnProperty(t)||(D[t]=e[t])}H.getScore=function(e,t=192){const i=e.split("\n").filter(e=>"#"===e.slice(0,1)).map(e=>e.slice(1));var r,n,a,s=i.filter(e=>e.match(/^\d{3}[1-5][0-9a-fA-F][0-9a-zA-Z]?:/)).map(e=>Number(e.slice(0,3))).reduce((e,t)=>t<e?e:t,0)+1,o=function(e,t){const i=F(e,/^\d{3}02:/,0,3);return i[0]=Number.isFinite(i[0])?i[0]:4,U(i,t)}(i,s);const l=(r=i,n=t,a=o,r.filter(e=>e.match(/^\d{3}[1-5][0-9a-fA-F][0-9a-zA-Z]?:(\s*[0-9a-zA-Z][0-9a-gA-G])+\s*$/)).map(e=>e.split(":",2)).reduce((t,r)=>{const s=r[1].trim().replace(/ /g,""),o=Number(r[0].slice(0,3));return[...Array(s.length/2)].map((e,t)=>{const i={lane:parseInt(r[0].slice(4,5),16),laneType:Number(r[0].slice(3,4)),measure:o,noteType:parseInt(s[2*t],36),tick:Math.round(n*a[o]/(s.length/2)*t),width:parseInt(s[2*t+1],17)};return 6===r[0].length&&(i.channel=r[0].slice(5,6).toUpperCase().charCodeAt(0)),i}).filter(e=>0!==e.width).forEach(e=>t.push(e)),t},[]));return{BEATs:o,BPMs:function(e,t,i=120){const r=F(e,/^BPM\d{2}:/,3,5),s=F(e,/^\d{3}08:/,0,3).map(e=>{if(r[e])return r[e]});return s[0]=Number(s[0])?s[0]:i,U(s,t)}(i,s,Y.getMeta(e).BASEBPM),airActionNotes:X(l,4),airNotes:l.filter(e=>5===e.laneType),holdNotes:X(l,2),measure:s,shortNotes:l.filter(e=>1===e.laneType),slideNotes:X(l,3)}},D=N,Object.defineProperty(D,"__esModule",{value:!0}),V(k),V(H);var z={};j=z,Object.defineProperty(j,"__esModule",{value:!0}),j.FlickDirection=j.CurveType=j.NoteType=void 0,(k=j.NoteType||(j.NoteType={}))[k.Tap=0]="Tap",k[k.Flick=1]="Flick",k[k.SlideStart=2]="SlideStart",k[k.SlideInvisible=3]="SlideInvisible",k[k.SlideVisible=4]="SlideVisible",k[k.SlideEndDefault=5]="SlideEndDefault",k[k.SlideEndFlick=6]="SlideEndFlick",(k=j.CurveType||(j.CurveType={}))[k.None=0]="None",k[k.Linear=1]="Linear",k[k.EaseIn=2]="EaseIn",k[k.EaseOut=3]="EaseOut",k[k.EaseInOut=4]="EaseInOut",k[k.CubicBezier=5]="CubicBezier",(j=j.FlickDirection||(j.FlickDirection={}))[j.Up=0]="Up",j[j.Left=1]="Left",j[j.Right=2]="Right";const K=_["v4"],$=N,{NoteType:J,CurveType:G,FlickDirection:q}=z;function Z(e,t){return $.getScore(e,t)}function Q(e,t){return e.measure===t.measure&&e.tick===t.tick&&e.lane===t.lane&&e.width===t.width}function ee(e,t,i){var r=function(e,t){if(0===e||0===t)return Math.max(e,t,1);for(;0!==t;){var i=t;t=e%t,e=i}return e}(t%i,i);return[4*e+Math.floor(t/i),t%i/r,t?i/r:1]}var H={convertor:function(e){const a=Z(e,480),r=K(),s={timelines:[{id:r,name:"Timeline 1"}],bpms:[{id:K(),timeline:r,beat:[0,0,1],bpm:a.BPMs[0]}],notes:[],slides:[]};return a.slideNotes.forEach(e=>{const n={id:K(),timeline:r,notes:[]};e.forEach((t,e)=>{var i=a.airNotes.findIndex(e=>Q(t,e)),r=a.shortNotes.findIndex(e=>3===e.noteType&&Q(t,e)),s=a.shortNotes.findIndex(e=>Q(t,e));const o={id:K(),type:{1:J.SlideStart,2:J.SlideEndDefault,3:J.SlideVisible,5:J.SlideInvisible}[t.noteType],beat:ee(t.measure,t.tick,480),lane:t.lane-2,width:t.width,curve:G.Linear};0===e&&-1!==s&&2===a.shortNotes[s].noteType?(a.shortNotes.splice(s,1),n.critical=!0):o.type===J.SlideEndDefault&&-1!==i?([e]=a.airNotes.splice(i,1),o.type=J.SlideEndFlick,o.direction=3===e.noteType?q.Left:4===e.noteType?q.Right:q.Up,-1!==s&&([e]=a.shortNotes.splice(s,1),2===e.noteType&&(o.critical=!0))):-1!==i&&-1!==s&&(a.shortNotes.splice(s,1),[i]=a.airNotes.splice(i,1),o.curve={2:G.EaseIn,5:G.EaseOut,6:G.EaseOut}[i.noteType]),-1!==r&&o.type===J.SlideVisible&&(a.shortNotes.splice(r,1),delete o.width,delete o.lane,delete o.curve),n.notes.push(o)}),s.slides.push(n)}),a.shortNotes.forEach(t=>{if(!(t.lane<2||13<t.lane)){var e=a.airNotes.find(e=>Q(e,t));const i={id:K(),timeline:r,type:e?J.Flick:J.Tap,beat:ee(t.measure,t.tick,480),lane:t.lane-2,width:t.width};2===t.noteType&&(i.critical=!0),e&&(i.direction=3===e.noteType?q.Left:4===e.noteType?q.Right:q.Up),s.notes.push(i)}}),s}}["convertor"],te=H;class ie{constructor(e){this.editor=e,this._totalTime=10,this._follow=!1,this._playing=!1,this.playTicker=new a.Ticker,this.playTicker.autoStart=!1}getBuffer(i){return p(this,void 0,void 0,function*(){const e=yield fetch(i);var t=yield e.arrayBuffer();return this.audioContext.decodeAudioData(t)})}loadAudio(t){return new Promise(e=>{this.audio=new Audio,this.audioContext=new AudioContext,this.audio.addEventListener("loadeddata",()=>{this.editor.renderer.parseAndRender(),e()}),this.audio.addEventListener("ended",()=>{this._playing=!1}),this.audio.src=URL.createObjectURL(t),this.audioSource=this.audioContext.createMediaElementSource(this.audio),this.audioSource.connect(this.audioContext.destination)})}play(){return p(this,void 0,void 0,function*(){this.audio&&!this.playing&&(yield this.audio.play(),this._playing=!0,this.playTicker.start())})}stop(){this.pause(),this.currentTime=0,this.follow&&(this.editor.scrollController.scrollBottom=0),this._playing=!1,this.editor.renderer.updateCurrentTimeLine()}pause(){this.playing&&this.audioSource&&(this.audio.pause(),this._playing=!1,this.playTicker.stop())}destroy(){this.stop()}get currentTime(){var e;return(null===(e=this.audio)||void 0===e?void 0:e.currentTime)||0}set currentTime(e){this.audio&&(this.audio.currentTime=e,this.editor.event.dispatchAudioTimeUpdateEvent())}get totalTime(){var e;return(null===(e=this.audio)||void 0===e?void 0:e.duration)||this._totalTime}set totalTime(e){this._totalTime=e,this.editor.renderer.parseAndRender()}get follow(){return this._follow}set follow(e){this._follow=e,this.editor.renderer.render()}get playing(){return this._playing}}class re{constructor(e){this.editor=e}getTimeByBeat(t,i){var e;let r=0,s=null===(e=this.map)||void 0===e?void 0:e.bpms.filter(e=>e.timeline===i);s&&0!==s.length||(s=[{beat:[0,0,1],id:x(),bpm:120,timeline:i}]);for(let e=0;e<s.length;e++){var o=s[e],n=this.editor.fraction(o.beat);if(t.le(n))break;var a=s[e+1];const l=a?this.editor.fraction(a.beat):null;r+=(a&&t.gt(l)?l:t).minus(n).decimal/o.bpm*60}return r}getHeightByBeat(e,t){return this.editor.const.spaceY+this.getTimeByBeat(e,t)*this.editor.const.heightPerSecond}getHeightByTime(e){return this.editor.const.spaceY+e*this.editor.const.heightPerSecond}getYInCanvas(e){return this.editor.const.height-(e-this.editor.scrollController.scrollBottom)}getLaneX(e){return this.editor.const.width*(6*e+14)/100}getLaneWidth(e){return this.editor.const.width*(6*e)/100}get map(){return this.editor.map}}const se={background:16777215,primeLane:0,primeLaneAlpha:1,secondaryLane:0,secondaryLaneAlpha:.2,bpmLine:65535,timeText:0,currentTimeLine:16711680,beatLineWhole:0,beatLineWholeAlpha:1,beatLineHalf:0,beatLineHalfAlpha:.2,beatLineThird:16711680,beatLineThirdAlpha:.4,beatLineQuarter:255,beatLineQuarterAlpha:.4,slideCurve:14285551,slideCurveAlpha:.8,slideInvisibleNode:3204520,slideCriticalCurve:16579021,slideCriticalCurveAlpha:.8,slideCriticalInvisibleNode:15852573,selectionBox:233724,selectionBoxAlpha:.2,selectionRect:233724,warningRect:16746496,cursor:0};class oe{constructor(e){this.editor=e,this._resolution=window.devicePixelRatio,this._fontSize=18,this._paddingX=4,this._paddingY=2,this._spaceY=200,this._heightPerSecond=500,this._lineWidth=1,this._invisibleLineWidth=3,this._cursorLineWidth=4,this._noteHeight=32,this._arrowHeight=32,this._curveRenderStep=8;var{width:t,height:e}=this.editor.container.getBoundingClientRect();this._width=t,this._height=e}get width(){return this._width}set width(e){this._width=e}get height(){return this._height}set height(e){this._height=e}get maxHeight(){return this.heightPerSecond*this.editor.audioManager.totalTime+2*this.spaceY}get resolution(){return this._resolution}set resolution(e){this._resolution=e}get fontSizeRaw(){return this._fontSize}set fontSizeRaw(e){this._fontSize=e}get fontSize(){return this._fontSize/this.resolution}get paddingXRaw(){return this._paddingX}set paddingXRaw(e){this._paddingX=e}get paddingX(){return this._paddingX/this.resolution}get paddingYRaw(){return this._paddingY}set paddingYRaw(e){this._paddingY=e}get paddingY(){return this._paddingY/this.resolution}get heightPerSecondRaw(){return this._heightPerSecond}set heightPerSecondRaw(e){var t;e<100||2e3<e||(t=(this.editor.scrollController.scrollBottom-this.spaceY)/this._heightPerSecond,this._heightPerSecond=e,this.editor.scrollController.scrollBottom=t*this._heightPerSecond+this.spaceY,this.editor.renderer.parseAndRender())}get heightPerSecond(){return this._heightPerSecond/this.resolution}get spaceYRaw(){return this._spaceY}set spaceYRaw(e){this._spaceY=e}get spaceY(){return this._spaceY/this.resolution}get lineWidthRaw(){return this._lineWidth}set lineWidthRaw(e){this._lineWidth=e}get lineWidth(){return this._lineWidth/this.resolution}get invisibleLineWidthRaw(){return this._invisibleLineWidth}set invisibleLineWidthRaw(e){this._invisibleLineWidth=e}get invisibleLineWidth(){return this._invisibleLineWidth/this.resolution}get cursorLineWidthRaw(){return this._cursorLineWidth}set cursorLineWidthRaw(e){this._cursorLineWidth=e}get cursorLineWidth(){return this._cursorLineWidth/this.resolution}get noteHeightRaw(){return this._noteHeight}set noteHeightRaw(e){this._noteHeight=e}get noteHeight(){return this._noteHeight/this.resolution}get arrowHeightRaw(){return this._arrowHeight}set arrowHeightRaw(e){this._arrowHeight=e}get arrowHeight(){return this._arrowHeight/this.resolution}get curveRenderStepRaw(){return this._curveRenderStep}set curveRenderStepRaw(e){this._curveRenderStep=e}get curveRenderStep(){return this._curveRenderStep/this.resolution}}var ne,ae,le={},k={};j=k,Object.defineProperty(j,"__esModule",{value:!0}),j.MapTypeInfo=j.DiffColor=j.ResourceTypeName=j.ResourceType=j.MapType=void 0,(N=_=j.MapType||(j.MapType={}))[N.PJSK=0]="PJSK",N[N.BANG=1]="BANG",(N=H=j.ResourceType||(j.ResourceType={}))[N.Other=0]="Other",N[N.Meta=1]="Meta",N[N.Map=2]="Map",N[N.Audio=3]="Audio",N[N.Image=4]="Image",N[N.Video=5]="Video",N[N.Script=6]="Script",j.ResourceTypeName={[H.Other]:"Other",[H.Meta]:"Meta",[H.Map]:"Map",[H.Audio]:"Audio",[H.Image]:"Image",[H.Video]:"Video",[H.Script]:"Script"},(H=j.DiffColor||(j.DiffColor={})).BLUE="blue",H.GREEN="green",H.YELLOW="yellow",H.RED="red",H.PURPLE="purple",H.PINK="pink",j.MapTypeInfo={[_.PJSK]:{name:"Project Sekai",version:1},[_.BANG]:{name:"BanG Dream",version:1}},j=le,ne=r&&r.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){e[r=void 0===r?i:r]=t[i]}),_=r&&r.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||ne(t,e,i)},Object.defineProperty(j,"__esModule",{value:!0}),j.PJSK=void 0,_(k,j),j.PJSK=z;class de{constructor(e){this.editor=e,this._critical=!1,this._width=3,this._direction=le.PJSK.FlickDirection.Up,this._type=ae.Default,this._curve=le.PJSK.CurveType.Linear,this._nodeVisible=!0,this._slideHeadPlaced=!1,this._slideCritical=!1,this._flickEnd=!1,this.slideId="",this.bpm=120,this.noteObject={id:"CursorNote",name:"CursorNote",x:0,scrollHeight:0,width:0,texture:"tap",alpha:0,rawWidth:0,rawLane:0},this.slideHeadObject={id:"CursorNote",name:"CursorNoteSlideHead",x:0,scrollHeight:0,width:0,texture:"slide",alpha:0,rawWidth:0,rawLane:0},this.slideTailObject={id:"CursorNote",name:"CursorNoteSlideTail",x:0,scrollHeight:0,width:0,texture:"slide",alpha:0,rawWidth:0,rawLane:0},this.arrowObject={id:"CursorNote",name:"CursorNoteArrow",x:0,scrollHeight:0,width:0,alpha:1,texture:"flick_arrow_01"},this.curveObject={id:"CursorNote",slideId:"CursorNoteSlide",name:"CursorNoteCurve",startScrollHeight:0,endScrollHeight:0,alpha:0,color:0,points:[]},this.invisibleObject={id:"CursorNote",name:"CursorNoteInvisibleNode",slideId:"CursorNoteSlide",x:0,width:0,scrollHeight:0,color:0,alpha:0},this.visibleObject={id:"CursorNote",name:"CursorNoteVisibleNode",slideId:"CursorNoteSlide",x:0,width:0,scrollHeight:0,texture:"slide_node",alpha:0}}calculateCursorPosition(){var t=this.editor.scrollController.scrollBottom+this.editor.const.height-this.editor.handler.lastMousePosition.y;let i=0,r=this.editor.fraction([0,0,1]);var s=this.editor.beatSlice;for(let e=0;;e++){var o=this.editor.fraction([Math.floor(e/s),e%s,s]),n=this.editor.calculator.getHeightByBeat(o,this.editor.timeLineManager.prime);if(n<t)i=t-n,r=o;else if(t<=n){var a=n-t,n=this.editor.handler.lastMousePosition.x-this.editor.calculator.getLaneX(0),n=Math.floor(n/(.06*this.editor.const.width));const l=a<i?o:r;return void(n==this.positionX&&l.eq(this.positionY)||(this.positionX=n,this.positionY=l,this.editor.event.dispatchCursorMoveEvent()))}}}updateObject(){if(this.noteObject.alpha=0,this.slideHeadObject.alpha=0,this.slideTailObject.alpha=0,this.arrowObject.alpha=0,this.curveObject.alpha=0,this.visibleObject.alpha=0,this.invisibleObject.alpha=0,this.visible){this.editor.renderer.cursor.lineColor=this.editor.resourceManager.theme.color.cursor;var e=this.editor.calculator.getHeightByBeat(this.positionY,this.editor.timeLineManager.prime),t=this.editor.calculator.getLaneX(this.lane-.1),i=this.editor.calculator.getLaneWidth(this.width+.2),r=(e,t,i,r)=>{const s=Math.min(6,e);var o=Math.max(.8,Math.min(4,.6*s));this.arrowObject.x=this.editor.calculator.getLaneX(t+(e-o)/2),this.arrowObject.scrollHeight=i,this.arrowObject.width=this.editor.calculator.getLaneWidth(o),this.arrowObject.alpha=.6,this.arrowObject.texture=`flick_arrow_${r?"critical_":""}${s.toString().padStart(2,"0")}${{0:"",1:"_left",2:"_right"}[this.direction]}`};if([ae.Tap,ae.Flick].includes(this.type)||this.type===ae.Slide&&!this.slideHeadPlaced){this.noteObject.scrollHeight=e,this.noteObject.x=t,this.noteObject.width=i,this.noteObject.rawWidth=this.width,this.noteObject.rawLane=this.lane,this.noteObject.alpha=.6;var s=this.type===ae.Flick;this.noteObject.texture=this.critical?"critical":s?"flick":this.type===ae.Tap?"tap":"slide",s&&r(this.width,this.lane,this.noteObject.scrollHeight,this.critical)}else if(this.type===ae.Slide){this.slideHeadObject.alpha=this.slideTailObject.alpha=.6,this.slideHeadObject.scrollHeight=this.noteObject.scrollHeight,this.slideTailObject.scrollHeight=e,this.slideHeadObject.x=this.noteObject.x,this.slideTailObject.x=t,this.slideHeadObject.width=this.noteObject.width,this.slideTailObject.width=i,this.slideHeadObject.rawLane=this.noteObject.rawLane,this.slideTailObject.rawLane=this.lane,this.slideHeadObject.rawWidth=this.noteObject.rawWidth,this.slideTailObject.rawWidth=this.width;s=this.noteObject.scrollHeight>e;const o=s?this.slideTailObject:this.slideHeadObject,n=s?this.slideHeadObject:this.slideTailObject;o.texture=this.slideCritical?"critical":"slide",n.texture=this.slideCritical||!this.slideHeadPlaced&&this.critical||this.slideHeadPlaced&&this.critical&&this.flickEnd?"critical":this.slideHeadPlaced&&this.flickEnd?"flick":"slide",this.flickEnd&&r(n.rawWidth,n.rawLane,n.scrollHeight,"critical"===n.texture),this.curveObject.startScrollHeight=o.scrollHeight,this.curveObject.endScrollHeight=n.scrollHeight,this.curveObject.alpha=.8*(this.slideCritical?this.editor.resourceManager.theme.color.slideCriticalCurveAlpha:this.editor.resourceManager.theme.color.slideCurveAlpha),this.curveObject.color=this.slideCritical?this.editor.resourceManager.theme.color.slideCriticalCurve:this.editor.resourceManager.theme.color.slideCurve,this.curveObject.points=[...this.editor.parser.getCurvePoints(this.editor.calculator.getLaneX(o.rawLane+.1),o.scrollHeight,this.editor.calculator.getLaneX(n.rawLane+.1),n.scrollHeight,this.editor.parser.bezier[this.curve]),...this.editor.parser.getCurvePoints(this.editor.calculator.getLaneX(o.rawLane+o.rawWidth-.1),o.scrollHeight,this.editor.calculator.getLaneX(n.rawLane+n.rawWidth-.1),n.scrollHeight,this.editor.parser.bezier[this.curve]).reverse()]}else if(this.type===ae.SlideNode){if(!this.slideId)return;r=this.editor.map.slides.find(e=>e.id===this.slideId).critical;this.invisibleObject.x=this.editor.calculator.getLaneX(this.lane+.1),this.invisibleObject.width=this.editor.calculator.getLaneWidth(this.width-.2),this.invisibleObject.scrollHeight=e,this.invisibleObject.alpha=.6,this.invisibleObject.color=r?this.editor.resourceManager.theme.color.slideCriticalInvisibleNode:this.editor.resourceManager.theme.color.slideInvisibleNode,this.nodeVisible&&(this.visibleObject.x=t,this.visibleObject.width=i,this.visibleObject.scrollHeight=e,this.visibleObject.alpha=.6,this.visibleObject.texture=`slide_node${r?"_critical":""}`)}else this.type===ae.BPM&&(this.editor.renderer.cursor.lineColor=this.editor.resourceManager.theme.color.bpmLine);this.editor.renderer.render()}else this.editor.renderer.render()}placeSlideHead(){this.type===ae.Slide&&(this.slideHeadObject.x=this.editor.calculator.getLaneX(this.lane-.1),this.slideHeadObject.scrollHeight=this.editor.calculator.getHeightByBeat(this.positionY,this.editor.timeLineManager.prime),this.slideHeadObject.width=this.editor.calculator.getLaneWidth(this.width+.2),this.slideHeadObject.texture=this.critical?"critical":"slide",this.slideHeadObject.alpha=1,this.slideHeadObject.rawWidth=this.width,this.slideHeadObject.rawLane=this.lane,this._slideCritical=this.critical,this._slideHeadPlaced=!0,this.slideHeadBeat=[this.positionY.integer,this.positionY.numerator,this.positionY.denominator])}endSlidePlacement(){this.type!==ae.Slide&&!this.slideHeadPlaced||(this._slideHeadPlaced=!1,this.critical=this.slideCritical,this._slideCritical=!1,this.slideHeadObject.alpha=0,this.updateObject())}autoChangeSlideCursor(){if([ae.Slide,ae.SlideNode].includes(this.editor.cursorManager.type)&&!this.editor.cursorManager.slideHeadPlaced){const n=this.editor.calculator.getHeightByBeat(this.editor.cursorManager.positionY,this.editor.timeLineManager.prime);var i=this.editor.parser.renderObjects.curves.filter(e=>n>=e.startScrollHeight&&n<=e.endScrollHeight);let t="";for(let e=0;e<i.length;e++){const a=i[e];if("CursorNoteSlide"!==a.slideId){var r=a.points.find(e=>e.scrollHeight>=n).x,s=a.points.concat().reverse().find(e=>e.scrollHeight>=n).x,o=this.editor.calculator.getLaneX(this.editor.cursorManager.positionX+.5);if(r<=o&&o<=s){t=a.slideId;break}}}this.editor.cursorManager.type=t?ae.SlideNode:ae.Slide,this.editor.cursorManager.slideId=t}}get type(){return this._type}set type(e){e!==this._type&&(this._type=e,this.type!==ae.Default&&this.editor.selectionManager.emptySelection(),this.type===ae.Slide&&this.autoChangeSlideCursor(),this.slideHeadPlaced&&this.endSlidePlacement(),this.updateObject())}get width(){return this._width}set width(e){this._width=Math.max(1,Math.min(12,e)),this.updateObject()}get critical(){return this._critical}set critical(e){this._critical=e,this.updateObject()}get direction(){return this._direction}set direction(e){this._direction=e,this.updateObject()}get curve(){return this._curve}set curve(e){this._curve=e,this.updateObject()}get nodeVisible(){return this._nodeVisible}set nodeVisible(e){this.type===ae.SlideNode&&(this._nodeVisible=e,this.updateObject())}get flickEnd(){return this._flickEnd}set flickEnd(e){this._flickEnd=e,this.updateObject()}get slideHeadPlaced(){return this._slideHeadPlaced}get slideCritical(){return this._slideCritical}get lane(){return Math.min(12-this.width,Math.max(0,this.positionX-Math.floor(this.width/2)))}get visible(){return 0<=this.positionX&&this.positionX<=11}}(_=ae=ae||{})[_.Default=0]="Default",_[_.Tap=1]="Tap",_[_.Flick=2]="Flick",_[_.Slide=3]="Slide",_[_.SlideNode=4]="SlideNode",_[_.BPM=5]="BPM";var ce={},k={},j={};Object.defineProperty(j,"__esModule",{value:!0}),j.DenominatorZeroError=void 0;class he extends Error{constructor(e){super(),this.name="DenominatorZeroError",this.message=`Denominator cannot be zero: [${e.toString()}]`}}j.DenominatorZeroError=he,Object.defineProperty(k,"__esModule",{value:!0}),k.Fraction=void 0;const ue=ce,pe=j;k.Fraction=class Ve{constructor(e){if(0===e[3])throw new pe.DenominatorZeroError(e);this.frac=e}static fromInteger(e){return new Ve([e/Math.abs(e),Math.abs(e),0,1])}eq(e){var t=this.simplified,e=e.simplified;return t.sign===e.sign&&t.integer===e.integer&&t.numerator===e.numerator&&t.denominator===e.denominator}gt(e){return 0<this.sign&&e.sign<0||(0<this.sign&&0<e.sign?this.integer>e.integer||this.integer===e.integer&&(this.denominator===e.denominator?this.numerator>e.numerator:this.reduceToCommonDenominator(e).numerator>e.reduceToCommonDenominator(this).numerator):!this.opposite.gt(e.opposite))}ge(e){return this.gt(e)||this.eq(e)}lt(e){return!this.ge(e)}le(e){return!this.gt(e)}add(e){if(this.sign!==e.sign)return this.sign<0?e.minus(this.opposite):this.minus(e.opposite);var t=this.reduceToCommonDenominator(e),e=e.reduceToCommonDenominator(this);return new Ve([this.sign,t.integer+e.integer,t.numerator+e.numerator,this.denominator])}minus(e){if(this.sign===-e.sign)return this.add(e.opposite);if(0<this.sign){if(this.ge(e)){var t=this.reduceToCommonDenominator(e).improper,i=e.reduceToCommonDenominator(this).improper;return new Ve([this.sign,0,t.numerator-i.numerator,t.denominator]).simplified}return e.minus(this).opposite}return this.opposite.minus(e.opposite).opposite}reduceToCommonDenominator(e){if(this.denominator===e.denominator)return this.copy;var t=this.simplified,e=e.simplified,e=ue.MathUtils.lcm(t.denominator,e.denominator);return new Ve([t.sign,t.integer,t.numerator*(e/t.denominator),e])}get improper(){const e=this.copy;return e.numerator+=e.integer*e.denominator,e.integer=0,e}get simplified(){const e=this.copy;var t;return e.integer<0&&(e.integer=-e.integer,e.sign=-e.sign),e.numerator<0&&(e.numerator=-e.numerator,e.sign=-e.sign),e.denominator<0&&(e.denominator=-e.denominator,e.sign=-e.sign),1!==(t=ue.MathUtils.gcd(e.numerator,e.denominator))&&(e.numerator=e.numerator/t,e.denominator=e.denominator/t),e.numerator>=e.denominator&&(t=Math.floor(e.numerator/e.denominator),e.numerator-=t*e.denominator,e.integer+=t),e}get decimal(){return this.sign*(this.integer+this.numerator/this.denominator)}get fraction(){return[...this.frac]}set fraction(e){this.frac=e}get opposite(){return new Ve([-this.sign,this.integer,this.numerator,this.denominator])}get abs(){return new Ve([1,this.integer,this.numerator,this.denominator])}get copy(){return new Ve([this.sign,this.integer,this.numerator,this.denominator])}get sign(){return this.frac[0]}set sign(e){this.frac[0]=e}get integer(){return this.frac[1]}set integer(e){this.frac[1]=e}get numerator(){return this.frac[2]}set numerator(e){this.frac[2]=e}get denominator(){return this.frac[3]}set denominator(e){this.frac[3]=e}};var ge,me,_={};Object.defineProperty(_,"__esModule",{value:!0}),_.MathUtils=void 0;class ve{static gcd(e,t){if(0===e||0===t)return Math.max(e+t,1);for(;0!==t;){var i=t;t=e%t,e=i}return e}static lcm(e,t){return Math.abs(e*t)/ve.gcd(e,t)}}_.MathUtils=ve,j=ce,ge=r&&r.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[i]}})}:function(e,t,i,r){e[r=void 0===r?i:r]=t[i]}),r=r&&r.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||ge(t,e,i)},Object.defineProperty(j,"__esModule",{value:!0}),r(k,j),r(_,j);class fe extends a.utils.EventEmitter{constructor(e){super(),this.editor=e}dispatchScrollEvent(e,t){this.emit(me.Scroll,{oldScrollBottom:e,newScrollBottom:t})}dispatchSelectEvent(){var e=JSON.parse(JSON.stringify(this.editor.selectionManager.selection));this.editor.selectionManager.isSelectionEqual(this.editor.selectionManager.oldSelection,e)||(this.editor.event.emit(me.Select,{oldSelection:this.editor.selectionManager.oldSelection,newSelection:e}),this.editor.selectionManager.oldSelection=JSON.parse(JSON.stringify(e)))}dispatchAudioTimeUpdateEvent(){this.emit(me.AudioTimeUpdate,{currentTime:this.editor.audioManager.currentTime})}dispatchCursorMoveEvent(){this.emit(me.CursorMove,{positionX:this.editor.cursorManager.positionX,positionY:this.editor.cursorManager.positionY})}dispatchDestroyEvent(){this.emit(me.Destroy)}}(j=me=me||{}).Scroll="scroll",j.Destroy="destroy",j.Select="select",j.AudioTimeUpdate="audioTimeUpdate",j.CursorMove="cursorMove",j.ResourceLoadProgress="resourceLoadProgress",j.ResourceLoadError="resourceLoadError";class be{constructor(e){this.editor=e,this.cursorMoved=!1,this.lastMousePosition={x:0,y:0},["windowMouseUpHandler","stageMouseMoveWhenMouseDownHandler","mouseWheelHandler","stageMouseDownHandler","stageMouseMoveHandler","stageClickHandler","scrollTickerHandler","audioPlayTickerHandler","editorScrollHandler","editorCursorMoveHandler"].forEach(e=>this[e]=this[e].bind(this))}listen(){this.editor.renderer.app.view.addEventListener("wheel",this.mouseWheelHandler),this.editor.renderer.app.stage.on("mousedown",this.stageMouseDownHandler),this.editor.renderer.app.stage.on("mousemove",this.stageMouseMoveHandler),this.editor.renderer.app.stage.on("click",this.stageClickHandler),this.scrollController.scrollTicker.add(this.scrollTickerHandler),this.editor.audioManager.playTicker.add(this.audioPlayTickerHandler),this.editor.event.on(me.Scroll,this.editorScrollHandler),this.editor.event.on(me.CursorMove,this.editorCursorMoveHandler)}removeAll(){this.editor.renderer.app.view.removeEventListener("wheel",this.mouseWheelHandler),this.editor.renderer.app.stage.off("mousedown",this.stageMouseDownHandler),this.editor.renderer.app.stage.off("mousemove",this.stageMouseMoveHandler),this.scrollController.scrollTicker.remove(this.scrollTickerHandler),this.editor.audioManager.playTicker.remove(this.audioPlayTickerHandler),this.editor.event.off(me.Scroll,this.editorScrollHandler),this.editor.event.off(me.CursorMove,this.editorCursorMoveHandler)}editorScrollHandler(){this.editor.cursorManager.calculateCursorPosition();var e=this.editor.cursorManager.positionY,t=this.editor.cursorManager.positionX;this.editor.renderer.updateCursorPosition(e,t)}editorCursorMoveHandler(){this.editor.cursorManager.autoChangeSlideCursor(),this.editor.cursorManager.updateObject()}mouseWheelHandler(e){e=Math.min(this.editor.const.maxHeight-this.editor.const.height,Math.max(0,this.editor.scrollController.scrollBottom-e.deltaY/this.editor.const.resolution));this.editor.scrollController.scrollTo(e)}stageMouseDownHandler(e){var t;0===e.data.button&&this.editor.cursorManager.type===ae.Default&&(e.data.originalEvent.ctrlKey||this.editor.selectionManager.emptySelection(),e=(t=e.data.global).x,t=this.editor.scrollController.scrollBottom+(this.editor.const.height-t.y),this.editor.selectionManager.selectionBox=[e,t,e,t],this.editor.renderer.app.stage.on("mousemove",this.stageMouseMoveWhenMouseDownHandler),this.editor.event.on(me.Scroll,this.stageMouseMoveWhenMouseDownHandler),this.editor.renderer.render(),window.addEventListener("mouseup",this.windowMouseUpHandler))}stageMouseMoveWhenMouseDownHandler(){var e=this.lastMousePosition;this.selectionManager.selectionBox[2]=e.x,this.selectionManager.selectionBox[3]=this.scrollController.scrollBottom+(this.editor.const.height-e.y),(this.selectionManager.selectionBox[2]-this.selectionManager.selectionBox[0]||this.selectionManager.selectionBox[3]-this.selectionManager.selectionBox[1])&&(this.cursorMoved=!0);var t=this.editor.const.height/20,i=this.editor.const.height-t;e.y<t||e.y>i?(this.scrollController.scrollTicker.started||this.scrollController.scrollTicker.start(),this.scrollController.autoScrollDelta=((e.y<t?t:i)-e.y)/(t/10)):(this.scrollController.autoScrollDelta=0,this.scrollController.scrollTicker.stop()),this.editor.selectionManager.findSelectedNote(),this.editor.renderer.render()}windowMouseUpHandler(){this.cursorMoved=!1,window.removeEventListener("mouseup",this.windowMouseUpHandler),this.selectionManager.selectionBox=[0,0,0,0],this.editor.renderer.app.stage.off("mousemove",this.stageMouseMoveWhenMouseDownHandler),this.editor.event.off(me.Scroll,this.stageMouseMoveWhenMouseDownHandler),this.scrollController.autoScrollDelta=0,this.scrollController.scrollTicker.stop(),this.selectionManager.mergeTempSelection(),this.editor.event.dispatchSelectEvent(),this.editor.renderer.render()}stageMouseMoveHandler(e){var t;this.lastMousePosition.x=e.data.global.x,this.lastMousePosition.y=e.data.global.y,this.editor.map&&(this.editor.cursorManager.calculateCursorPosition(),t=this.editor.cursorManager.positionY,e=this.editor.cursorManager.positionX,this.editor.renderer.updateCursorPosition(t,e))}stageClickHandler(){if(!this.cursorMoved&&this.editor.cursorManager.visible){if(this.editor.cursorManager.type!==ae.Default){const s={id:x(),beat:[this.editor.cursorManager.positionY.integer,this.editor.cursorManager.positionY.numerator,this.editor.cursorManager.positionY.denominator],lane:this.editor.cursorManager.lane,timeline:this.editor.timeLineManager.prime,width:this.editor.cursorManager.width};if(this.editor.cursorManager.type===ae.Tap)this.editor.map.notes.push(Object.assign(Object.assign({},s),{type:le.PJSK.NoteType.Tap,critical:this.editor.cursorManager.critical}));else if(this.editor.cursorManager.type===ae.Flick)this.editor.map.notes.push(Object.assign(Object.assign({},s),{type:le.PJSK.NoteType.Flick,direction:this.editor.cursorManager.direction,critical:this.editor.cursorManager.critical}));else if(this.editor.cursorManager.type!==ae.Slide||this.editor.cursorManager.slideHeadPlaced)if(this.editor.cursorManager.type===ae.Slide&&this.editor.cursorManager.slideHeadPlaced){let e=this.editor.cursorManager.slideHeadObject,t=this.editor.cursorManager.slideTailObject,i=this.editor.cursorManager.slideHeadBeat,r=[this.editor.cursorManager.positionY.integer,this.editor.cursorManager.positionY.numerator,this.editor.cursorManager.positionY.denominator];if(e.scrollHeight===t.scrollHeight)return;e.scrollHeight>t.scrollHeight&&([e,t]=[t,e],[i,r]=[r,i]);const o={id:x(),type:this.editor.cursorManager.flickEnd?le.PJSK.NoteType.SlideEndFlick:le.PJSK.NoteType.SlideEndDefault,beat:r,lane:t.rawLane,width:t.rawWidth,curve:le.PJSK.CurveType.None};this.editor.cursorManager.flickEnd&&(o.direction=this.editor.cursorManager.direction,this.editor.cursorManager.critical&&(o.critical=!0));const n={id:s.id,timeline:this.editor.timeLineManager.prime,notes:[{id:x(),type:le.PJSK.NoteType.SlideStart,beat:i,lane:e.rawLane,width:e.rawWidth,curve:this.editor.cursorManager.curve},o]};this.editor.cursorManager.slideCritical&&(n.critical=!0),this.editor.map.slides.push(n),this.editor.cursorManager.endSlidePlacement()}else if(this.editor.cursorManager.type===ae.SlideNode){const i=this.editor.cursorManager.slideId;if(!i)return;const r=this.editor.map.slides.find(e=>e.id===i);var e=r.notes.findIndex(e=>this.editor.fraction(e.beat).eq(this.editor.fraction(s.beat)));if(-1!==e){const a=r.notes[e];a.curve=this.editor.cursorManager.curve,a.lane=s.lane,a.width=s.width,[le.PJSK.NoteType.SlideStart,le.PJSK.NoteType.SlideEndFlick,le.PJSK.NoteType.SlideEndDefault].includes(a.type)||(a.type=this.editor.cursorManager.nodeVisible?le.PJSK.NoteType.SlideVisible:le.PJSK.NoteType.SlideInvisible)}else r.notes.push({id:s.id,type:this.editor.cursorManager.nodeVisible?le.PJSK.NoteType.SlideVisible:le.PJSK.NoteType.SlideInvisible,beat:s.beat,lane:s.lane,width:s.width,curve:this.editor.cursorManager.curve}),r.notes.sort((e,t)=>this.editor.fraction(e.beat).minus(this.editor.fraction(t.beat)).decimal)}else{var t;this.editor.cursorManager.type===ae.BPM&&(t=this.editor.map.bpms.findIndex(e=>e.timeline===s.timeline&&this.editor.fraction(e.beat).eq(this.editor.fraction(s.beat))),e={id:s.id,timeline:s.timeline,beat:s.beat,bpm:this.editor.cursorManager.bpm},-1!==t?this.editor.map.bpms[t]=e:(this.editor.map.bpms.push(e),this.editor.map.bpms.sort((e,t)=>this.editor.fraction(e.beat).minus(this.editor.fraction(t.beat)).decimal)))}else this.editor.cursorManager.placeSlideHead()}this.editor.renderer.parseAndRender()}}scrollTickerHandler(){this.editor.scrollController.scrollTo(this.editor.scrollController.scrollBottom+this.editor.scrollController.autoScrollDelta)}audioPlayTickerHandler(){var e;this.editor.event.dispatchAudioTimeUpdateEvent(),this.editor.audioManager.follow?(e=this.editor.calculator.getHeightByTime(this.editor.audioManager.currentTime),this.editor.scrollController.scrollBottom=e-this.editor.const.spaceY):this.editor.renderer.updateCurrentTimeLine()}get selectionManager(){return this.editor.selectionManager}get scrollController(){return this.editor.scrollController}}var ye=4,Me=1e-7,we=10,Se="function"==typeof Float32Array;function Ce(e,t){return 1-3*t+3*e}function Le(e,t,i){return((Ce(t,i)*e+(3*i-6*t))*e+3*t)*e}function Te(e,t,i){return 3*Ce(t,i)*e*e+2*(3*i-6*t)*e+3*t}function Oe(e){return e}function He(o,t,n,i){if(!(0<=o&&o<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(o===t&&n===i)return Oe;for(var a=new(Se?Float32Array:Array)(11),e=0;e<11;++e)a[e]=Le(.1*e,o,n);function r(e){for(var t=0,i=1;10!==i&&a[i]<=e;++i)t+=.1;var r=t+.1*((e-a[--i])/(a[i+1]-a[i])),s=Te(r,o,n);return.001<=s?function(e,t,i,r){for(var s=0;s<ye;++s){var o=Te(t,i,r);if(0===o)return t;t-=(Le(t,i,r)-e)/o}return t}(e,r,o,n):0===s?r:function(e,t,i,r,s){for(var o,n,a=0;0<(o=Le(n=t+(i-t)/2,r,s)-e)?i=n:t=n,Math.abs(o)>Me&&++a<we;);return n}(e,t,t+.1,o,n)}return function(e){return 0===e?0:1===e?1:Le(r(e),t,i)}}class xe{constructor(e){this.editor=e,this.bezier=[!1,[0,0,1,1],[.11,0,.5,0],[.5,1,.89,1],[.45,0,.55,1]],this.initRenderObjects()}initRenderObjects(){this.renderObjects={lanes:[],beatLines:[],texts:[],notes:[],curves:[],arrows:[],visibleNodes:[],invisibleNodes:[]}}parse(){var e;this.initRenderObjects(),this.addLanes(),0<(null===(e=this.map)||void 0===e?void 0:e.timelines.length)&&0<(null===(e=this.map)||void 0===e?void 0:e.bpms.length)&&(this.parseCursor(),this.parseBeatLines(),this.parseBPMLines(),this.addTimeText(),this.parseNotes(),this.parseSlide())}parseCursor(){this.renderObjects.notes.push(this.editor.cursorManager.noteObject),this.renderObjects.notes.push(this.editor.cursorManager.slideHeadObject),this.renderObjects.notes.push(this.editor.cursorManager.slideTailObject),this.renderObjects.arrows.push(this.editor.cursorManager.arrowObject),this.renderObjects.curves.push(this.editor.cursorManager.curveObject),this.renderObjects.visibleNodes.push(this.editor.cursorManager.visibleObject),this.renderObjects.invisibleNodes.push(this.editor.cursorManager.invisibleObject)}addLanes(){for(let e=0;e<=12;e++)this.renderObjects.lanes.push({name:`Lane-${e}`,x:this.editor.const.width*((6*e+14)/100),color:e%2?this.editor.resourceManager.theme.color.secondaryLane:this.editor.resourceManager.theme.color.primeLane,alpha:e%2?this.editor.resourceManager.theme.color.secondaryLaneAlpha:this.editor.resourceManager.theme.color.primeLaneAlpha})}parseBeatLines(){var t=this.editor.beatSlice;for(let e=0;;e++){var i=this.editor.fraction([Math.floor(e/t),e%t,t]),r=this.editor.calculator.getTimeByBeat(i,this.editor.timeLineManager.prime),r=this.editor.calculator.getHeightByTime(r);if(r>this.editor.const.maxHeight-this.editor.const.spaceY)break;const s={name:`BeatLine-${i.decimal}`,x:this.editor.calculator.getLaneX(0),width:this.editor.calculator.getLaneWidth(12),scrollHeight:r,color:0,alpha:0};if(e%t==0)s.color=this.editor.resourceManager.theme.color.beatLineWhole,s.alpha=this.editor.resourceManager.theme.color.beatLineWholeAlpha,s.width=this.editor.const.width-this.editor.calculator.getLaneX(0),this.renderObjects.texts.push({name:`BeatLineText-${i.decimal}`,x:this.editor.const.width-this.editor.const.paddingX,fontSize:this.editor.const.fontSize,scrollHeight:r+this.editor.const.paddingY,alignX:"right",alignY:"bottom",color:this.editor.resourceManager.theme.color.beatLineWhole,alpha:this.editor.resourceManager.theme.color.beatLineWholeAlpha,text:`${Math.floor(i.integer/4)+1}:${i.integer%4+1}`});else if(e%(t/2)==0)s.color=this.editor.resourceManager.theme.color.beatLineHalf,s.alpha=this.editor.resourceManager.theme.color.beatLineHalfAlpha;else if(e%(t/3)==0)s.color=this.editor.resourceManager.theme.color.beatLineThird,s.alpha=this.editor.resourceManager.theme.color.beatLineThirdAlpha;else{if(e%(t/4)!=0)continue;s.color=this.editor.resourceManager.theme.color.beatLineQuarter,s.alpha=this.editor.resourceManager.theme.color.beatLineQuarterAlpha}this.renderObjects.beatLines.push(s)}}formatTime(e){return`${Math.floor(e/60).toString().padStart(2,"0")}:${(e%60).toFixed(3).padStart(6,"0")}`}parseBPMLines(){var t=this.map.bpms.filter(e=>e.timeline===this.editor.timeLineManager.prime);for(let e=0;e<t.length;e++){const s=t[e];var i=this.editor.calculator.getTimeByBeat(this.editor.fraction(s.beat),this.editor.timeLineManager.prime),r=this.editor.calculator.getHeightByTime(i);this.renderObjects.beatLines.push({name:`BPM-${s.id}-line`,x:0,width:this.editor.const.width,scrollHeight:r,color:this.editor.resourceManager.theme.color.bpmLine,alpha:1}),this.renderObjects.texts.push({name:`BPM-${s.id}-time`,x:this.editor.const.paddingX,scrollHeight:r+this.editor.const.paddingY,alignY:"bottom",fontSize:this.editor.const.fontSize,color:this.editor.resourceManager.theme.color.bpmLine,alpha:1,text:this.formatTime(i)}),this.renderObjects.texts.push({name:`BPM-${s.id}-value`,x:this.editor.calculator.getLaneX(12)+this.editor.const.paddingX,scrollHeight:r+this.editor.const.paddingY,alignY:"bottom",fontSize:this.editor.const.fontSize,color:this.editor.resourceManager.theme.color.bpmLine,alpha:1,text:s.bpm.toString()})}}addTimeText(){for(let e=0;e<=this.editor.audioManager.totalTime;e++){var t=this.editor.calculator.getHeightByTime(e);const i=this.formatTime(e);this.renderObjects.texts.some(e=>e.text===i)||this.renderObjects.texts.push({name:`Time-${e}`,x:this.editor.calculator.getLaneX(0)-this.editor.const.paddingX,scrollHeight:t,alignX:"right",alignY:"middle",fontSize:this.editor.const.fontSize,color:this.editor.resourceManager.theme.color.timeText,alpha:1,text:i})}}pushFlickObject(e,t,i=!1){const r=Math.min(6,e.width);var s=Math.max(.8,Math.min(4,.6*r));this.renderObjects.arrows.push({name:`Arrow-${e.id}`,x:this.editor.calculator.getLaneX(e.lane+(e.width-s)/2),width:this.editor.calculator.getLaneWidth(s),scrollHeight:t,texture:`flick_arrow_${e.critical||i?"critical_":""}${r.toString().padStart(2,"0")}${{0:"",1:"_left",2:"_right"}[e.direction]}`,alpha:1,id:e.id})}parseNotes(){var t=this.map.notes.filter(e=>this.editor.timeLineManager.visible.includes(e.timeline));for(let e=0;e<t.length;e++){var i=t[e],r=this.editor.calculator.getHeightByBeat(this.editor.fraction(i.beat),i.timeline);i.type===le.PJSK.NoteType.Flick&&this.pushFlickObject(i,r),this.renderObjects.notes.push({name:`Note-${i.id}`,x:this.editor.calculator.getLaneX(i.lane-.1),width:this.editor.calculator.getLaneWidth(i.width+.2),scrollHeight:r,texture:i.critical?"critical":i.type?"flick":"tap",id:i.id,alpha:1,rawLane:i.lane,rawWidth:i.width})}}parseUnPositionedNote(t,i,r){var s=t.notes[i],o=t.notes[r],n=this.editor.calculator.getHeightByBeat(this.editor.fraction(s.beat),t.timeline),a=this.editor.calculator.getHeightByBeat(this.editor.fraction(o.beat),t.timeline),l=[...this.bezier,s.bezier][s.curve];const d=l&&He(l[0],l[1],l[2],l[3]);for(let e=i+1;e<r;e++){var c=t.notes[e],h=this.editor.calculator.getHeightByBeat(this.editor.fraction(t.notes[e].beat),t.timeline),u=(h-n)/(a-n),p=l?s.lane+(o.lane-s.lane)*d(u):s.lane,u=l?s.width+(o.width-s.width)*d(u):s.width;this.renderObjects.visibleNodes.push({name:`Visible-${c.id}`,x:this.editor.calculator.getLaneX(p),width:this.editor.calculator.getLaneWidth(u),scrollHeight:h,texture:`slide_node${t.critical?"_critical":""}`,alpha:1,id:c.id,slideId:t.id})}}parseSlide(){var t=this.map.slides.filter(e=>this.editor.timeLineManager.visible.includes(e.timeline));for(let e=0;e<t.length;e++){const n=t[e];for(let i=0;i<n.notes.length;i++){var r,s=n.notes[i],o=this.editor.calculator.getHeightByBeat(this.editor.fraction(s.beat),n.timeline);[le.PJSK.NoteType.SlideStart,le.PJSK.NoteType.SlideEndDefault].includes(s.type)?this.renderObjects.notes.push({name:`SlideNote-${s.id}`,x:this.editor.calculator.getLaneX(s.lane-.1),width:this.editor.calculator.getLaneWidth(s.width+.2),scrollHeight:o,texture:n.critical?"critical":"slide",id:s.id,slideId:n.id,alpha:1,rawLane:s.lane,rawWidth:s.width}):s.type===le.PJSK.NoteType.SlideEndFlick?(this.renderObjects.notes.push({name:`SlideEndFlick-${s.id}`,x:this.editor.calculator.getLaneX(s.lane-.1),width:this.editor.calculator.getLaneWidth(s.width+.2),scrollHeight:o,texture:s.critical||n.critical?"critical":"flick",id:s.id,slideId:n.id,alpha:1,rawLane:s.lane,rawWidth:s.width}),this.pushFlickObject(s,o,n.critical)):s.type===le.PJSK.NoteType.SlideInvisible?this.renderObjects.invisibleNodes.push({name:`Invisible-${s.id}`,x:this.editor.calculator.getLaneX(s.lane+.1),width:this.editor.calculator.getLaneWidth(s.width-.2),scrollHeight:o,color:n.critical?this.editor.resourceManager.theme.color.slideCriticalInvisibleNode:this.editor.resourceManager.theme.color.slideInvisibleNode,alpha:1,id:s.id,slideId:n.id}):s.type===le.PJSK.NoteType.SlideVisible&&this.renderObjects.visibleNodes.push({name:`Visible-${s.id}`,x:this.editor.calculator.getLaneX(s.lane),width:this.editor.calculator.getLaneWidth(s.width),scrollHeight:o,texture:`slide_node${n.critical?"_critical":""}`,alpha:1,id:s.id,slideId:n.id});let e=n.notes[i+1];if(void 0===e)break;void 0===e.lane&&(r=n.notes.findIndex((e,t)=>t>i&&void 0!==e.lane),e=n.notes[r],this.parseUnPositionedNote(n,i,r),i=r-1),this.renderObjects.curves.push({name:`Curve-${s.id}`,startScrollHeight:o,endScrollHeight:this.editor.calculator.getHeightByBeat(this.editor.fraction(e.beat),n.timeline),points:[...this.getCurvePoints(this.editor.calculator.getLaneX(s.lane+.1),o,this.editor.calculator.getLaneX(e.lane+.1),this.editor.calculator.getHeightByBeat(this.editor.fraction(e.beat),n.timeline),[...this.bezier,s.bezier][s.curve]),...this.getCurvePoints(this.editor.calculator.getLaneX(s.lane+s.width-.1),o,this.editor.calculator.getLaneX(e.lane+e.width-.1),this.editor.calculator.getHeightByBeat(this.editor.fraction(e.beat),n.timeline),[...this.bezier,s.bezier][s.curve]).reverse()],color:n.critical?this.editor.resourceManager.theme.color.slideCriticalCurve:this.editor.resourceManager.theme.color.slideCurve,alpha:n.critical?this.editor.resourceManager.theme.color.slideCriticalCurveAlpha:this.editor.resourceManager.theme.color.slideCurveAlpha,id:s.id,slideId:n.id})}}}getCurvePoints(i,r,e,s,t){if(!t)return[{x:i,scrollHeight:r},{x:i,scrollHeight:s}];const o=this.editor.const.curveRenderStep;var n=Math.ceil((s-r)/o);const a=He(t[0],t[1],t[2],t[3]),l=e-i,d=s-r;return new Array(n+1).fill(0).map((e,t)=>{t=Math.min(1,t*o/(s-r));return{x:i+a(t)*l,scrollHeight:r+t*d}})}get map(){return this.editor.map}}class Ee extends e.NineSlicePlane{constructor(e,t,i){super(e,91,0,91,0),this.id=t,this.slideId=i,this.interactive=!0}}class je extends e.Sprite{constructor(e,t,i){super(e),this.id=t,this.slideId=i,this.interactive=!0}}class _e extends e.NineSlicePlane{constructor(e,t){super(e,91,0,91,0),this.id=t,this.interactive=!0}}class Ne extends e.Container{constructor(e,t,i,r){super(),this.lineWidth=e,this.cursorWidth=t,this._lineColor=i,this.textures=r,this.name="Cursor",this.drawCursor()}drawCursor(){this.cursorX=new e.Graphics,this.cursorX.lineStyle(this.lineWidth,this._lineColor),this.cursorX.moveTo(0,0),this.cursorX.lineTo(this.cursorWidth,0),this.addChild(this.cursorX),this.cursorY=new e.Graphics,this.cursorY.lineStyle(this.lineWidth,this._lineColor),this.cursorY.moveTo(0,0),this.cursorY.lineTo(0,this.cursorWidth),this.cursorY.x=this.cursorWidth/2,this.cursorY.y=-this.cursorWidth/2,this.addChild(this.cursorY)}set lineColor(e){this.removeChild(this.cursorX,this.cursorY),this.cursorX.destroy(!0),this.cursorY.destroy(!0),this._lineColor=e,this.drawCursor()}}class ke{constructor(e){this.editor=e,this.destroyed=!1;var{width:t,height:e}=this.editor.const;this.app=new a.Application({backgroundAlpha:0,width:t,height:e,antialias:!0,resolution:this.editor.const.resolution}),this.app.view.style.width=t+"px",this.app.view.style.height=e+"px",this.editor.container.appendChild(this.app.view),this.app.stage.sortableChildren=!0,this.app.stage.interactive=!0,this.cursor=new Ne(this.editor.const.cursorLineWidth,this.editor.calculator.getLaneWidth(1.2),this.editor.resourceManager.theme.color.cursor,this.editor.resourceManager.textures),this.cursor.visible=!1,this.cursor.zIndex=15,this.app.stage.addChild(this.cursor),this.containers={lane:null,time:null,note:null,slide:null,arrow:null,selection:null},this.initContainers(),this.initLaneContainer()}destroy(){this.destroyed=!0,this.destroyContainers(),this.app.destroy(!0,{children:!0,texture:!0,baseTexture:!0})}initLaneContainer(){this.containers.lane=new a.Container,this.containers.lane.name="Lane",this.app.stage.addChild(this.containers.lane)}updateColorTheme(){}parseAndRender(){this.editor.parser.parse(),this.render()}render(){this.destroyed||(this.destroyContainers(),this.initContainers(),this.renderBeatLines(),this.renderTexts(),this.renderNotes(),this.renderArrows(),this.renderCurves(),this.renderVisibleNodes(),this.renderInvisibleNodes(),this.renderSelectionBox(),this.updateCurrentTimeLine())}renderOnce(){this.renderBackground(),this.renderLanes(),this.renderCurrentTimeLine()}renderBackground(){this.background=new a.Graphics,this.background.name="Background",this.background.zIndex=-1,this.background.interactive=!0,this.background.beginFill(this.editor.resourceManager.theme.color.background,1),this.background.drawRect(0,0,this.editor.const.width,this.editor.const.height),this.background.endFill(),this.app.stage.addChild(this.background)}renderSelectionBox(){var e=this.editor.selectionManager.selectionBox;if(e[0]!==e[2]&&e[1]!==e[3]){const r=new a.Graphics;r.beginFill(this.editor.resourceManager.theme.color.selectionBox,this.editor.resourceManager.theme.color.selectionBoxAlpha),r.lineStyle(this.editor.const.lineWidth,this.editor.resourceManager.theme.color.selectionBox);var t=this.editor.calculator.getYInCanvas(e[1]),i=this.editor.calculator.getYInCanvas(e[3])-t;r.drawRect(e[0],t,e[2]-e[0],i),r.endFill(),this.containers.selection.addChild(r)}}renderSelectionRect(e,t,i,r,s,o=this.editor.resourceManager.theme.color.selectionRect){const n=new a.Graphics;n.name=e,n.lineStyle(4*this.editor.const.lineWidth,o),n.drawRect(t,i,r,s),this.containers.selection.addChild(n)}renderLanes(){for(let e=0;e<this.renderObjects.lanes.length;e++){var t=this.renderObjects.lanes[e];const i=new a.Graphics;i.name=t.name,i.lineStyle(this.editor.const.lineWidth,t.color,t.alpha),i.moveTo(0,0),i.lineTo(0,this.editor.const.height),i.x=t.x,this.containers.lane.addChild(i)}}renderBeatLines(){var t=this.renderObjects.beatLines.filter(e=>e.scrollHeight>=this.editor.scrollController.scrollBottom-this.editor.const.noteHeight&&e.scrollHeight<=this.editor.scrollController.scrollBottom+this.editor.const.height+this.editor.const.noteHeight);for(let e=0;e<t.length;e++){var i=t[e];const r=new a.Graphics;r.name=i.name,r.lineStyle(this.editor.const.lineWidth,i.color,i.alpha),r.moveTo(i.x,0),r.lineTo(i.x+i.width,0),r.y=this.editor.calculator.getYInCanvas(i.scrollHeight),this.containers.time.addChild(r)}}renderCurrentTimeLine(){this.currentTimeLine=new a.Graphics,this.currentTimeLine.name="CurrentTime-line",this.currentTimeLine.lineStyle(this.editor.const.lineWidth,this.editor.resourceManager.theme.color.currentTimeLine,1),this.currentTimeLine.moveTo(0,0),this.currentTimeLine.lineTo(.8*this.editor.const.width,0),this.currentTimeLine.x=.1*this.editor.const.width,this.currentTimeLine.y=this.editor.calculator.getYInCanvas(0),this.currentTimeLine.zIndex=5,this.app.stage.addChild(this.currentTimeLine)}renderTexts(){var t=this.renderObjects.texts.filter(e=>e.scrollHeight>=this.editor.scrollController.scrollBottom&&e.scrollHeight<=this.editor.scrollController.scrollBottom+this.editor.const.height+this.editor.const.fontSize);for(let e=0;e<t.length;e++){var i=t[e];const r=new a.Text(i.text,{fontSize:i.fontSize,fill:i.color});r.name=i.name,r.x=i.x-{left:0,center:.5,right:1}[i.alignX||"left"]*r.width,r.y=this.editor.calculator.getYInCanvas(i.scrollHeight)-{top:0,middle:.5,bottom:1}[i.alignY||"bottom"]*r.height,this.containers.time.addChild(r)}}renderNotes(){var t;const i=this.renderObjects.notes.filter(e=>e.scrollHeight>=this.editor.scrollController.scrollBottom-this.editor.const.noteHeight&&e.scrollHeight<=this.editor.scrollController.scrollBottom+this.editor.const.height+this.editor.const.noteHeight);for(let e=0;e<i.length;e++){const s=i[e],o=void 0===s.slideId?new _e(this.editor.resourceManager.textures[s.texture],s.id):new Ee(this.editor.resourceManager.textures[s.texture],s.id,s.slideId);o.name=s.name;var r=this.editor.const.noteHeight/o.height;o.scale.set(r),o.x=s.x,o.y=this.editor.calculator.getYInCanvas(s.scrollHeight)-this.editor.const.noteHeight/2,o.width=s.width/r,o.alpha=s.alpha,i.some(e=>e.id!==s.id&&"CursorNote"!==e.id&&"CursorNote"!==s.id&&e.rawLane<=s.rawLane&&e.rawWidth>=s.rawWidth&&e.rawLane+e.rawWidth>=s.rawLane+s.rawWidth&&e.scrollHeight===s.scrollHeight)&&this.renderSelectionRect(`WarningRect-${s.id}`,o.x,o.y,s.width,this.editor.const.noteHeight,this.editor.resourceManager.theme.color.warningRect),(this.editor.selectionManager.selection.single.includes(s.id)||this.editor.selectionManager.tempSelection.single.includes(s.id)||null!==(t=this.editor.selectionManager.selection.slide[s.slideId])&&void 0!==t&&t.includes(s.id)||null!==(t=this.editor.selectionManager.tempSelection.slide[s.slideId])&&void 0!==t&&t.includes(s.id))&&this.renderSelectionRect(`SelectionRect-${s.id}`,o.x,o.y,s.width,this.editor.const.noteHeight),this.containers.note.addChild(o)}}renderArrows(){var t=this.renderObjects.arrows.filter(e=>e.scrollHeight>=this.editor.scrollController.scrollBottom-this.editor.const.arrowHeight&&e.scrollHeight<=this.editor.scrollController.scrollBottom+this.editor.const.height+this.editor.const.arrowHeight);for(let e=0;e<t.length;e++){var i=t[e];const o=new a.Sprite(this.editor.resourceManager.textures[i.texture]);o.name=i.name;var r=i.width/o.width,s=o.height*r;o.alpha=i.alpha,o.scale.set(r),o.x=i.x,o.y=this.editor.calculator.getYInCanvas(i.scrollHeight)-s,this.containers.arrow.addChild(o)}}renderCurves(){var t=this.renderObjects.curves.filter(e=>e.startScrollHeight<=this.editor.scrollController.scrollBottom+this.editor.const.height&&e.endScrollHeight>=this.editor.scrollController.scrollBottom);for(let e=0;e<t.length;e++){var i=t[e];if(!(i.points.length<2)){const r=new a.Graphics;r.name=i.name,r.beginFill(i.color,i.alpha),r.moveTo(i.points[0].x,this.editor.calculator.getYInCanvas(i.points[0].scrollHeight));for(let e=1;e<i.points.length;e++)r.lineTo(i.points[e].x,this.editor.calculator.getYInCanvas(i.points[e].scrollHeight));r.endFill(),this.containers.slide.addChild(r)}}}renderVisibleNodes(){var t=this.renderObjects.visibleNodes.filter(e=>e.scrollHeight>=this.editor.scrollController.scrollBottom-this.editor.const.noteHeight&&e.scrollHeight<=this.editor.scrollController.scrollBottom+this.editor.const.height+this.editor.const.noteHeight);for(let e=0;e<t.length;e++){var i=t[e];const o=new je(this.editor.resourceManager.textures[i.texture],i.id,i.slideId);o.alpha=i.alpha,o.name=i.name;var r,s=this.editor.const.noteHeight/o.height;o.scale.set(s),o.x=i.x+(i.width-o.width)/2,o.y=this.editor.calculator.getYInCanvas(i.scrollHeight)-o.height/2,this.containers.slide.addChild(o),(null!==(s=this.editor.selectionManager.selection.slide[i.slideId])&&void 0!==s&&s.includes(i.id)||null!==(r=this.editor.selectionManager.tempSelection.slide[i.slideId])&&void 0!==r&&r.includes(i.id))&&(r=this.editor.calculator.getLaneWidth(.1),this.renderSelectionRect(`SelectionRect-${i.id}`,i.x-r,o.y,i.width+2*r,this.editor.const.noteHeight))}}renderInvisibleNodes(){var t=this.renderObjects.invisibleNodes.filter(e=>e.scrollHeight>=this.editor.scrollController.scrollBottom-this.editor.const.noteHeight&&e.scrollHeight<=this.editor.scrollController.scrollBottom+this.editor.const.height+this.editor.const.noteHeight);for(let e=0;e<t.length;e++){var i,r,s=t[e];const o=new a.Graphics;o.name=s.name,o.lineStyle(this.editor.const.invisibleLineWidth,s.color,1),o.alpha=s.alpha,o.moveTo(s.x,0),o.lineTo(s.x+s.width,0),o.y=this.editor.calculator.getYInCanvas(s.scrollHeight),this.containers.slide.addChild(o),(null!==(i=this.editor.selectionManager.selection.slide[s.slideId])&&void 0!==i&&i.includes(s.id)||null!==(r=this.editor.selectionManager.tempSelection.slide[s.slideId])&&void 0!==r&&r.includes(s.id))&&(i=this.editor.const.noteHeight,r=this.editor.calculator.getLaneWidth(.2),this.renderSelectionRect(`SelectionRect-${s.id}`,s.x-r,o.y-i/2,s.width+2*r,i))}}updateCursorPosition(e,t){this.destroyed||((e=this.editor.calculator.getHeightByBeat(e,this.editor.timeLineManager.prime))>this.editor.const.maxHeight-this.editor.const.spaceY||t<0||11<t?this.cursor.visible=!1:(this.cursor.x=this.editor.calculator.getLaneX(t-.1),this.cursor.y=this.editor.calculator.getYInCanvas(e),this.cursor.visible=!0))}updateCurrentTimeLine(){var e,t;this.currentTimeLine&&!this.destroyed&&(t=(e=this.editor.calculator.getHeightByTime(this.editor.audioManager.currentTime))>=this.editor.scrollController.scrollBottom&&e<=this.editor.scrollController.scrollBottom+this.editor.const.height,(this.currentTimeLine.visible=t)&&(this.currentTimeLine.y=this.editor.calculator.getYInCanvas(e)))}initContainers(){this.containers.time=new a.Container,this.containers.note=new a.Container,this.containers.slide=new a.Container,this.containers.arrow=new a.Container,this.containers.selection=new a.Container,this.containers.time.name="Time",this.containers.note.name="Note",this.containers.slide.name="Slide",this.containers.arrow.name="Arrow",this.containers.selection.name="Selection",this.containers.time.zIndex=1,this.containers.arrow.zIndex=2,this.containers.slide.zIndex=3,this.containers.note.zIndex=4,this.containers.selection.zIndex=6,this.app.stage.addChild(this.containers.time),this.app.stage.addChild(this.containers.note),this.app.stage.addChild(this.containers.slide),this.app.stage.addChild(this.containers.arrow),this.app.stage.addChild(this.containers.selection)}destroyContainers(){["time","note","slide","arrow","selection"].forEach(e=>{this.containers[e].destroy({children:!0})})}get renderObjects(){return this.editor.parser.renderObjects}}class Be{constructor(e){this.editor=e,this._scrollBottom=0,this.scrollTicker=new a.Ticker,this.autoScrollDelta=0,this.scrollTicker.autoStart=!1}scrollTo(e){this.editor.audioManager.follow&&(this.editor.audioManager.currentTime=e/this.editor.const.heightPerSecond),this.scrollBottom=e}get scrollBottom(){return this._scrollBottom}set scrollBottom(e){var t=Math.min(this.editor.const.maxHeight-this.editor.const.height,Math.max(0,e));t!==this.scrollBottom&&(e=this._scrollBottom,this._scrollBottom=t,this.editor.event.dispatchScrollEvent(e,this._scrollBottom)),this.editor.renderer.render()}}class Ie{constructor(e){this.editor=e,this._prime="",this._visible=[]}get prime(){return this._prime}set prime(e){this._prime=e,this.editor.renderer.parseAndRender()}get visible(){return this._visible}set visible(e){(1===(this._visible=e).length||1<e.length&&!e.includes(this.prime))&&(this.prime=e[0]),this.editor.renderer.parseAndRender()}deleteTimeline(t){var e=this.editor.map.timelines.findIndex(e=>e.id===t);-1!==e&&(this.editor.map.timelines.splice(e,1),this.editor.map.bpms=this.editor.map.bpms.filter(e=>e.timeline===t),this.editor.map.notes=this.editor.map.notes.filter(e=>e.timeline===t),this.editor.map.slides=this.editor.map.slides.filter(e=>e.timeline===t))}}class Pe{constructor(e){this.editor=e,this.selection={single:[],slide:{}},this.tempSelection={single:[],slide:{}},this.oldSelection={single:[],slide:{}},this.selectionBox=[0,0,0,0]}emptySelection(){this.selection.single=[],this.selection.slide={}}isEmpty(e=this.selection){return 0===e.single.length&&0===Object.keys(e).length}isUniqueArrayEqual(e,t){return e.length===t.length&&e.every(e=>t.includes(e))}isSelectionEqual(t,i){if(!this.isUniqueArrayEqual(t.single,i.single))return!1;const e=Object.keys(t.slide);var r=Object.keys(i.slide);return!!this.isUniqueArrayEqual(e,r)&&e.every(e=>this.isUniqueArrayEqual(t.slide[e],i.slide[e]))}mergeTempSelection(){this.selection.single.push(...this.tempSelection.single);for(const t in this.tempSelection.slide){var e;Object.prototype.hasOwnProperty.call(this.tempSelection.slide,t)&&(e=this.tempSelection.slide[t],this.selection.slide[t]||(this.selection.slide[t]=[]),this.selection.slide[t].push(...e))}this.tempSelection.single=[],this.tempSelection.slide={}}findSelectedNote(){const s=Math.min(this.selectionBox[1],this.selectionBox[3]),o=Math.max(this.selectionBox[1],this.selectionBox[3]),n=Math.min(this.selectionBox[0],this.selectionBox[2]),a=Math.max(this.selectionBox[0],this.selectionBox[2]);this.tempSelection.single=[],this.tempSelection.slide={};var e=t=>{var i;for(let e=0;e<t.length;e++){var r=t[e];"CursorNote"!==r.id&&r.scrollHeight>=s&&r.scrollHeight<=o&&r.x>=n&&r.x+r.width<=a&&(void 0===r.slideId||null!==(i=this.selection.slide[r.slideId])&&void 0!==i&&i.includes(r.id)?this.selection.single.includes(r.id)||this.tempSelection.single.push(r.id):(this.tempSelection.slide[r.slideId]||(this.tempSelection.slide[r.slideId]=[]),this.tempSelection.slide[r.slideId].push(r.id)))}},t=this.editor.parser.renderObjects;e(t.notes),e(t.visibleNodes),e(t.invisibleNodes)}getNotesBySelection(i){return{single:i.single.map(t=>this.editor.map.notes.find(e=>e.id===t)),slide:Object.keys(i.slide).map(t=>{const e=this.editor.map.slides.find(e=>e.id===t);return Object.assign(Object.assign({},e),{notes:e.notes.filter(e=>i.slide[t].includes(e.id))})})}}deleteNotesBySelection(r){for(let e=0;e<r.single.length;e++){const i=r.single[e];var t=this.editor.map.notes.findIndex(e=>e.id===i);-1!==t&&this.editor.map.notes.splice(t,1)}for(const l in r.slide){var e,s,o=r.slide[l],n=this.editor.map.slides.findIndex(e=>e.id===l);const d=this.editor.map.slides[n];let t=null,i=null;for(let e=0;e<o.length;e++){const c=o[e];var a=d.notes.findIndex(e=>e.id===c),[a]=d.notes.splice(a,1);a.type===le.PJSK.NoteType.SlideStart?t=a:a.type!==le.PJSK.NoteType.SlideEndDefault&&a.type!==le.PJSK.NoteType.SlideEndFlick||(i=a)}if(d.notes.length<=1)this.editor.map.slides.splice(n,1);else{if(t){const h=d.notes[0];h.type=le.PJSK.NoteType.SlideStart,void 0===h.lane&&(e=this.editor.parser.renderObjects.visibleNodes.find(e=>e.id===h.id),s=this.editor.calculator.getLaneWidth(1),h.lane=Math.round((e.x-this.editor.calculator.getLaneX(0))/s),h.width=Math.round(e.width/s),h.curve=t.curve)}if(i){const u=d.notes[d.notes.length-1];u.type=i.type,i.type===le.PJSK.NoteType.SlideEndFlick&&(u.direction=i.direction,i.critical&&(u.critical=i.critical)),void 0===u.lane&&(e=this.editor.parser.renderObjects.visibleNodes.find(e=>e.id===u.id),s=this.editor.calculator.getLaneWidth(1),u.width=Math.round(e.width/s),u.lane=Math.round((e.x-this.editor.calculator.getLaneX(0))/s))}}}this.editor.renderer.parseAndRender()}}class Ae{constructor(e,t){this.editor=e,this.loader=new a.Loader,this.theme=Object.assign(Object.assign({},t),{color:Object.assign({},se,t.color)})}loadResource(){return new Promise(e=>{this.loader.add(Object.entries(this.theme.image).concat(Object.entries(this.theme.audio)).map(([e,t])=>({name:e,url:t}))).load(()=>{this.textures=this.loader.resources.sprite.textures,e()}),this.loader.onProgress.add((e,t)=>{this.editor.event.emit(me.ResourceLoadProgress,{loader:e,resource:t})}),this.loader.onError.add((e,t,i)=>{this.editor.event.emit(me.ResourceLoadError,{error:e,loader:t,resource:i})})})}}class Re{constructor(e,t){this.container=e,this._beatSlice=1,this.resourceManager=new Ae(this,t),this.const=new oe(this),this.event=new fe(this),this.handler=new be(this),this.parser=new xe(this),this.calculator=new re(this),this.scrollController=new Be(this),this.audioManager=new ie(this),this.renderer=new ke(this),this.timeLineManager=new Ie(this),this.selectionManager=new Pe(this),this.cursorManager=new de(this)}start(){this.handler.listen(),this.renderer.renderOnce(),this.renderer.parseAndRender()}destroy(){this.handler.removeAll(),this.event.dispatchDestroyEvent(),this.audioManager.destroy(),this.renderer.destroy(),a.utils.clearTextureCache()}set map(e){this._map=e,this.timeLineManager.visible.some(e=>this.map.timelines.map(e=>e.id).includes(e))||(this.timeLineManager.visible=[this.map.timelines[0].id]),this.renderer.parseAndRender()}get map(){return this._map}set beatSlice(e){this._beatSlice=e,this.renderer.parseAndRender()}get beatSlice(){return this._beatSlice}fraction(e){return new ce.Fraction([1,...e])}}var We,De,Ye,Fe,Ue;function Xe(e){return document.querySelector(e)}We="* {\n\tmargin: 0;\n}\n\nhtml, body {\n\twidth: 100%;\n\theight: 100%;\n}\n\nbody {\n\tuser-select: none;\n}\n\n#selector {\n\theight: 100px;\n\tposition: relative;\n}\n\n#app {\n\theight: calc(100% - 105px);\n\tmax-width: 600px;\n}\n\n#progress {\n\tmax-width: 600px;\n\ttext-align: center;\n\tmargin-top: 16px;\n}\n",Fe=(De=void 0===De?{}:De).insertAt,We&&"undefined"!=typeof document&&(Ye=document.head||document.getElementsByTagName("head")[0],(De=document.createElement("style")).type="text/css","top"===Fe&&Ye.firstChild?Ye.insertBefore(De,Ye.firstChild):Ye.appendChild(De),De.styleSheet?De.styleSheet.cssText=We:De.appendChild(document.createTextNode(We))),Ue=window,document.addEventListener("DOMContentLoaded",function(){return p(this,void 0,void 0,function*(){var e=yield(yield fetch("pjsk/editor-theme.json")).json();const i=new Re(Xe("#app"),e);Ue.editor=i;const t=Xe("#progress");i.event.on(me.ResourceLoadProgress,({loader:e})=>{t.innerHTML=`Loading ${e.progress.toFixed(2)}%`}),i.event.on(me.ResourceLoadError,({error:e})=>{console.error("load error:",e)}),yield i.resourceManager.loadResource(),t.style.display="none";const r=e=>{i.map=e,i.audioManager.totalTime=180,i.scrollController.scrollTo(0)},s=Xe("#id"),o=Xe("#diff");Xe("#load").addEventListener("click",()=>p(this,void 0,void 0,function*(){const e=yield fetch(`https://assets.pjsek.ai/file/pjsekai-assets/startapp/music/music_score/${s.value.padStart(4,"0")}_01/${o.value}`);var t=te(yield e.text());r(t)}));const n=Xe("#container"),a=Xe("#text");Xe("#input").addEventListener("click",()=>{n.style.display="none"===n.style.display?"block":"none"}),Xe("#draw").addEventListener("click",()=>{var e;n.style.display="none",a.value&&(e=te(a.value),r(e))});const l=e=>{i.const.heightPerSecondRaw*=e};Xe("#add").addEventListener("click",()=>{l(1.5)}),Xe("#minus").addEventListener("click",()=>{l(1/1.5)});const d=Xe("#bottom");i.event.on(me.Scroll,e=>{d.value=e.newScrollBottom.toString()}),Xe("#scroll").addEventListener("click",()=>{i.scrollController.scrollTo(parseInt(d.value))}),Xe("#slice").addEventListener("change",function(){i.beatSlice=parseInt(this.value)}),Xe("#music").addEventListener("input",function(){var e=this.files[0];i.audioManager.loadAudio(e)}),Xe("#play").addEventListener("click",()=>{i.audioManager.play()}),Xe("#pause").addEventListener("click",()=>{i.audioManager.pause()}),Xe("#stop").addEventListener("click",()=>{i.audioManager.stop()}),Xe("#follow").addEventListener("input",function(){i.audioManager.follow=this.checked}),Xe("#delete").addEventListener("click",()=>{i.selectionManager.deleteNotesBySelection(i.selectionManager.selection)});const c=document.createElement("input");c.type="file",c.accept=".json",Xe("#import").addEventListener("click",()=>{c.click()}),c.addEventListener("change",()=>p(this,void 0,void 0,function*(){r(JSON.parse(yield c.files[0].text()))})),Xe("#export").addEventListener("click",()=>{var e=JSON.stringify(i.map),e=new Blob([e],{type:"application/json"}),e=URL.createObjectURL(e);const t=document.createElement("a");t.href=e,t.download="map.json",t.click(),URL.revokeObjectURL(e)});e=e=>()=>{i.cursorManager.type=e};function h(){var e=parseFloat(prompt("Please enter the BPM value:","120"));isNaN(e)||e<=0?alert("Invalid BPM value!"):(i.cursorManager.bpm=e,i.cursorManager.type=ae.BPM)}Xe("#note-default").addEventListener("click",e(ae.Default)),Xe("#note-tap").addEventListener("click",e(ae.Tap)),Xe("#note-flick").addEventListener("click",e(ae.Flick)),Xe("#note-slide").addEventListener("click",e(ae.Slide)),Xe("#note-bpm").addEventListener("click",h),document.addEventListener("keydown",e=>{switch(e.key){case"1":i.cursorManager.type=ae.Default;break;case"2":i.cursorManager.type=ae.Tap;break;case"3":i.cursorManager.type=ae.Flick;break;case"4":i.cursorManager.type=ae.Slide;break;case"b":h();break;case"q":i.cursorManager.width--;break;case"e":i.cursorManager.width++;break;case"c":i.cursorManager.critical=!i.cursorManager.critical;break;case"r":(i.cursorManager.type===ae.Flick||i.cursorManager.type===ae.Slide&&i.cursorManager.slideHeadPlaced&&i.cursorManager.flickEnd)&&(i.cursorManager.direction={[z.FlickDirection.Up]:z.FlickDirection.Right,[z.FlickDirection.Right]:z.FlickDirection.Left,[z.FlickDirection.Left]:z.FlickDirection.Up}[i.cursorManager.direction]);break;case"x":i.cursorManager.type===ae.SlideNode&&(i.cursorManager.nodeVisible=!i.cursorManager.nodeVisible);break;case"v":(i.cursorManager.type===ae.Slide&&i.cursorManager.slideHeadPlaced||i.cursorManager.type===ae.SlideNode)&&(i.cursorManager.curve={[z.CurveType.Linear]:z.CurveType.EaseIn,[z.CurveType.EaseIn]:z.CurveType.EaseOut,[z.CurveType.EaseOut]:z.CurveType.Linear}[i.cursorManager.curve]);break;case"f":i.cursorManager.type===ae.Slide&&i.cursorManager.slideHeadPlaced&&(i.cursorManager.flickEnd=!i.cursorManager.flickEnd);break;case"Escape":i.cursorManager.type===ae.Slide&&i.cursorManager.slideHeadPlaced&&i.cursorManager.endSlidePlacement();break;case"Delete":i.selectionManager.deleteNotesBySelection(i.selectionManager.selection)}});const u=yield fetch("pjsk/map/test.json");e=yield u.json();r(e),i.start()})})}(PIXI);
