!function(){"use strict";function e(i){if(i&&i.__esModule)return i;var n=Object.create(null);return i&&Object.keys(i).forEach(function(e){var t;"default"!==e&&(t=Object.getOwnPropertyDescriptor(i,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return i[e]}}))}),n.default=i,Object.freeze(n)}var u,h=e(PIXI);function t(i){if(i.__esModule)return i;var n=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(e){var t=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return i[e]}})}),n}(H=P=P||{}).BLUE="blue",H.GREEN="green",H.YELLOW="yellow",H.RED="red",H.PURPLE="purple",H.PINK="pink",(R=u=u||{})[R.Tap=0]="Tap",R[R.Flick=1]="Flick",R[R.SlideStart=2]="SlideStart",R[R.SlideInvisible=3]="SlideInvisible",R[R.SlideVisible=4]="SlideVisible",R[R.SlideEndDefault=5]="SlideEndDefault",R[R.SlideEndFlick=6]="SlideEndFlick",(P=V=V||{})[P.None=0]="None",P[P.Linear=1]="Linear",P[P.EaseIn=2]="EaseIn",P[P.EaseOut=3]="EaseOut",P[P.EaseInOut=4]="EaseInOut",P[P.CubicBezier=5]="CubicBezier",(H=Y=Y||{})[H.Up=0]="Up",H[H.Left=1]="Left",H[H.Right=2]="Right";var l=4,c=1e-7,d=10,r="function"==typeof Float32Array;function n(e,t){return 1-3*t+3*e}function s(e,t){return 3*t-6*e}function p(e,t,i){return((n(t,i)*e+s(t,i))*e+3*t)*e}function f(e,t,i){return 3*n(t,i)*e*e+2*s(t,i)*e+3*t}function m(e){return e}function g(s,t,a,i){if(!(0<=s&&s<=1&&0<=a&&a<=1))throw new Error("bezier x values must be in [0, 1] range");if(s===t&&a===i)return m;for(var o=new(r?Float32Array:Array)(11),e=0;e<11;++e)o[e]=p(.1*e,s,a);function n(e){for(var t=0,i=1;10!==i&&o[i]<=e;++i)t+=.1;var n=t+.1*((e-o[--i])/(o[i+1]-o[i])),r=f(n,s,a);return.001<=r?function(e,t,i,n){for(var r=0;r<l;++r){var s=f(t,i,n);if(0===s)return t;t-=(p(t,i,n)-e)/s}return t}(e,n,s,a):0===r?n:function(e,t,i,n,r){for(var s,a,o=0;0<(s=p(a=t+(i-t)/2,n,r)-e)?i=a:t=a,Math.abs(s)>c&&++o<d;);return a}(e,t,t+.1,s,a)}return function(e){return 0===e?0:1===e?1:p(n(e),t,i)}}var i;class v{constructor(e,t,i){this.scrollBottom=0,this.colors={lane:0,bpm:65535,beat:{third:16711680,half:0,quarter:255},slide:14285551,slideNote:3204520,critical:16579021,criticalNote:15852573},this.beatLine={third:!1,half:!0,quarter:!0};var{width:n,height:r}=e.getBoundingClientRect(),s=window.devicePixelRatio;this.resolution=s,this.setMap(t),this.app=new h.Application({backgroundAlpha:0,width:n,height:r,antialias:!0,resolution:s}),this.const={resolution:s,fontSize:18/s,heightPerSecond:3200/s,spaceY:200/s,width:n,height:r,paddingX:4/s,paddingY:2/s,lineWidth:1/s,noteHeight:32/s,arrowHeight:32/s,maxHeight:0},this.const.maxHeight=this.const.heightPerSecond*i+2*this.const.spaceY,this.container={lane:new h.Container,time:new h.Container,note:new h.Container,slide:new h.Container,arrow:new h.Container},this.scrollBottom/=s,this.app.view.style.width=n+"px",this.app.view.style.height=r+"px",e.appendChild(this.app.view),this.app.stage.addChild(this.container.lane),this.app.stage.sortableChildren=!0,this.container.lane.name="Lane",this.notes=h.Loader.shared.resources["images/sprite.json"].textures,this.event=new EventTarget,this.start()}start(){this.drawLane(),this.reRender(),this.app.view.addEventListener("wheel",e=>{e=Math.min(this.const.maxHeight,Math.max(0,this.scrollBottom-e.deltaY/this.resolution));this.scrollTo(e)})}scrollTo(e){this.scrollBottom=Math.min(this.const.maxHeight,Math.max(0,e)),this.event.dispatchEvent(new CustomEvent("scroll",{detail:{scrollBottom:this.scrollBottom}})),this.reRender()}reRender(){this.container.time.destroy({children:!0}),this.container.note.destroy({children:!0}),this.container.slide.destroy({children:!0}),this.container.arrow.destroy({children:!0}),this.container.time=new h.Container,this.container.note=new h.Container,this.container.slide=new h.Container,this.container.arrow=new h.Container,this.container.time.name="Time",this.container.note.name="Note",this.container.slide.name="Slide",this.container.arrow.name="Arrow",this.container.time.zIndex=5,this.container.arrow.zIndex=7,this.container.slide.zIndex=8,this.container.note.zIndex=10,this.app.stage.addChild(this.container.time),this.app.stage.addChild(this.container.note),this.app.stage.addChild(this.container.slide),this.app.stage.addChild(this.container.arrow),this.drawBeat(),this.drawBPM(),this.drawNote(),this.drawSlide()}destroy(){this.app.destroy(!0,{children:!0})}static loadResource(i,n){return new Promise(e=>{const t=h.Loader.shared;t.add("images/sprite.json").load(()=>{console.log("load resources completed"),e()}),t.onLoad.add(i),t.onError.add(n)})}minusBeat(e,t){return this.fractionToDecimal(e)-this.fractionToDecimal(t)}getTimeByBeat(t){let i=0;for(let e=0;e<this.map.bpms.length;e++){var n=this.map.bpms[e];if(this.minusBeat(t,n.beat)<=0)break;var r=this.map.bpms[e+1];i+=(r&&0<this.minusBeat(t,r.beat)?this.minusBeat(r.beat,n.beat):this.minusBeat(t,n.beat))/n.bpm*60}return i}getHeightByBeat(e){return this.const.spaceY+this.getTimeByBeat(e)*this.const.heightPerSecond}getHeightByTime(e){return this.const.spaceY+e*this.const.heightPerSecond}formatTime(e){return`${Math.floor(e/60)}:${(e%60).toFixed(3).padStart(6,"0")}`}getYInCanvas(e){return this.const.height-(e-this.scrollBottom)}getLaneX(e){return this.const.width*(6*e+14)/100}fractionToDecimal(e){return e[0]+e[1]/e[2]}drawBPM(){for(let e=0;e<this.map.bpms.length;e++){const n=this.map.bpms[e];var t=this.getTimeByBeat(n.beat),i=this.getHeightByTime(t);if(i>=this.scrollBottom&&i<=this.scrollBottom+this.const.height){const r=new h.Graphics;r.name=`BPM-${n.id}-line`,r.lineStyle(this.const.lineWidth,this.colors.bpm,1),r.moveTo(0,0),r.lineTo(this.const.width,0),r.y=this.getYInCanvas(i);const s=new h.Text(this.formatTime(t),{fontSize:this.const.fontSize,fill:this.colors.bpm,align:"left"});s.name=`BPM-${n.id}-time`,s.x=this.const.paddingX,s.y=this.getYInCanvas(i)-s.height-this.const.paddingY;const a=new h.Text(n.bpm.toString(),{fontSize:this.const.fontSize,fill:this.colors.bpm,align:"left"});a.name=`BPM-${n.id}-value`,a.x=this.getLaneX(12)+this.const.paddingX,a.y=this.getYInCanvas(i)-a.height-this.const.paddingY,this.container.time.addChild(r),this.container.time.addChild(s),this.container.time.addChild(a)}else if(i>this.scrollBottom+this.const.height)break}}drawBeatLine(e,t,i,n,r=!1){const s=new h.Graphics;var a=this.fractionToDecimal(e);if(s.name=`Beat-${a}-line`,s.lineStyle(this.const.lineWidth,t,i),s.moveTo(this.getLaneX(0),0),s.lineTo(r?this.const.width:this.getLaneX(12),0),s.y=this.getYInCanvas(n),r){const o=new h.Text(`${e[0]+1}:${e[1]/12+1}`,{fontSize:this.const.fontSize,fill:t,align:"left"});o.name=`Beat-${a}-beat`,o.x=this.const.width-o.width-this.const.paddingX,o.y=this.getYInCanvas(n)-o.height-this.const.paddingY,this.container.time.addChild(o)}this.container.time.addChild(s)}drawBeat(){this.container.time.destroy({children:!0}),this.container.time=new h.Container;for(let e=0;;e++){var t=[Math.floor(e/48),e%48,48],i=this.getTimeByBeat(t),i=this.getHeightByTime(i);if(i-this.const.height>this.const.maxHeight-this.const.spaceY)break;if(i>=this.scrollBottom&&i<=this.scrollBottom+this.const.height)e%12==0?this.drawBeatLine(t,this.colors.beat.half,1,i,!0):e%6==0&&this.beatLine.half?this.drawBeatLine(t,this.colors.beat.half,.2,i):e%4==0&&this.beatLine.third?this.drawBeatLine(t,this.colors.beat.third,.4,i):e%3==0&&this.beatLine.quarter&&this.drawBeatLine(t,this.colors.beat.quarter,.4,i);else if(i>this.scrollBottom+this.const.height)break}this.app.stage.addChild(this.container.time)}drawLane(){for(let e=0;e<=12;e++){const i=new h.Graphics;i.name=`Lane-${e}`;var t=this.const.width*((6*e+14)/100);i.lineStyle(this.const.lineWidth,this.colors.lane,e%2?.2:1),i.moveTo(0,0),i.lineTo(0,this.const.height),i.x=t,this.container.lane.addChild(i)}}nineSliceNote(e){return new h.NineSlicePlane(e,91,0,91,0)}drawBaseNote(e,t,i){const n=this.nineSliceNote(this.notes[t]);n.name=`Note-${t}-${e.id}`;t=this.const.noteHeight/n.height;n.scale.set(t),n.x=this.getLaneX(e.lane)-.006*this.const.width,n.y=this.getYInCanvas(i)-this.const.noteHeight/2,n.width=.06*(e.width+.2)*this.const.width/t,n.interactive=!0,this.container.note.addChild(n)}drawFlickArrow(e,t){const i=Math.min(6,e.width);var n=`flick_arrow_${e.critical?"critical_":""}${i.toString().padStart(2,"0")}${{0:"",1:"_left",2:"_right"}[e.direction]}`;const r=new h.Sprite(this.notes[n]);r.name=`Arrow-${e.id}`;var s=.8*i*.06*this.const.width/r.width,n=r.height*s;r.scale.set(s),r.x=this.getLaneX(e.lane+(e.width-i)/2+.1*i),r.y=this.getYInCanvas(t)-n,this.container.arrow.addChild(r)}drawCurve(e,t,i,n,r=!1){const s=new h.Graphics;s.name=`Curve-${e.id}`;var a,o,l=[!1,[0,0,1,1],[1,.5,1,1],[0,0,0,.5],[.42,0,.58,1],e.bezier][e.curve];l&&(o=[this.getLaneX(e.lane+.1),this.getYInCanvas(i)],a=[this.getLaneX(t.lane+.1),this.getYInCanvas(n)],s.beginFill(r?this.colors.critical:this.colors.slide,.8),s.moveTo(o[0],o[1]),s.bezierCurveTo(o[0]+l[0]*(a[0]-o[0]),o[1]+l[1]*(a[1]-o[1]),o[0]+l[2]*(a[0]-o[0]),o[1]+l[3]*(a[1]-o[1]),a[0],a[1]),s.lineTo(this.getLaneX(t.lane+t.width-.1),this.getYInCanvas(n)),a=[this.getLaneX(e.lane+e.width-.1),this.getYInCanvas(i)],o=[this.getLaneX(t.lane+t.width-.1),this.getYInCanvas(n)],[e,i,t,n]=l,l=[1-t,1-n,1-e,1-i],s.bezierCurveTo(o[0]+l[0]*(a[0]-o[0]),o[1]+l[1]*(a[1]-o[1]),o[0]+l[2]*(a[0]-o[0]),o[1]+l[3]*(a[1]-o[1]),a[0],a[1]),s.endFill()),this.container.slide.addChild(s)}drawInvisibleNote(e,t,i=!1){const n=new h.Graphics;n.name=`Invisible-${e.id}`,n.lineStyle(3*this.const.lineWidth,i?this.colors.criticalNote:this.colors.slideNote,1),n.moveTo(this.getLaneX(e.lane+.1),0),n.lineTo(this.getLaneX(e.lane+e.width-.1),0),n.y=this.getYInCanvas(t),this.container.slide.addChild(n)}drawVisibleNote(e,t,i=!1){const n=new h.Sprite(this.notes[`slide_node${i?"_critical":""}`]);n.name=`Visible-${e.id}`,void 0!==e.lane&&(i=this.const.noteHeight/n.height,n.scale.set(i),n.x=this.getLaneX(e.lane+e.width/2)-n.width/2,n.y=this.getYInCanvas(t)-n.height/2,this.container.slide.addChild(n))}drawSkippedVisibleNote(t,i,n,r){var s=this.getHeightByBeat(i.beat),a=t.notes[r],o=this.getHeightByBeat(a.beat),e=[!1,[0,0,1,1],[0,0,0,.5],[1,.5,1,1],[1,.5,0,.5],i.bezier][i.curve];const l=e&&g(e[0],e[1],e[2],e[3]);for(let e=n;e<r;e++){var h=t.notes[e],c=this.getHeightByBeat(h.beat);if(c>=this.scrollBottom-this.const.noteHeight&&c<=this.scrollBottom+this.const.height+this.const.noteHeight){var d=(c-s)/(o-s);this.drawVisibleNote({id:h.id,type:u.SlideVisible,beat:h.beat,width:i.width+(a.width-i.width)*l(d),lane:i.lane+(a.lane-i.lane)*l(d)},c,t.critical)}else if(c>this.scrollBottom+this.const.height+this.const.noteHeight)break}}drawSlide(){for(let e=0;e<this.map.slides.length;e++){const o=this.map.slides[e];if(this.getHeightByBeat(o.notes[0].beat)>this.scrollBottom+this.const.height+this.const.noteHeight)return;for(let i=0;i<o.notes.length;i++){var n,r=o.notes[i],s=o.notes[i+1],a=this.getHeightByBeat(r.beat);let e=s,t=i;s&&void 0===s.lane&&(t=i+1+o.notes.slice(i+1).findIndex(e=>void 0!==e.lane),e=o.notes[t]),void 0!==r.lane&&e&&this.getHeightByBeat(r.beat)<this.scrollBottom+this.const.height+this.const.noteHeight&&this.getHeightByBeat(e.beat)>this.scrollBottom-this.const.noteHeight&&(n=this.getHeightByBeat(e.beat),this.drawCurve(r,e,a,n,o.critical),void 0===s.lane&&this.drawSkippedVisibleNote(o,r,i+1,t)),a>=this.scrollBottom-this.const.noteHeight&&a<=this.scrollBottom+this.const.height+this.const.noteHeight&&([u.SlideStart,u.SlideEndDefault].includes(r.type)?this.drawBaseNote(r,o.critical?"critical":"slide",a):r.type===u.SlideEndFlick?(this.drawBaseNote(r,r.critical||o.critical?"critical":"flick",a),this.drawFlickArrow({...r,critical:r?.critical||o.critical},a)):r.type===u.SlideInvisible?this.drawInvisibleNote(r,a,o.critical):r.type===u.SlideVisible&&this.drawVisibleNote(r,a,o.critical))}}}drawNote(){for(let e=0;e<this.map.notes.length;e++){var t=this.map.notes[e],i=this.getHeightByBeat(t.beat);if(i>=this.scrollBottom-this.const.noteHeight&&i<=this.scrollBottom+this.const.height+this.const.noteHeight&&(t.type&&this.drawFlickArrow(t,i),this.drawBaseNote(t,t.critical?"critical":t.type?"flick":"tap",i)),i>this.scrollBottom+this.const.height+this.const.noteHeight)break}}setMap(e){this.map=e,this.map.bpms=this.map.bpms.sort((e,t)=>this.minusBeat(e.beat,t.beat)),this.map.notes=this.map.notes.sort((e,t)=>this.minusBeat(e.beat,t.beat)),this.map.slides=this.map.slides.map(e=>({...e,notes:e.notes.sort((e,t)=>this.minusBeat(e.beat,t.beat))})).sort((e,t)=>this.minusBeat(e.notes[0].beat,t.notes[0].beat)),console.log(this.map)}}var a=new Uint8Array(16);function y(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(a)}var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function b(e){return"string"==typeof e&&o.test(e)}for(var w,E,B=[],T=0;T<256;++T)B.push((T+256).toString(16).substr(1));function I(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,t=(B[e[t+0]]+B[e[t+1]]+B[e[t+2]]+B[e[t+3]]+"-"+B[e[t+4]]+B[e[t+5]]+"-"+B[e[t+6]]+B[e[t+7]]+"-"+B[e[t+8]]+B[e[t+9]]+"-"+B[e[t+10]]+B[e[t+11]]+B[e[t+12]]+B[e[t+13]]+B[e[t+14]]+B[e[t+15]]).toLowerCase();if(!b(t))throw TypeError("Stringified UUID is invalid");return t}var C=0,S=0;function L(e){if(!b(e))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i}function N(e,a,o){function t(e,t,i,n){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),16!==(t="string"==typeof t?L(t):t).length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var r=new Uint8Array(16+e.length);if(r.set(t),r.set(e,t.length),(r=o(r))[6]=15&r[6]|a,r[8]=63&r[8]|128,i){n=n||0;for(var s=0;s<16;++s)i[n+s]=r[s];return i}return I(r)}try{t.name=e}catch(e){}return t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t}function A(e){return 14+(e+64>>>9<<4)+1}function O(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function k(e,t,i,n,r,s){return O((s=O(O(t,e),O(n,s)))<<r|s>>>32-r,i)}function F(e,t,i,n,r,s,a){return k(t&i|~t&n,e,t,r,s,a)}function D(e,t,i,n,r,s,a){return k(t&n|i&~n,e,t,r,s,a)}function x(e,t,i,n,r,s,a){return k(t^i^n,e,t,r,s,a)}function M(e,t,i,n,r,s,a){return k(i^(t|~n),e,t,r,s,a)}var R=N("v3",48,function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var i=0;i<t.length;++i)e[i]=t.charCodeAt(i)}return function(e){for(var t=[],i=32*e.length,n="0123456789abcdef",r=0;r<i;r+=8){var s=e[r>>5]>>>r%32&255,s=parseInt(n.charAt(s>>>4&15)+n.charAt(15&s),16);t.push(s)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[A(t)-1]=t;for(var i=1732584193,n=-271733879,r=-1732584194,s=271733878,a=0;a<e.length;a+=16){var o=i,l=n,h=r,c=s;i=F(i,n,r,s,e[a],7,-680876936),s=F(s,i,n,r,e[a+1],12,-389564586),r=F(r,s,i,n,e[a+2],17,606105819),n=F(n,r,s,i,e[a+3],22,-1044525330),i=F(i,n,r,s,e[a+4],7,-176418897),s=F(s,i,n,r,e[a+5],12,1200080426),r=F(r,s,i,n,e[a+6],17,-1473231341),n=F(n,r,s,i,e[a+7],22,-45705983),i=F(i,n,r,s,e[a+8],7,1770035416),s=F(s,i,n,r,e[a+9],12,-1958414417),r=F(r,s,i,n,e[a+10],17,-42063),n=F(n,r,s,i,e[a+11],22,-1990404162),i=F(i,n,r,s,e[a+12],7,1804603682),s=F(s,i,n,r,e[a+13],12,-40341101),r=F(r,s,i,n,e[a+14],17,-1502002290),n=F(n,r,s,i,e[a+15],22,1236535329),i=D(i,n,r,s,e[a+1],5,-165796510),s=D(s,i,n,r,e[a+6],9,-1069501632),r=D(r,s,i,n,e[a+11],14,643717713),n=D(n,r,s,i,e[a],20,-373897302),i=D(i,n,r,s,e[a+5],5,-701558691),s=D(s,i,n,r,e[a+10],9,38016083),r=D(r,s,i,n,e[a+15],14,-660478335),n=D(n,r,s,i,e[a+4],20,-405537848),i=D(i,n,r,s,e[a+9],5,568446438),s=D(s,i,n,r,e[a+14],9,-1019803690),r=D(r,s,i,n,e[a+3],14,-187363961),n=D(n,r,s,i,e[a+8],20,1163531501),i=D(i,n,r,s,e[a+13],5,-1444681467),s=D(s,i,n,r,e[a+2],9,-51403784),r=D(r,s,i,n,e[a+7],14,1735328473),n=D(n,r,s,i,e[a+12],20,-1926607734),i=x(i,n,r,s,e[a+5],4,-378558),s=x(s,i,n,r,e[a+8],11,-2022574463),r=x(r,s,i,n,e[a+11],16,1839030562),n=x(n,r,s,i,e[a+14],23,-35309556),i=x(i,n,r,s,e[a+1],4,-1530992060),s=x(s,i,n,r,e[a+4],11,1272893353),r=x(r,s,i,n,e[a+7],16,-155497632),n=x(n,r,s,i,e[a+10],23,-1094730640),i=x(i,n,r,s,e[a+13],4,681279174),s=x(s,i,n,r,e[a],11,-358537222),r=x(r,s,i,n,e[a+3],16,-722521979),n=x(n,r,s,i,e[a+6],23,76029189),i=x(i,n,r,s,e[a+9],4,-640364487),s=x(s,i,n,r,e[a+12],11,-421815835),r=x(r,s,i,n,e[a+15],16,530742520),n=x(n,r,s,i,e[a+2],23,-995338651),i=M(i,n,r,s,e[a],6,-198630844),s=M(s,i,n,r,e[a+7],10,1126891415),r=M(r,s,i,n,e[a+14],15,-1416354905),n=M(n,r,s,i,e[a+5],21,-57434055),i=M(i,n,r,s,e[a+12],6,1700485571),s=M(s,i,n,r,e[a+3],10,-1894986606),r=M(r,s,i,n,e[a+10],15,-1051523),n=M(n,r,s,i,e[a+1],21,-2054922799),i=M(i,n,r,s,e[a+8],6,1873313359),s=M(s,i,n,r,e[a+15],10,-30611744),r=M(r,s,i,n,e[a+6],15,-1560198380),n=M(n,r,s,i,e[a+13],21,1309151649),i=M(i,n,r,s,e[a+4],6,-145523070),s=M(s,i,n,r,e[a+11],10,-1120210379),r=M(r,s,i,n,e[a+2],15,718787259),n=M(n,r,s,i,e[a+9],21,-343485551),i=O(i,o),n=O(n,l),r=O(r,h),s=O(s,c)}return[i,n,r,s]}(function(e){if(0===e.length)return[];for(var t=8*e.length,i=new Uint32Array(A(t)),n=0;n<t;n+=8)i[n>>5]|=(255&e[n/8])<<n%32;return i}(e),8*e.length))});function U(e,t){return e<<t|e>>>32-t}var V=N("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var r=0;r<n.length;++r)e.push(n.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var s=e.length/4+2,a=Math.ceil(s/16),o=new Array(a),l=0;l<a;++l){for(var h=new Uint32Array(16),c=0;c<16;++c)h[c]=e[64*l+4*c]<<24|e[64*l+4*c+1]<<16|e[64*l+4*c+2]<<8|e[64*l+4*c+3];o[l]=h}o[a-1][14]=8*(e.length-1)/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<a;++d){for(var u=new Uint32Array(80),p=0;p<16;++p)u[p]=o[d][p];for(var f=16;f<80;++f)u[f]=U(u[f-3]^u[f-8]^u[f-14]^u[f-16],1);for(var m=i[0],g=i[1],v=i[2],y=i[3],b=i[4],w=0;w<80;++w)var E=Math.floor(w/20),E=U(m,5)+function(e,t,i,n){switch(e){case 0:return t&i^~t&n;case 1:return t^i^n;case 2:return t&i^t&n^i&n;case 3:return t^i^n}}(E,g,v,y)+b+t[E]+u[w]>>>0,b=y,y=v,v=U(g,30)>>>0,g=m,m=E;i[0]=i[0]+m>>>0,i[1]=i[1]+g>>>0,i[2]=i[2]+v>>>0,i[3]=i[3]+y>>>0,i[4]=i[4]+b>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]});var P=t(Object.freeze({__proto__:null,v1:function(e,t,i){var n=t&&i||0,r=t||new Array(16),s=(e=e||{}).node||w,a=void 0!==e.clockseq?e.clockseq:E;null!=s&&null!=a||(l=e.random||(e.rng||y)(),null==s&&(s=w=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==a&&(a=E=16383&(l[6]<<8|l[7])));var o=void 0!==e.msecs?e.msecs:Date.now(),i=void 0!==e.nsecs?e.nsecs:S+1,l=o-C+(i-S)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),1e4<=(i=(l<0||C<o)&&void 0===e.nsecs?0:i))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");C=o,E=a,i=(1e4*(268435455&(o+=122192928e5))+(S=i))%4294967296,r[n++]=i>>>24&255,r[n++]=i>>>16&255,r[n++]=i>>>8&255,r[n++]=255&i,o=o/4294967296*1e4&268435455,r[n++]=o>>>8&255,r[n++]=255&o,r[n++]=o>>>24&15|16,r[n++]=o>>>16&255,r[n++]=a>>>8|128,r[n++]=255&a;for(var h=0;h<6;++h)r[n+h]=s[h];return t||I(r)},v3:R,v4:function(e,t,i){var n=(e=e||{}).random||(e.rng||y)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var r=0;r<16;++r)t[i+r]=n[r];return t}return I(n)},v5:V,NIL:"00000000-0000-0000-0000-000000000000",version:function(e){if(!b(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)},validate:b,stringify:I,parse:L})),Y={},H={};Object.defineProperty(H,"__esModule",{value:!0});const $=[{TEXT:"BASIC",COLOR:"#19aa19",BACKGROUND:"#e8f6e8"},{TEXT:"ADVANCED",COLOR:"#f55000",BACKGROUND:"#feede5"},{TEXT:"EXPERT",COLOR:"#a00a50",BACKGROUND:"#F5E6ED"},{TEXT:"MASTER",COLOR:"#8200dc",BACKGROUND:"#f2e5fb"},{TEXT:"WORLD'S END",COLOR:"#000000",BACKGROUND:"#e5e5e5"}],_=["SONGID","TITLE","ARTIST","DESIGNER","DIFFICULTY","PLAYLEVEL","WAVE","WAVEOFFSET","JACKET","BACKGROUND","MOVIE","MOVIEOFFSET","BASEBPM"],X=["SONGID","TITLE","ARTIST","DESIGNER","DIFFICULTY","PLAYLEVEL"],z=["ARTIST","BACKGROUND","DESIGNER","JACKET","MOVIE","SONGID","TITLE","WAVE"],G=["BASEBPM","MOVIEOFFSET","WAVEOFFSET"];function j(e){return e.split("\n").filter(e=>"#"===e.slice(0,1)).map(e=>e.slice(1)).filter(e=>!e.match(/^\d{3}/)).reduce((e,t)=>{var i,n=t.slice(0,t.indexOf(" ")).trim().toUpperCase();return i=n,-1<_.indexOf(i)&&(t={key:n,value:t.slice(t.indexOf(" ")+1,t.length).trim()},e.push(t)),e},[]).map(e=>(e.value=e.value.match(/^".*"$/)?e.value.slice(1,e.value.length-1):e.value,e)).filter(e=>e.value).reduce((e,t)=>{if(-1<z.indexOf(t.key)&&(e[t.key]=t.value),-1<G.indexOf(t.key)&&Number(t.value)&&(e[t.key]=Number(t.value)),"DIFFICULTY"===t.key){var i=Number(t.value.slice(0,1));if(isNaN(i)||Number(i)<0||4<Number(i))return e;e.DIFFICULTY=Object.assign({},$[i],{LEVEL:Number(i),MARK:4===Number(i)?1!==t.value.length?`${t.value}:`.split(":")[1]:"":void 0})}if("PLAYLEVEL"===t.key){if(!Number(t.value)&&!Number(t.value.slice(0,-1)))return e;e.PLAYLEVEL={LEVEL:Number(t.value)||Number(t.value.slice(0,-1)),PLUS:/\+$/.test(t.value),TEXT:t.value}}return e},{})}H.getMeta=j,H.validate=function(e){const t=j(e),i=X.slice();return null!=t.WAVE&&i.push("WAVEOFFSET"),null!=t.MOVIE&&i.push("MOVIEOFFSET"),null!=t.DIFFICULTY&&4===t.DIFFICULTY.LEVEL&&i.splice(i.indexOf("PLAYLEVEL"),1),{MISSING_META:e=i.filter(e=>!t.hasOwnProperty(e)),VALIDITY:0===e.length}};var W,R={};Object.defineProperty(R,"__esModule",{value:!0});const K=H;function q(e,t,i,n){return e.filter(e=>e.match(t)).reduce((e,t)=>(e[Number(t.slice(i,n))]=Number(t.split(":")[1].trim()),e),[])}function Z(r,e){return[...Array(e)].reduce((e,t,i)=>{let n=i;for(;e[i]=r[n--],void 0===e[i];);return e},[])}function J(e,n){const r=[];return e.filter(e=>e.laneType===n).reduce((e,t)=>(e[t.measure]=e[t.measure]||[],e[t.measure][t.tick]=e[t.measure][t.tick]||[],e[t.measure][t.tick].push(t),e),[]).reduce((i,e)=>(e.forEach(e=>{e.filter(e=>2===e.noteType).forEach(e=>{var t=2===n?e.lane:0;e.channel&&r[t]&&r[t][e.channel]&&(r[t][e.channel].push(e),i.push(r[t][e.channel]),delete r[t][e.channel])}),e.filter(e=>1===e.noteType).forEach(e=>{var t=2===n?e.lane:0;e.channel&&(r[t]=r[t]||[],r[t][e.channel]=[],r[t][e.channel].push(e))}),e.filter(e=>-1<[3,4,5].indexOf(e.noteType)).forEach(e=>{var t=2===n?e.lane:0;e.channel&&r[t]&&r[t][e.channel]&&r[t][e.channel].push(e)})}),i),[])}function Q(e){for(var t in e)W.hasOwnProperty(t)||(W[t]=e[t])}R.getScore=function(e,t=192){const i=e.split("\n").filter(e=>"#"===e.slice(0,1)).map(e=>e.slice(1));var n,a,o,r=i.filter(e=>e.match(/^\d{3}[1-5][0-9a-fA-F][0-9a-zA-Z]?:/)).map(e=>Number(e.slice(0,3))).reduce((e,t)=>t<e?e:t,0)+1,s=function(e,t){const i=q(e,/^\d{3}02:/,0,3);return i[0]=Number.isFinite(i[0])?i[0]:4,Z(i,t)}(i,r);const l=(n=i,a=t,o=s,n.filter(e=>e.match(/^\d{3}[1-5][0-9a-fA-F][0-9a-zA-Z]?:(\s*[0-9a-zA-Z][0-9a-gA-G])+\s*$/)).map(e=>e.split(":",2)).reduce((t,n)=>{const r=n[1].trim().replace(/ /g,""),s=Number(n[0].slice(0,3));return[...Array(r.length/2)].map((e,t)=>{const i={lane:parseInt(n[0].slice(4,5),16),laneType:Number(n[0].slice(3,4)),measure:s,noteType:parseInt(r[2*t],36),tick:Math.round(a*o[s]/(r.length/2)*t),width:parseInt(r[2*t+1],17)};return 6===n[0].length&&(i.channel=n[0].slice(5,6).toUpperCase().charCodeAt(0)),i}).filter(e=>0!==e.width).forEach(e=>t.push(e)),t},[]));return{BEATs:s,BPMs:function(e,t,i=120){const n=q(e,/^BPM\d{2}:/,3,5),r=q(e,/^\d{3}08:/,0,3).map(e=>{if(n[e])return n[e]});return r[0]=Number(r[0])?r[0]:i,Z(r,t)}(i,r,K.getMeta(e).BASEBPM),airActionNotes:J(l,4),airNotes:l.filter(e=>5===e.laneType),holdNotes:J(l,2),measure:r,shortNotes:l.filter(e=>1===e.laneType),slideNotes:J(l,3)}},W=Y,Object.defineProperty(W,"__esModule",{value:!0}),Q(H),Q(R);V={};H=V,Object.defineProperty(H,"__esModule",{value:!0}),H.FlickDirection=H.CurveType=H.NoteType=void 0,(R=H.NoteType||(H.NoteType={}))[R.Tap=0]="Tap",R[R.Flick=1]="Flick",R[R.SlideStart=2]="SlideStart",R[R.SlideInvisible=3]="SlideInvisible",R[R.SlideVisible=4]="SlideVisible",R[R.SlideEndDefault=5]="SlideEndDefault",R[R.SlideEndFlick=6]="SlideEndFlick",(R=H.CurveType||(H.CurveType={}))[R.None=0]="None",R[R.Linear=1]="Linear",R[R.EaseIn=2]="EaseIn",R[R.EaseOut=3]="EaseOut",R[R.EaseInOut=4]="EaseInOut",R[R.CubicBezier=5]="CubicBezier",(H=H.FlickDirection||(H.FlickDirection={}))[H.Up=0]="Up",H[H.Left=1]="Left",H[H.Right=2]="Right";const ee=P["v4"],te=Y,{NoteType:ie,CurveType:ne,FlickDirection:re}=V;function se(e){const o=te.getScore(e,480),r=ee(),s={timelines:[{id:r,name:"Timeline 1"}],bpms:[{id:ee(),timeline:r,beat:[0,0,1],bpm:o.BPMs[0]}],notes:[],slides:[]};return o.slideNotes.forEach(e=>{const a={id:ee(),timeline:r,notes:[]};e.forEach((t,e)=>{var i=o.airNotes.findIndex(e=>oe(t,e)),n=o.shortNotes.findIndex(e=>3===e.noteType&&oe(t,e)),r=o.shortNotes.findIndex(e=>oe(t,e));0===e&&-1!==r&&2===o.shortNotes[r].noteType&&(o.shortNotes.splice(r,1),a.critical=!0);e=ae(t.tick,1920);const s={id:ee(),type:{1:ie.SlideStart,2:ie.SlideEndDefault,3:ie.SlideVisible,5:ie.SlideInvisible}[t.noteType],beat:[t.measure,t.tick/e,t.tick?1920/e:1],lane:t.lane-2,width:t.width,curve:ne.Linear};s.type===ie.SlideEndDefault&&-1!==i?([e]=o.airNotes.splice(i,1),s.type=ie.SlideEndFlick,s.direction=3===e.noteType?re.Left:4===e.noteType?re.Right:re.Up,-1!==r&&([e]=o.shortNotes.splice(r,1),2===e.noteType&&(s.critical=!0))):-1!==i&&-1!==r&&(o.shortNotes.splice(r,1),[i]=o.airNotes.splice(i,1),s.curve={2:ne.EaseOut,5:ne.EaseIn,6:ne.EaseIn}[i.noteType]),-1!==n&&s.type===ie.SlideVisible&&(o.shortNotes.splice(n,1),delete s.width,delete s.lane,delete s.curve),a.notes.push(s)}),s.slides.push(a)}),o.shortNotes.forEach(t=>{if(!(t.lane<2||13<t.lane)){var e=o.airNotes.find(e=>oe(e,t)),i=ae(t.tick,1920);const n={id:ee(),timeline:r,type:e?ie.Flick:ie.Tap,beat:[t.measure,t.tick/i,t.tick?1920/i:1],lane:t.lane-2,width:t.width};2===t.noteType&&(n.critical=!0),e&&(n.direction=3===e.noteType?re.Left:4===e.noteType?re.Right:re.Up),s.notes.push(n)}}),s}function ae(e,t){if(0===e)return t;for(;0!==t;){var i=t;t=e%t,e=i}return e}function oe(e,t){return e.measure===t.measure&&e.tick===t.tick&&e.lane===t.lane&&e.width===t.width}var le,he,ce,de;le="* {\n\tmargin: 0;\n\tpadding: 0;\n}\n\nhtml, body {\n\twidth: 100%;\n\theight: 100%;\n}\n\n#selector {\n\theight: 40px;\n\tposition: relative;\n}\n\n#app {\n\theight: calc(100% - 40px);\n\tmax-width: 600px;\n}\n",de=(he=void 0===he?{}:he).insertAt,le&&"undefined"!=typeof document&&(ce=document.head||document.getElementsByTagName("head")[0],(he=document.createElement("style")).type="text/css","top"===de&&ce.firstChild?ce.insertBefore(he,ce.firstChild):ce.appendChild(he),he.styleSheet?he.styleSheet.cssText=le:he.appendChild(document.createTextNode(le))),function(){document.addEventListener("DOMContentLoaded",async function(){console.log("ready");const i=document.getElementById("id"),n=document.getElementById("diff"),e=document.getElementById("load"),r=document.getElementById("bottom"),t=document.getElementById("scroll"),s=document.getElementById("input"),a=document.getElementById("container"),o=document.getElementById("text"),l=document.getElementById("draw");s.addEventListener("click",()=>{a.style.display="none"===a.style.display?"block":"none"}),l.addEventListener("click",()=>{a.style.display="none";var e=se(o.value);null!==h&&(h.destroy(),h=null),h=new v(document.getElementById("app"),e,180),h.event.addEventListener("scroll",e=>{r.value=e.detail.scrollBottom}),h.scrollTo(0)}),await v.loadResource((e,t)=>{console.log(`${e.progress}% loading: ${t.url}`)},e=>{console.error(e)}),t.addEventListener("click",()=>{var e=parseInt(r.value);h&&h.scrollTo(e)}),e.addEventListener("click",async()=>{const e=await fetch(`https://assets.pjsek.ai/file/pjsekai-assets/startapp/music/music_score/${i.value.padStart(4,"0")}_01/${n.value}`);var t=se(await e.text());null!==h&&(h.destroy(),h=null),h=new v(document.getElementById("app"),t,180),h.event.addEventListener("scroll",e=>{r.value=e.detail.scrollBottom}),h.scrollTo(0)}),i.value="135",e.click()});let h=null}()}();
