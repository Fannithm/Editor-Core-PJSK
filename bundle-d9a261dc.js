!function(e){"use strict";function t(i){if(i&&i.__esModule)return i;var n=Object.create(null);return i&&Object.keys(i).forEach(function(e){var t;"default"!==e&&(t=Object.getOwnPropertyDescriptor(i,e),Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return i[e]}}))}),n.default=i,Object.freeze(n)}var u,h=t(e);function i(i){if(i.__esModule)return i;var n=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(i).forEach(function(e){var t=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return i[e]}})}),n}(z=_=_||{}).BLUE="blue",z.GREEN="green",z.YELLOW="yellow",z.RED="red",z.PURPLE="purple",z.PINK="pink",(_=u=u||{})[_.Tap=0]="Tap",_[_.Flick=1]="Flick",_[_.SlideStart=2]="SlideStart",_[_.SlideInvisible=3]="SlideInvisible",_[_.SlideVisible=4]="SlideVisible",_[_.SlideEndDefault=5]="SlideEndDefault",_[_.SlideEndFlick=6]="SlideEndFlick",(z=V=V||{})[z.None=0]="None",z[z.Linear=1]="Linear",z[z.EaseIn=2]="EaseIn",z[z.EaseOut=3]="EaseOut",z[z.EaseInOut=4]="EaseInOut",z[z.CubicBezier=5]="CubicBezier",(_=$=$||{})[_.Up=0]="Up",_[_.Left=1]="Left",_[_.Right=2]="Right";var l=4,c=1e-7,d=10,s="function"==typeof Float32Array;function n(e,t){return 1-3*t+3*e}function o(e,t){return 3*t-6*e}function p(e,t,i){return((n(t,i)*e+o(t,i))*e+3*t)*e}function m(e,t,i){return 3*n(t,i)*e*e+2*o(t,i)*e+3*t}function g(e){return e}function w(o,t,r,i){if(!(0<=o&&o<=1&&0<=r&&r<=1))throw new Error("bezier x values must be in [0, 1] range");if(o===t&&r===i)return g;for(var a=new(s?Float32Array:Array)(11),e=0;e<11;++e)a[e]=p(.1*e,o,r);function n(e){for(var t=0,i=1;10!==i&&a[i]<=e;++i)t+=.1;var n=t+.1*((e-a[--i])/(a[i+1]-a[i])),s=m(n,o,r);return.001<=s?function(e,t,i,n){for(var s=0;s<l;++s){var o=m(t,i,n);if(0===o)return t;t-=(p(t,i,n)-e)/o}return t}(e,n,o,r):0===s?n:function(e,t,i,n,s){for(var o,r,a=0;0<(o=p(r=t+(i-t)/2,n,s)-e)?i=r:t=r,Math.abs(o)>c&&++a<d;);return r}(e,t,t+.1,o,r)}return function(e){return 0===e?0:1===e?1:p(n(e),t,i)}}var f,r;class a extends e.NineSlicePlane{constructor(e,t){super(e,91,0,91,0),this.interactive=!0,this.id=t.id}}class v extends e.NineSlicePlane{constructor(e,t,i){super(e,91,0,91,0),this.interactive=!0,this.id=t.id,this.slideId=i.id}}(f=f||{}).Scroll="scroll";class y extends e.Sprite{constructor(e,t,i){super(e),this.interactive=!0,this.id=t.id,this.slideId=i.id}}class b{constructor(e,t,i){this.scrollBottom=0,this.colors={background:16777215,lane:0,bpm:65535,time:16711680,beat:{third:16711680,half:0,quarter:255},slide:14285551,slideNote:3204520,critical:16579021,criticalNote:15852573,selection:233724},this.beatLine={third:!1,half:!0,quarter:!0};var{width:n,height:s}=e.getBoundingClientRect(),o=window.devicePixelRatio;this.resolution=o,this.setMap(t),this.app=new h.Application({backgroundAlpha:0,width:n,height:s,antialias:!0,resolution:o}),this.const={resolution:o,fontSize:18/o,heightPerSecond:500/o,spaceY:200/o,width:n,height:s,paddingX:4/o,paddingY:2/o,lineWidth:1/o,noteHeight:32/o,arrowHeight:32/o,maxHeight:0},this.time=i,this.currentTime=0,this.const.maxHeight=this.const.heightPerSecond*i+2*this.const.spaceY,this.container={lane:new h.Container,time:new h.Container,note:new h.Container,slide:new h.Container,arrow:new h.Container,selection:new h.Container},this.scrollBottom/=o,this.app.view.style.width=n+"px",this.app.view.style.height=s+"px",e.appendChild(this.app.view),this.app.stage.addChild(this.container.lane),this.app.stage.sortableChildren=!0,this.app.stage.interactive=!0,this.container.lane.name="Lane",this.notes=h.Loader.shared.resources["images/sprite.json"].textures,this.event=new EventTarget,this.selection={single:[],slide:{},singleTemp:[],slideTemp:{}},this.selectionBox=[0,0,0,0],this.scrollTicker=new h.Ticker,this.scrollTicker.autoStart=!1,this.scrollTicker.add(this.scrollTickerHandler.bind(this)),this.start()}start(){const i=new h.Graphics;i.name="SelectArea",i.beginFill(this.colors.background,.5),i.drawRect(0,0,this.const.width,this.const.height),i.zIndex=-1,i.interactive=!0,i.endFill(),this.app.stage.addChild(i),this.drawLane(),this.reRender(),this.app.view.addEventListener("wheel",e=>{e=Math.min(this.const.maxHeight,Math.max(0,this.scrollBottom-e.deltaY/this.resolution));this.scrollTo(e)});const n=this.selectAreaMoveHandler.bind(this),s=this.selectAndScrollHandler.bind(this);i.on("mousedown",e=>{e.data.originalEvent.ctrlKey||this.emptySelection();var t=e.data.global,e=t.x,t=this.scrollBottom+(this.const.height-t.y);this.selectionBox=[e,t,e,t],i.on("mousemove",n),this.event.addEventListener(f.Scroll,s),this.reRender()}),window.addEventListener("mouseup",()=>{this.selectionBox=[0,0,0,0],i.removeListener("mousemove",n),this.event.removeEventListener(f.Scroll,s),this.autoScrollDelta=0,this.scrollTicker.stop(),this.selection.single.push(...this.selection.singleTemp);for(const t in this.selection.slideTemp){var e;Object.prototype.hasOwnProperty.call(this.selection.slideTemp,t)&&(e=this.selection.slideTemp[t],this.selection.slide[t]||(this.selection.slide[t]=[]),this.selection.slide[t].push(...e))}this.selection.singleTemp=[],this.selection.slideTemp={},this.reRender()})}selectAreaMoveHandler(e){var t=e.data.global;this.selectionBox[2]=t.x,this.selectionBox[3]=this.scrollBottom+(this.const.height-t.y);var i=this.const.height/20,e=this.const.height-i;t.y<i||t.y>e?(this.scrollTicker.started||this.scrollTicker.start(),this.autoScrollDelta=((t.y<i?i:e)-t.y)/(i/10)):(this.autoScrollDelta=0,this.scrollTicker.stop()),this.findSelectedNote(),this.reRender()}selectAndScrollHandler(e){this.selectionBox[3]+=e.detail.scrollBottom-e.detail.oldScrollBottom,this.findSelectedNote()}findSelectedNote(){var n=Math.min(this.selectionBox[1],this.selectionBox[3]),s=Math.max(this.selectionBox[1],this.selectionBox[3]),o=Math.min(this.selectionBox[0],this.selectionBox[2]),r=Math.max(this.selectionBox[0],this.selectionBox[2]);this.selection.singleTemp=[],this.selection.slideTemp={};for(let e=0;e<this.map.notes.length;e++){var t=this.map.notes[e],i=this.getHeightByBeat(t.beat),a=this.getLaneX(t.lane),l=this.getLaneX(t.lane+t.width);if(n<=i&&i<=s&&o<=a&&l<=r&&!this.selection.single.includes(t.id))this.selection.singleTemp.push(t.id);else if(s<i)break}for(let e=0;e<this.map.slides.length;e++){const f=this.map.slides[e];if(!(this.getHeightByBeat(f.notes[f.notes.length-1].beat)<n))for(let i=0;i<f.notes.length;i++){var h=f.notes[i],c=this.getHeightByBeat(h.beat);let e=void 0!==h.lane?this.getLaneX(h.lane):0,t=void 0!==h.lane?this.getLaneX(h.lane+h.width):0;if(void 0===h.lane){const v=f.notes.length-i-1;var d=f.notes.concat().reverse().find((e,t)=>t>v&&void 0!==e.lane),u=f.notes.find((e,t)=>t>i&&void 0!==e.lane),p=this.getHeightByBeat(d.beat),m=(c-p)/(this.getHeightByBeat(u.beat)-p),g=[!1,[0,0,1,1],[0,0,0,.5],[1,.5,1,1],[1,.5,0,.5],d.bezier][d.curve];const y=g&&w(g[0],g[1],g[2],g[3]);p=d.width+(u.width-d.width)*y(m),m=d.lane+(u.lane-d.lane)*y(m);e=this.getLaneX(g?m:d.lane),t=this.getLaneX(g?m+p:d.lane+d.width)}if(n<=c&&c<=s&&e>=o&&t<=r&&!this.selection.slide[f.id]?.includes(h.id))this.selection.slideTemp[f.id]||(this.selection.slideTemp[f.id]=[]),this.selection.slideTemp[f.id].push(h.id);else{if(s<c&&0===i)return;if(s<c)break}}}}emptySelection(){this.selection.single=[],this.selection.slide={}}scrollTickerHandler(){this.scrollTo(this.scrollBottom+this.autoScrollDelta)}scrollTo(e){const t={oldScrollBottom:this.scrollBottom,scrollBottom:0};this.scrollBottom=Math.min(this.const.maxHeight,Math.max(0,e)),t.scrollBottom=this.scrollBottom,this.event.dispatchEvent(new CustomEvent("scroll",{detail:t})),this.reRender()}reRender(){this.container.time.destroy({children:!0}),this.container.note.destroy({children:!0}),this.container.slide.destroy({children:!0}),this.container.arrow.destroy({children:!0}),this.container.selection.destroy({children:!0}),this.container.time=new h.Container,this.container.note=new h.Container,this.container.slide=new h.Container,this.container.arrow=new h.Container,this.container.selection=new h.Container,this.container.time.name="Time",this.container.note.name="Note",this.container.slide.name="Slide",this.container.arrow.name="Arrow",this.container.selection.name="Selection",this.container.time.zIndex=5,this.container.arrow.zIndex=7,this.container.slide.zIndex=8,this.container.note.zIndex=9,this.container.selection.zIndex=10,this.app.stage.addChild(this.container.time),this.app.stage.addChild(this.container.note),this.app.stage.addChild(this.container.slide),this.app.stage.addChild(this.container.arrow),this.app.stage.addChild(this.container.selection),this.drawBeat(),this.drawBPM(),this.drawCurrentTimeLine(),this.drawNote(),this.drawSlide(),this.drawSelectionBox()}destroy(){this.app.destroy(!0,{children:!0})}static loadResource(i,n){return new Promise(e=>{const t=h.Loader.shared;t.add("images/sprite.json").load(()=>{console.log("load resources completed"),e()}),i&&t.onLoad.add(i),n&&t.onError.add(n)})}minusBeat(e,t){return this.fractionToDecimal(e)-this.fractionToDecimal(t)}getTimeByBeat(t){let i=0;for(let e=0;e<this.map.bpms.length;e++){var n=this.map.bpms[e];if(this.minusBeat(t,n.beat)<=0)break;var s=this.map.bpms[e+1];i+=(s&&0<this.minusBeat(t,s.beat)?this.minusBeat(s.beat,n.beat):this.minusBeat(t,n.beat))/n.bpm*60}return i}getHeightByBeat(e){return this.const.spaceY+this.getTimeByBeat(e)*this.const.heightPerSecond}getHeightByTime(e){return this.const.spaceY+e*this.const.heightPerSecond}formatTime(e){return`${Math.floor(e/60)}:${(e%60).toFixed(3).padStart(6,"0")}`}getYInCanvas(e){return this.const.height-(e-this.scrollBottom)}getLaneX(e){return this.const.width*(6*e+14)/100}fractionToDecimal(e){return e[0]+e[1]/e[2]}drawSelectionBox(){var e=this.selectionBox;if(e[0]!==e[2]&&e[1]!==e[3]){const n=new h.Graphics;n.beginFill(this.colors.selection,.2),n.lineStyle(this.const.lineWidth,this.colors.selection);var t=this.getYInCanvas(e[1]),i=this.getYInCanvas(e[3])-t;n.drawRect(e[0],t,e[2]-e[0],i),n.endFill(),this.container.selection.addChild(n)}}drawCurrentTimeLine(){var e=this.getHeightByTime(this.currentTime);if(e>=this.scrollBottom&&e<=this.scrollBottom+this.const.height){const t=new h.Graphics;t.name="Time-line",t.lineStyle(this.const.lineWidth,this.colors.time,1),t.moveTo(0,0),t.lineTo(.8*this.const.width,0),t.x=.1*this.const.width,t.y=this.getYInCanvas(e),this.container.time.addChild(t)}}drawBPM(){for(let e=0;e<this.map.bpms.length;e++){const n=this.map.bpms[e];var t=this.getTimeByBeat(n.beat),i=this.getHeightByTime(t);if(i>=this.scrollBottom&&i<=this.scrollBottom+this.const.height){const s=new h.Graphics;s.name=`BPM-${n.id}-line`,s.lineStyle(this.const.lineWidth,this.colors.bpm,1),s.moveTo(0,0),s.lineTo(this.const.width,0),s.y=this.getYInCanvas(i);const o=new h.Text(this.formatTime(t),{fontSize:this.const.fontSize,fill:this.colors.bpm,align:"left"});o.name=`BPM-${n.id}-time`,o.x=this.const.paddingX,o.y=this.getYInCanvas(i)-o.height-this.const.paddingY;const r=new h.Text(n.bpm.toString(),{fontSize:this.const.fontSize,fill:this.colors.bpm,align:"left"});r.name=`BPM-${n.id}-value`,r.x=this.getLaneX(12)+this.const.paddingX,r.y=this.getYInCanvas(i)-r.height-this.const.paddingY,this.container.time.addChild(s),this.container.time.addChild(o),this.container.time.addChild(r)}else if(i>this.scrollBottom+this.const.height)break}}drawBeatLine(e,t,i,n,s=!1){const o=new h.Graphics;var r=this.fractionToDecimal(e);if(o.name=`Beat-${r}-line`,o.lineStyle(this.const.lineWidth,t,i),o.moveTo(this.getLaneX(0),0),o.lineTo(s?this.const.width:this.getLaneX(12),0),o.y=this.getYInCanvas(n),s){const a=new h.Text(`${Math.floor(e[0]/4)+1}:${e[0]%4+1}`,{fontSize:this.const.fontSize,fill:t,align:"left"});a.name=`Beat-${r}-beat`,a.x=this.const.width-a.width-this.const.paddingX,a.y=this.getYInCanvas(n)-a.height-this.const.paddingY,this.container.time.addChild(a)}this.container.time.addChild(o)}drawBeat(){this.container.time.destroy({children:!0}),this.container.time=new h.Container;for(let e=0;;e++){var t=[Math.floor(e/12),e%12,12],i=this.getTimeByBeat(t),i=this.getHeightByTime(i);if(i-this.const.height>this.const.maxHeight-this.const.spaceY)break;if(i>=this.scrollBottom&&i<=this.scrollBottom+this.const.height)e%12==0?this.drawBeatLine(t,this.colors.beat.half,1,i,!0):e%6==0&&this.beatLine.half?this.drawBeatLine(t,this.colors.beat.half,.2,i):e%4==0&&this.beatLine.third?this.drawBeatLine(t,this.colors.beat.third,.4,i):e%3==0&&this.beatLine.quarter&&this.drawBeatLine(t,this.colors.beat.quarter,.4,i);else if(i>this.scrollBottom+this.const.height)break}this.app.stage.addChild(this.container.time)}drawLane(){for(let e=0;e<=12;e++){const i=new h.Graphics;i.name=`Lane-${e}`;var t=this.const.width*((6*e+14)/100);i.lineStyle(this.const.lineWidth,this.colors.lane,e%2?.2:1),i.moveTo(0,0),i.lineTo(0,this.const.height),i.x=t,this.container.lane.addChild(i)}}drawBaseNote(e,t,i,n){const s=void 0===n?new a(this.notes[t],e):new v(this.notes[t],e,n);s.name=`Note-${t}-${e.id}`;t=this.const.noteHeight/s.height;s.scale.set(t),s.x=this.getLaneX(e.lane)-.006*this.const.width,s.y=this.getYInCanvas(i)-this.const.noteHeight/2,s.width=.06*(e.width+.2)*this.const.width/t,s.on("click",(void 0===n?this.singleClickHandler:this.slideClickHandler).bind(this)),this.container.note.addChild(s)}singleClickHandler(e){var t=e.target.id;e.data.originalEvent.ctrlKey||this.emptySelection();e=this.selection.single.indexOf(t);-1===e?this.selection.single.push(t):this.selection.single.splice(e,1),this.reRender()}slideClickHandler(e){var t=e.target.id,i=e.target.slideId;e.data.originalEvent.ctrlKey||this.emptySelection(),this.selection.slide[i]||(this.selection.slide[i]=[]);e=this.selection.slide[i].indexOf(t);-1===e?this.selection.slide[i].push(t):this.selection.slide[i].splice(e,1),this.reRender()}drawFlickArrow(e,t){const i=Math.min(6,e.width);var n=`flick_arrow_${e.critical?"critical_":""}${i.toString().padStart(2,"0")}${{0:"",1:"_left",2:"_right"}[e.direction]}`;const s=new h.Sprite(this.notes[n]);s.name=`Arrow-${e.id}`;var o=.8*i*.06*this.const.width/s.width,n=s.height*o;s.scale.set(o),s.x=this.getLaneX(e.lane+(e.width-i)/2+.1*i),s.y=this.getYInCanvas(t)-n,this.container.arrow.addChild(s)}drawCurve(e,t,i,n,s=!1){const o=new h.Graphics;o.name=`Curve-${e.id}`;var r,a,l=[!1,[0,0,1,1],[1,.5,1,1],[0,0,0,.5],[.42,0,.58,1],e.bezier][e.curve];l&&(a=[this.getLaneX(e.lane+.1),this.getYInCanvas(i)],r=[this.getLaneX(t.lane+.1),this.getYInCanvas(n)],o.beginFill(s?this.colors.critical:this.colors.slide,.8),o.moveTo(a[0],a[1]),o.bezierCurveTo(a[0]+l[0]*(r[0]-a[0]),a[1]+l[1]*(r[1]-a[1]),a[0]+l[2]*(r[0]-a[0]),a[1]+l[3]*(r[1]-a[1]),r[0],r[1]),o.lineTo(this.getLaneX(t.lane+t.width-.1),this.getYInCanvas(n)),r=[this.getLaneX(e.lane+e.width-.1),this.getYInCanvas(i)],a=[this.getLaneX(t.lane+t.width-.1),this.getYInCanvas(n)],[e,i,t,n]=l,l=[1-t,1-n,1-e,1-i],o.bezierCurveTo(a[0]+l[0]*(r[0]-a[0]),a[1]+l[1]*(r[1]-a[1]),a[0]+l[2]*(r[0]-a[0]),a[1]+l[3]*(r[1]-a[1]),r[0],r[1]),o.endFill()),this.container.slide.addChild(o)}drawInvisibleNote(e,t,i=!1){const n=new h.Graphics;n.name=`Invisible-${e.id}`,n.lineStyle(3*this.const.lineWidth,i?this.colors.criticalNote:this.colors.slideNote,1),n.moveTo(this.getLaneX(e.lane+.1),0),n.lineTo(this.getLaneX(e.lane+e.width-.1),0),n.y=this.getYInCanvas(t),this.container.slide.addChild(n)}drawVisibleNote(e,t,i){const n=new y(this.notes[`slide_node${i.critical?"_critical":""}`],e,i);n.name=`Visible-${e.id}`;i=this.const.noteHeight/n.height;n.scale.set(i),n.x=this.getLaneX(e.lane+e.width/2)-n.width/2,n.y=this.getYInCanvas(t)-n.height/2,n.on("click",this.slideClickHandler.bind(this)),this.container.slide.addChild(n)}drawSkippedVisibleNote(t,i,n,s){var o=this.getHeightByBeat(i.beat),r=t.notes[s],a=this.getHeightByBeat(r.beat),e=[!1,[0,0,1,1],[0,0,0,.5],[1,.5,1,1],[1,.5,0,.5],i.bezier][i.curve];const l=e&&w(e[0],e[1],e[2],e[3]);for(let e=n;e<s;e++){var h=t.notes[e],c=this.getHeightByBeat(h.beat);if(c>=this.scrollBottom-this.const.noteHeight&&c<=this.scrollBottom+this.const.height+this.const.noteHeight){var d=(c-o)/(a-o),d={id:h.id,type:u.SlideVisible,beat:h.beat,width:i.width+(r.width-i.width)*l(d),lane:i.lane+(r.lane-i.lane)*l(d)};this.drawVisibleNote(d,c,t),(this.selection.slide[t.id]?.includes(h.id)||this.selection.slideTemp[t.id]?.includes(h.id))&&this.drawSelectionRect(d,c)}else if(c>this.scrollBottom+this.const.height+this.const.noteHeight)break}}drawSlide(){for(let e=0;e<this.map.slides.length;e++){const a=this.map.slides[e];if(!(this.getHeightByBeat(a.notes[a.notes.length-1].beat)<this.scrollBottom)){if(this.getHeightByBeat(a.notes[0].beat)>this.scrollBottom+this.const.height+this.const.noteHeight)break;for(let i=0;i<a.notes.length;i++){var n,s=a.notes[i],o=a.notes[i+1],r=this.getHeightByBeat(s.beat);let e=o,t=i;o&&void 0===o.lane&&(t+=1+a.notes.slice(i+1).findIndex(e=>void 0!==e.lane),e=a.notes[t]),void 0!==s.lane&&e&&r<this.scrollBottom+this.const.height+this.const.noteHeight&&this.getHeightByBeat(e.beat)>this.scrollBottom-this.const.noteHeight&&(n=this.getHeightByBeat(e.beat),this.drawCurve(s,e,r,n,a.critical),void 0===o.lane&&this.drawSkippedVisibleNote(a,s,i+1,t)),r>=this.scrollBottom-this.const.noteHeight&&r<=this.scrollBottom+this.const.height+this.const.noteHeight&&([u.SlideStart,u.SlideEndDefault].includes(s.type)?this.drawBaseNote(s,a.critical?"critical":"slide",r,a):s.type===u.SlideEndFlick?(this.drawBaseNote(s,s.critical||a.critical?"critical":"flick",r,a),this.drawFlickArrow({...s,critical:s?.critical||a.critical},r)):s.type===u.SlideInvisible?this.drawInvisibleNote(s,r,a.critical):s.type===u.SlideVisible&&this.drawVisibleNote(s,r,a),(this.selection.slide[a.id]?.includes(s.id)||this.selection.slideTemp[a.id]?.includes(s.id))&&this.drawSelectionRect(s,r))}}}}drawSelectionRect(e,t){const i=new h.Graphics;i.name=`Selection-${e.id}`,i.lineStyle(4*this.const.lineWidth,this.colors.selection),i.drawRect(this.getLaneX(e.lane)-this.const.paddingX,this.getYInCanvas(t)-this.const.noteHeight/2,.06*this.const.width*e.width+2*this.const.paddingX,this.const.noteHeight),this.container.selection.addChild(i)}drawNote(){for(let e=0;e<this.map.notes.length;e++){var t=this.map.notes[e],i=this.getHeightByBeat(t.beat);if(i>=this.scrollBottom-this.const.noteHeight&&i<=this.scrollBottom+this.const.height+this.const.noteHeight&&(t.type===u.Flick&&this.drawFlickArrow(t,i),this.drawBaseNote(t,t.critical?"critical":t.type?"flick":"tap",i),(this.selection.single.includes(t.id)||this.selection.singleTemp.includes(t.id))&&this.drawSelectionRect(t,i)),i>this.scrollBottom+this.const.height+this.const.noteHeight)break}}setMap(e){this.map=e,this.map.bpms=this.map.bpms.sort((e,t)=>this.minusBeat(e.beat,t.beat)),this.map.notes=this.map.notes.sort((e,t)=>this.minusBeat(e.beat,t.beat)),this.map.slides=this.map.slides.map(e=>({...e,notes:e.notes.sort((e,t)=>this.minusBeat(e.beat,t.beat))})).sort((e,t)=>this.minusBeat(e.notes[0].beat,t.notes[0].beat)),console.log(this.map)}getHeightPerSecond(){return this.const.heightPerSecond*this.resolution}setHeightPerSecond(e){e<100||2e3<e||(this.scrollTo(this.scrollBottom*e/this.const.heightPerSecond),this.const.heightPerSecond=e/this.resolution,this.const.spaceY=this.const.heightPerSecond/16,this.const.maxHeight=this.const.heightPerSecond*this.time+2*this.const.spaceY,this.reRender())}getCurrentTime(){return this.currentTime}setCurrentTime(e){this.currentTime=e,this.reRender()}getConst(e){return this.const[e]}}var B=new Uint8Array(16);function T(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(B)}var E=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function S(e){return"string"==typeof e&&E.test(e)}for(var I,C,L=[],N=0;N<256;++N)L.push((N+256).toString(16).substr(1));function k(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,t=(L[e[t+0]]+L[e[t+1]]+L[e[t+2]]+L[e[t+3]]+"-"+L[e[t+4]]+L[e[t+5]]+"-"+L[e[t+6]]+L[e[t+7]]+"-"+L[e[t+8]]+L[e[t+9]]+"-"+L[e[t+10]]+L[e[t+11]]+L[e[t+12]]+L[e[t+13]]+L[e[t+14]]+L[e[t+15]]).toLowerCase();if(!S(t))throw TypeError("Stringified UUID is invalid");return t}var A=0,x=0;function O(e){if(!S(e))throw TypeError("Invalid UUID");var t,i=new Uint8Array(16);return i[0]=(t=parseInt(e.slice(0,8),16))>>>24,i[1]=t>>>16&255,i[2]=t>>>8&255,i[3]=255&t,i[4]=(t=parseInt(e.slice(9,13),16))>>>8,i[5]=255&t,i[6]=(t=parseInt(e.slice(14,18),16))>>>8,i[7]=255&t,i[8]=(t=parseInt(e.slice(19,23),16))>>>8,i[9]=255&t,i[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,i[11]=t/4294967296&255,i[12]=t>>>24&255,i[13]=t>>>16&255,i[14]=t>>>8&255,i[15]=255&t,i}function R(e,r,a){function t(e,t,i,n){if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=[],i=0;i<e.length;++i)t.push(e.charCodeAt(i));return t}(e)),16!==(t="string"==typeof t?O(t):t).length)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var s=new Uint8Array(16+e.length);if(s.set(t),s.set(e,t.length),(s=a(s))[6]=15&s[6]|r,s[8]=63&s[8]|128,i){n=n||0;for(var o=0;o<16;++o)i[n+o]=s[o];return i}return k(s)}try{t.name=e}catch(e){}return t.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",t.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",t}function H(e){return 14+(e+64>>>9<<4)+1}function F(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function M(e,t,i,n,s,o){return F((o=F(F(t,e),F(n,o)))<<s|o>>>32-s,i)}function D(e,t,i,n,s,o,r){return M(t&i|~t&n,e,t,s,o,r)}function P(e,t,i,n,s,o,r){return M(t&n|i&~n,e,t,s,o,r)}function Y(e,t,i,n,s,o,r){return M(t^i^n,e,t,s,o,r)}function U(e,t,i,n,s,o,r){return M(i^(t|~n),e,t,s,o,r)}var V=R("v3",48,function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(var i=0;i<t.length;++i)e[i]=t.charCodeAt(i)}return function(e){for(var t=[],i=32*e.length,n="0123456789abcdef",s=0;s<i;s+=8){var o=e[s>>5]>>>s%32&255,o=parseInt(n.charAt(o>>>4&15)+n.charAt(15&o),16);t.push(o)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[H(t)-1]=t;for(var i=1732584193,n=-271733879,s=-1732584194,o=271733878,r=0;r<e.length;r+=16){var a=i,l=n,h=s,c=o;i=D(i,n,s,o,e[r],7,-680876936),o=D(o,i,n,s,e[r+1],12,-389564586),s=D(s,o,i,n,e[r+2],17,606105819),n=D(n,s,o,i,e[r+3],22,-1044525330),i=D(i,n,s,o,e[r+4],7,-176418897),o=D(o,i,n,s,e[r+5],12,1200080426),s=D(s,o,i,n,e[r+6],17,-1473231341),n=D(n,s,o,i,e[r+7],22,-45705983),i=D(i,n,s,o,e[r+8],7,1770035416),o=D(o,i,n,s,e[r+9],12,-1958414417),s=D(s,o,i,n,e[r+10],17,-42063),n=D(n,s,o,i,e[r+11],22,-1990404162),i=D(i,n,s,o,e[r+12],7,1804603682),o=D(o,i,n,s,e[r+13],12,-40341101),s=D(s,o,i,n,e[r+14],17,-1502002290),n=D(n,s,o,i,e[r+15],22,1236535329),i=P(i,n,s,o,e[r+1],5,-165796510),o=P(o,i,n,s,e[r+6],9,-1069501632),s=P(s,o,i,n,e[r+11],14,643717713),n=P(n,s,o,i,e[r],20,-373897302),i=P(i,n,s,o,e[r+5],5,-701558691),o=P(o,i,n,s,e[r+10],9,38016083),s=P(s,o,i,n,e[r+15],14,-660478335),n=P(n,s,o,i,e[r+4],20,-405537848),i=P(i,n,s,o,e[r+9],5,568446438),o=P(o,i,n,s,e[r+14],9,-1019803690),s=P(s,o,i,n,e[r+3],14,-187363961),n=P(n,s,o,i,e[r+8],20,1163531501),i=P(i,n,s,o,e[r+13],5,-1444681467),o=P(o,i,n,s,e[r+2],9,-51403784),s=P(s,o,i,n,e[r+7],14,1735328473),n=P(n,s,o,i,e[r+12],20,-1926607734),i=Y(i,n,s,o,e[r+5],4,-378558),o=Y(o,i,n,s,e[r+8],11,-2022574463),s=Y(s,o,i,n,e[r+11],16,1839030562),n=Y(n,s,o,i,e[r+14],23,-35309556),i=Y(i,n,s,o,e[r+1],4,-1530992060),o=Y(o,i,n,s,e[r+4],11,1272893353),s=Y(s,o,i,n,e[r+7],16,-155497632),n=Y(n,s,o,i,e[r+10],23,-1094730640),i=Y(i,n,s,o,e[r+13],4,681279174),o=Y(o,i,n,s,e[r],11,-358537222),s=Y(s,o,i,n,e[r+3],16,-722521979),n=Y(n,s,o,i,e[r+6],23,76029189),i=Y(i,n,s,o,e[r+9],4,-640364487),o=Y(o,i,n,s,e[r+12],11,-421815835),s=Y(s,o,i,n,e[r+15],16,530742520),n=Y(n,s,o,i,e[r+2],23,-995338651),i=U(i,n,s,o,e[r],6,-198630844),o=U(o,i,n,s,e[r+7],10,1126891415),s=U(s,o,i,n,e[r+14],15,-1416354905),n=U(n,s,o,i,e[r+5],21,-57434055),i=U(i,n,s,o,e[r+12],6,1700485571),o=U(o,i,n,s,e[r+3],10,-1894986606),s=U(s,o,i,n,e[r+10],15,-1051523),n=U(n,s,o,i,e[r+1],21,-2054922799),i=U(i,n,s,o,e[r+8],6,1873313359),o=U(o,i,n,s,e[r+15],10,-30611744),s=U(s,o,i,n,e[r+6],15,-1560198380),n=U(n,s,o,i,e[r+13],21,1309151649),i=U(i,n,s,o,e[r+4],6,-145523070),o=U(o,i,n,s,e[r+11],10,-1120210379),s=U(s,o,i,n,e[r+2],15,718787259),n=U(n,s,o,i,e[r+9],21,-343485551),i=F(i,a),n=F(n,l),s=F(s,h),o=F(o,c)}return[i,n,s,o]}(function(e){if(0===e.length)return[];for(var t=8*e.length,i=new Uint32Array(H(t)),n=0;n<t;n+=8)i[n>>5]|=(255&e[n/8])<<n%32;return i}(e),8*e.length))});function X(e,t){return e<<t|e>>>32-t}var z=R("v5",80,function(e){var t=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var n=unescape(encodeURIComponent(e));e=[];for(var s=0;s<n.length;++s)e.push(n.charCodeAt(s))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);for(var o=e.length/4+2,r=Math.ceil(o/16),a=new Array(r),l=0;l<r;++l){for(var h=new Uint32Array(16),c=0;c<16;++c)h[c]=e[64*l+4*c]<<24|e[64*l+4*c+1]<<16|e[64*l+4*c+2]<<8|e[64*l+4*c+3];a[l]=h}a[r-1][14]=8*(e.length-1)/Math.pow(2,32),a[r-1][14]=Math.floor(a[r-1][14]),a[r-1][15]=8*(e.length-1)&4294967295;for(var d=0;d<r;++d){for(var u=new Uint32Array(80),p=0;p<16;++p)u[p]=a[d][p];for(var m=16;m<80;++m)u[m]=X(u[m-3]^u[m-8]^u[m-14]^u[m-16],1);for(var g=i[0],f=i[1],v=i[2],y=i[3],w=i[4],b=0;b<80;++b)var B=Math.floor(b/20),B=X(g,5)+function(e,t,i,n){switch(e){case 0:return t&i^~t&n;case 1:return t^i^n;case 2:return t&i^t&n^i&n;case 3:return t^i^n}}(B,f,v,y)+w+t[B]+u[b]>>>0,w=y,y=v,v=X(f,30)>>>0,f=g,g=B;i[0]=i[0]+g>>>0,i[1]=i[1]+f>>>0,i[2]=i[2]+v>>>0,i[3]=i[3]+y>>>0,i[4]=i[4]+w>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,255&i[0],i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,255&i[1],i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,255&i[2],i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,255&i[3],i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,255&i[4]]});var $=i(Object.freeze({__proto__:null,v1:function(e,t,i){var n=t&&i||0,s=t||new Array(16),o=(e=e||{}).node||I,r=void 0!==e.clockseq?e.clockseq:C;null!=o&&null!=r||(l=e.random||(e.rng||T)(),null==o&&(o=I=[1|l[0],l[1],l[2],l[3],l[4],l[5]]),null==r&&(r=C=16383&(l[6]<<8|l[7])));var a=void 0!==e.msecs?e.msecs:Date.now(),i=void 0!==e.nsecs?e.nsecs:x+1,l=a-A+(i-x)/1e4;if(l<0&&void 0===e.clockseq&&(r=r+1&16383),1e4<=(i=(l<0||A<a)&&void 0===e.nsecs?0:i))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");A=a,C=r,i=(1e4*(268435455&(a+=122192928e5))+(x=i))%4294967296,s[n++]=i>>>24&255,s[n++]=i>>>16&255,s[n++]=i>>>8&255,s[n++]=255&i,a=a/4294967296*1e4&268435455,s[n++]=a>>>8&255,s[n++]=255&a,s[n++]=a>>>24&15|16,s[n++]=a>>>16&255,s[n++]=r>>>8|128,s[n++]=255&r;for(var h=0;h<6;++h)s[n+h]=o[h];return t||k(s)},v3:V,v4:function(e,t,i){var n=(e=e||{}).random||(e.rng||T)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){i=i||0;for(var s=0;s<16;++s)t[i+s]=n[s];return t}return k(n)},v5:z,NIL:"00000000-0000-0000-0000-000000000000",version:function(e){if(!S(e))throw TypeError("Invalid UUID");return parseInt(e.substr(14,1),16)},validate:S,stringify:k,parse:O})),_={},e={};Object.defineProperty(e,"__esModule",{value:!0});const G=[{TEXT:"BASIC",COLOR:"#19aa19",BACKGROUND:"#e8f6e8"},{TEXT:"ADVANCED",COLOR:"#f55000",BACKGROUND:"#feede5"},{TEXT:"EXPERT",COLOR:"#a00a50",BACKGROUND:"#F5E6ED"},{TEXT:"MASTER",COLOR:"#8200dc",BACKGROUND:"#f2e5fb"},{TEXT:"WORLD'S END",COLOR:"#000000",BACKGROUND:"#e5e5e5"}],j=["SONGID","TITLE","ARTIST","DESIGNER","DIFFICULTY","PLAYLEVEL","WAVE","WAVEOFFSET","JACKET","BACKGROUND","MOVIE","MOVIEOFFSET","BASEBPM"],W=["SONGID","TITLE","ARTIST","DESIGNER","DIFFICULTY","PLAYLEVEL"],K=["ARTIST","BACKGROUND","DESIGNER","JACKET","MOVIE","SONGID","TITLE","WAVE"],q=["BASEBPM","MOVIEOFFSET","WAVEOFFSET"];function Z(e){return e.split("\n").filter(e=>"#"===e.slice(0,1)).map(e=>e.slice(1)).filter(e=>!e.match(/^\d{3}/)).reduce((e,t)=>{var i,n=t.slice(0,t.indexOf(" ")).trim().toUpperCase();return i=n,-1<j.indexOf(i)&&(t={key:n,value:t.slice(t.indexOf(" ")+1,t.length).trim()},e.push(t)),e},[]).map(e=>(e.value=e.value.match(/^".*"$/)?e.value.slice(1,e.value.length-1):e.value,e)).filter(e=>e.value).reduce((e,t)=>{if(-1<K.indexOf(t.key)&&(e[t.key]=t.value),-1<q.indexOf(t.key)&&Number(t.value)&&(e[t.key]=Number(t.value)),"DIFFICULTY"===t.key){var i=Number(t.value.slice(0,1));if(isNaN(i)||Number(i)<0||4<Number(i))return e;e.DIFFICULTY=Object.assign({},G[i],{LEVEL:Number(i),MARK:4===Number(i)?1!==t.value.length?`${t.value}:`.split(":")[1]:"":void 0})}if("PLAYLEVEL"===t.key){if(!Number(t.value)&&!Number(t.value.slice(0,-1)))return e;e.PLAYLEVEL={LEVEL:Number(t.value)||Number(t.value.slice(0,-1)),PLUS:/\+$/.test(t.value),TEXT:t.value}}return e},{})}e.getMeta=Z,e.validate=function(e){const t=Z(e),i=W.slice();return null!=t.WAVE&&i.push("WAVEOFFSET"),null!=t.MOVIE&&i.push("MOVIEOFFSET"),null!=t.DIFFICULTY&&4===t.DIFFICULTY.LEVEL&&i.splice(i.indexOf("PLAYLEVEL"),1),{MISSING_META:e=i.filter(e=>!t.hasOwnProperty(e)),VALIDITY:0===e.length}};var J,V={};Object.defineProperty(V,"__esModule",{value:!0});const Q=e;function ee(e,t,i,n){return e.filter(e=>e.match(t)).reduce((e,t)=>(e[Number(t.slice(i,n))]=Number(t.split(":")[1].trim()),e),[])}function te(s,e){return[...Array(e)].reduce((e,t,i)=>{let n=i;for(;e[i]=s[n--],void 0===e[i];);return e},[])}function ie(e,n){const s=[];return e.filter(e=>e.laneType===n).reduce((e,t)=>(e[t.measure]=e[t.measure]||[],e[t.measure][t.tick]=e[t.measure][t.tick]||[],e[t.measure][t.tick].push(t),e),[]).reduce((i,e)=>(e.forEach(e=>{e.filter(e=>2===e.noteType).forEach(e=>{var t=2===n?e.lane:0;e.channel&&s[t]&&s[t][e.channel]&&(s[t][e.channel].push(e),i.push(s[t][e.channel]),delete s[t][e.channel])}),e.filter(e=>1===e.noteType).forEach(e=>{var t=2===n?e.lane:0;e.channel&&(s[t]=s[t]||[],s[t][e.channel]=[],s[t][e.channel].push(e))}),e.filter(e=>-1<[3,4,5].indexOf(e.noteType)).forEach(e=>{var t=2===n?e.lane:0;e.channel&&s[t]&&s[t][e.channel]&&s[t][e.channel].push(e)})}),i),[])}function ne(e){for(var t in e)J.hasOwnProperty(t)||(J[t]=e[t])}V.getScore=function(e,t=192){const i=e.split("\n").filter(e=>"#"===e.slice(0,1)).map(e=>e.slice(1));var n,r,a,s=i.filter(e=>e.match(/^\d{3}[1-5][0-9a-fA-F][0-9a-zA-Z]?:/)).map(e=>Number(e.slice(0,3))).reduce((e,t)=>t<e?e:t,0)+1,o=function(e,t){const i=ee(e,/^\d{3}02:/,0,3);return i[0]=Number.isFinite(i[0])?i[0]:4,te(i,t)}(i,s);const l=(n=i,r=t,a=o,n.filter(e=>e.match(/^\d{3}[1-5][0-9a-fA-F][0-9a-zA-Z]?:(\s*[0-9a-zA-Z][0-9a-gA-G])+\s*$/)).map(e=>e.split(":",2)).reduce((t,n)=>{const s=n[1].trim().replace(/ /g,""),o=Number(n[0].slice(0,3));return[...Array(s.length/2)].map((e,t)=>{const i={lane:parseInt(n[0].slice(4,5),16),laneType:Number(n[0].slice(3,4)),measure:o,noteType:parseInt(s[2*t],36),tick:Math.round(r*a[o]/(s.length/2)*t),width:parseInt(s[2*t+1],17)};return 6===n[0].length&&(i.channel=n[0].slice(5,6).toUpperCase().charCodeAt(0)),i}).filter(e=>0!==e.width).forEach(e=>t.push(e)),t},[]));return{BEATs:o,BPMs:function(e,t,i=120){const n=ee(e,/^BPM\d{2}:/,3,5),s=ee(e,/^\d{3}08:/,0,3).map(e=>{if(n[e])return n[e]});return s[0]=Number(s[0])?s[0]:i,te(s,t)}(i,s,Q.getMeta(e).BASEBPM),airActionNotes:ie(l,4),airNotes:l.filter(e=>5===e.laneType),holdNotes:ie(l,2),measure:s,shortNotes:l.filter(e=>1===e.laneType),slideNotes:ie(l,3)}},J=_,Object.defineProperty(J,"__esModule",{value:!0}),ne(e),ne(V);z={};e=z,Object.defineProperty(e,"__esModule",{value:!0}),e.FlickDirection=e.CurveType=e.NoteType=void 0,(V=e.NoteType||(e.NoteType={}))[V.Tap=0]="Tap",V[V.Flick=1]="Flick",V[V.SlideStart=2]="SlideStart",V[V.SlideInvisible=3]="SlideInvisible",V[V.SlideVisible=4]="SlideVisible",V[V.SlideEndDefault=5]="SlideEndDefault",V[V.SlideEndFlick=6]="SlideEndFlick",(V=e.CurveType||(e.CurveType={}))[V.None=0]="None",V[V.Linear=1]="Linear",V[V.EaseIn=2]="EaseIn",V[V.EaseOut=3]="EaseOut",V[V.EaseInOut=4]="EaseInOut",V[V.CubicBezier=5]="CubicBezier",(e=e.FlickDirection||(e.FlickDirection={}))[e.Up=0]="Up",e[e.Left=1]="Left",e[e.Right=2]="Right";const se=$["v4"],oe=_,{NoteType:re,CurveType:ae,FlickDirection:le}=z;function he(e,t){return e.measure===t.measure&&e.tick===t.tick&&e.lane===t.lane&&e.width===t.width}function ce(e,t,i){var n=function(e,t){if(0===e||0===t)return 1;for(;0!==t;){var i=t;t=e%t,e=i}return e}(t%i,i);return[4*e+Math.floor(t/i),t%i/n,t?i/n:1]}var de,ue,pe,me;de="* {\n\tmargin: 0;\n}\n\nhtml, body {\n\twidth: 100%;\n\theight: 100%;\n}\n\nbody {\n\tuser-select: none;\n}\n\n#selector {\n\theight: 50px;\n\tposition: relative;\n}\n\n#app {\n\theight: calc(100% - 50px);\n\tmax-width: 600px;\n}\n",me=(ue=void 0===ue?{}:ue).insertAt,de&&"undefined"!=typeof document&&(pe=document.head||document.getElementsByTagName("head")[0],(ue=document.createElement("style")).type="text/css","top"===me&&pe.firstChild?pe.insertBefore(ue,pe.firstChild):pe.appendChild(ue),ue.styleSheet?ue.styleSheet.cssText=de:ue.appendChild(document.createTextNode(de))),function(){document.addEventListener("DOMContentLoaded",async function(){console.log("ready");const e=document.getElementById("add"),t=document.getElementById("minus"),i=document.getElementById("id");document.getElementById("diff");const n=document.getElementById("load"),s=document.getElementById("bottom"),o=document.getElementById("scroll"),r=document.getElementById("input"),a=document.getElementById("container"),l=document.getElementById("text"),h=document.getElementById("draw");function c(e){var t;null!==g&&(t=g.getHeightPerSecond(),g.setHeightPerSecond("+"===e?t+(t<1e3?100:200):t-100))}e.addEventListener("click",()=>{c("+")}),t.addEventListener("click",()=>{c("-")}),r.addEventListener("click",()=>{a.style.display="none"===a.style.display?"block":"none"}),h.addEventListener("click",()=>{a.style.display="none";var e=function(e){const a=oe.getScore(e,480),n=se(),s={timelines:[{id:n,name:"Timeline 1"}],bpms:[{id:se(),timeline:n,beat:[0,0,1],bpm:a.BPMs[0]}],notes:[],slides:[]};return a.slideNotes.forEach(e=>{const r={id:se(),timeline:n,notes:[]};e.forEach((t,e)=>{var i=a.airNotes.findIndex(e=>he(t,e)),n=a.shortNotes.findIndex(e=>3===e.noteType&&he(t,e)),s=a.shortNotes.findIndex(e=>he(t,e));0===e&&-1!==s&&2===a.shortNotes[s].noteType&&(a.shortNotes.splice(s,1),r.critical=!0);const o={id:se(),type:{1:re.SlideStart,2:re.SlideEndDefault,3:re.SlideVisible,5:re.SlideInvisible}[t.noteType],beat:ce(t.measure,t.tick,480),lane:t.lane-2,width:t.width,curve:ae.Linear};o.type===re.SlideEndDefault&&-1!==i?([e]=a.airNotes.splice(i,1),o.type=re.SlideEndFlick,o.direction=3===e.noteType?le.Left:4===e.noteType?le.Right:le.Up,-1!==s&&([e]=a.shortNotes.splice(s,1),2===e.noteType&&(o.critical=!0))):-1!==i&&-1!==s&&(a.shortNotes.splice(s,1),[i]=a.airNotes.splice(i,1),o.curve={2:ae.EaseOut,5:ae.EaseIn,6:ae.EaseIn}[i.noteType]),-1!==n&&o.type===re.SlideVisible&&(a.shortNotes.splice(n,1),delete o.width,delete o.lane,delete o.curve),r.notes.push(o)}),s.slides.push(r)}),a.shortNotes.forEach(t=>{if(!(t.lane<2||13<t.lane)){var e=a.airNotes.find(e=>he(e,t));const i={id:se(),timeline:n,type:e?re.Flick:re.Tap,beat:ce(t.measure,t.tick,480),lane:t.lane-2,width:t.width};2===t.noteType&&(i.critical=!0),e&&(i.direction=3===e.noteType?le.Left:4===e.noteType?le.Right:le.Up),s.notes.push(i)}}),s}(l.value);null!==g&&(g.destroy(),g=null),g=new b(document.getElementById("app"),e,180),g.event.addEventListener("scroll",e=>{s.value=e.detail.scrollBottom}),g.scrollTo(0)}),await b.loadResource((e,t)=>{console.log(`${e.progress}% loading: ${t.url}`)}),o.addEventListener("click",()=>{var e=parseInt(s.value);g&&g.scrollTo(e)}),n.addEventListener("click",async()=>{const e=await fetch("map/test.json");var t=await e.json();null!==g&&(g.destroy(),g=null),g=new b(document.getElementById("app"),t,180),g.event.addEventListener(f.Scroll,e=>{s.value=e.detail.scrollBottom}),g.scrollTo(31700)}),i.value="135",n.click();const d=document.getElementById("music"),u=document.getElementById("audio"),p=document.getElementById("follow");d.addEventListener("input",()=>{var e=d.files[0],e=URL.createObjectURL(e);u.src=e});let m=null;u.addEventListener("play",()=>{m=setInterval(()=>{null!==g&&(g.setCurrentTime(u.currentTime),p.checked&&g.scrollTo(g.getHeightByTime(u.currentTime)-g.getConst("spaceY")))},16)}),u.addEventListener("pause",()=>{clearInterval(m)})});let g=null}()}(PIXI);
